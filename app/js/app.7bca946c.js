(function(t){function e(e){for(var o,i,s=e[0],c=e[1],l=e[2],u=0,d=[];u<s.length;u++)i=s[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);m&&m(e);while(d.length)d.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],o=!0,i=1;i<n.length;i++){var s=n[i];0!==r[s]&&(o=!1)}o&&(a.splice(e--,1),t=c(c.s=n[0]))}return t}var o={},i={app:0},r={app:0},a=[];function s(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-db74bfde":"bb832289"}[t]+".js"}function c(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(t){var e=[],n={"chunk-db74bfde":1};i[t]?e.push(i[t]):0!==i[t]&&n[t]&&e.push(i[t]=new Promise((function(e,n){for(var o="css/"+({}[t]||t)+"."+{"chunk-db74bfde":"41a8f48a"}[t]+".css",r=c.p+o,a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var l=a[s],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===o||u===r))return e()}var d=document.getElementsByTagName("style");for(s=0;s<d.length;s++){l=d[s],u=l.getAttribute("data-href");if(u===o||u===r)return e()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=e,m.onerror=function(e){var o=e&&e.target&&e.target.src||r,a=new Error("Loading CSS chunk "+t+" failed.\n("+o+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=o,delete i[t],m.parentNode.removeChild(m),n(a)},m.href=r;var h=document.getElementsByTagName("head")[0];h.appendChild(m)})).then((function(){i[t]=0})));var o=r[t];if(0!==o)if(o)e.push(o[2]);else{var a=new Promise((function(e,n){o=r[t]=[e,n]}));e.push(o[2]=a);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=s(t);var d=new Error;l=function(e){u.onerror=u.onload=null,clearTimeout(m);var n=r[t];if(0!==n){if(n){var o=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;d.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",d.name="ChunkLoadError",d.type=o,d.request=i,n[1](d)}r[t]=void 0}};var m=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(e)},c.m=t,c.c=o,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)c.d(n,o,function(e){return t[e]}.bind(null,o));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="",c.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=e,l=l.slice();for(var d=0;d<l.length;d++)e(l[d]);var m=u;a.push([1,"chunk-vendors"]),n()})({0:function(t,e){},"0130":function(t,e,n){t.exports=n.p+"img/av_beta.41c39e4d.png"},"02f6":function(t,e,n){t.exports=n.p+"img/av_badger.d4acb400.png"},"03e5":function(t,e,n){t.exports=n.p+"img/av_octopus.5212bf6b.png"},"0478":function(t,e,n){t.exports=n.p+"img/av_squirrel.d47c4b85.png"},"061b":function(t,e,n){t.exports=n.p+"img/av_jellyfish.03a9c0d4.png"},"065a":function(t,e,n){"use strict";n("f09e")},1:function(t,e,n){t.exports=n("56d7")},10:function(t,e){},11:function(t,e){},12:function(t,e){},13:function(t,e){},1301:function(t,e,n){t.exports=n.p+"img/av_hedgehog.7cb0a229.png"},"132f":function(t,e,n){t.exports=n.p+"img/av_tucan.30beb3d2.png"},"16b0":function(t,e,n){},"19ad":function(t,e,n){t.exports=n.p+"img/av_macaw.a05c791e.png"},"19df":function(t,e,n){t.exports=n.p+"img/av_puffin.9d99a93a.png"},"1eb2":function(t,e,n){t.exports=n.p+"img/av_peacock.bcef575d.png"},2:function(t,e){},"21ef":function(t,e,n){"use strict";n("720a")},"230c":function(t,e,n){},"241d":function(t,e,n){"use strict";n("b0c0");e["a"]={computed:{room:function(){return this.$matrix.currentRoom},roomName:function(){return this.room?this.room.name:""},roomTopic:function(){return this.room?this.room.topic:""},roomAvatar:function(){return this.room?this.room.avatar:""}}}},2582:function(t,e,n){},2757:function(t,e,n){"use strict";n("43b6")},"281b":function(t,e,n){},2883:function(t,e,n){},2920:function(t,e,n){"use strict";n("2883")},"2b99":function(t,e,n){},"2c30":function(t,e,n){t.exports=n.p+"img/av_walrus.3a9e78aa.png"},"2f1c":function(t,e,n){t.exports=n.p+"img/av_zebra.2c4af008.png"},"2f9f":function(t,e,n){t.exports=n.p+"img/av_leopard.60f857fd.png"},3:function(t,e){},"329e":function(t,e,n){t.exports=n.p+"img/av_pangolin.366738bb.png"},3811:function(t,e,n){"use strict";n("65af")},"3ed2":function(t,e,n){"use strict";n("ab89")},4:function(t,e){},"403a":function(t,e,n){t.exports=n.p+"img/av_polar bear.3e1fa612.png"},4060:function(t,e,n){},"43b6":function(t,e,n){},4451:function(t,e,n){},"44b9":function(t,e,n){"use strict";n("cb20")},"4faa":function(t,e,n){},5:function(t,e){},5029:function(t,e,n){t.exports=n.p+"img/av_snake.4e6fc2ae.png"},5338:function(t,e,n){"use strict";n("230c")},"53ed":function(t,e,n){t.exports=n.p+"img/av_eagle.ffb9de18.png"},"56d7":function(t,e,n){"use strict";n.r(e);n("99af"),n("c975"),n("a434"),n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("v-main",[n("router-view")],1)],1)},r=[],a={name:"App",methods:{loggedIn:function(){return this.$store.state.auth.status.loggedIn},logOut:function(){var t=this;this.openDrawer=!1,this.$store.dispatch("auth/logout"),this.$nextTick((function(){t.$navigation.push({path:"/login"},-1)}))}},computed:{currentUser:function(){return this.$store.state.auth.user},title:function(){var t="Keanu Weblite";return this.$matrix.notificationCount>0&&(t+=" ["+this.$matrix.notificationCount+"]"),this.$route.meta.title&&(t+="  - "+this.$route.meta.title),this.$route.meta.includeRoom&&(this.$matrix.currentRoom?t+=" - "+(this.$matrix.currentRoom.summary.info.title||this.$matrix.currentRoom.roomId):this.$matrix.currentRoomId&&(t+=" - "+this.$matrix.currentRoomId)),t}},watch:{title:function(t){document.title=t},currentUser:{immediate:!0,handler:function(t,e){this.currentUser&&this.$matrix.login(this.currentUser).then((function(){console.log("Matrix client ready")})).catch((function(t){console.log("Error creating client",t)}))}}}},s=a,c=(n("5c0b"),n("2877")),l=n("6544"),u=n.n(l),d=n("7496"),m=n("f6c4"),h=Object(c["a"])(s,i,r,!1,null,null,null),v=h.exports;u()(h,{VApp:d["a"],VMain:m["a"]});var f=n("f309");o["a"].use(f["a"]);var g=new f["a"]({icons:{iconfont:"md"}}),p=(n("caad"),n("b0c0"),n("d3b7"),n("2ca0"),n("8c4f")),b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("RoomList"),n("v-btn",{staticClass:"outlined-button",attrs:{block:""},on:{click:function(e){return e.stopPropagation(),t.logout(e)}}},[t._v("Logout")])],1)},C=[],_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list",{staticClass:"room-list",attrs:{dense:""}},[n("div",{staticClass:"h4"},[t._v(t._s(t.title))]),n("v-list-item-group",{attrs:{color:"primary"},model:{value:t.currentRoomId,callback:function(e){t.currentRoomId=e},expression:"currentRoomId"}},t._l(t.$matrix.rooms,(function(e){return n("v-list-item",{key:e.roomId,attrs:{value:e.roomId}},[n("v-list-item-avatar",{attrs:{size:"40",color:"#e0e0e0"}},[n("v-img",{attrs:{src:e.avatar}})],1),n("div",{staticClass:"room-list-notification-count"},[t._v(t._s(t.notificationCount(e)))]),n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(e.summary.info.title))]),n("v-list-item-subtitle",[t._v(t._s(e.topic))])],1)],1)})),1)],1)},y=[],x=n("d930"),w={name:"RoomList",props:{title:{type:String,default:"Rooms"}},data:function(){return{currentRoomId:null}},methods:{notificationCount:function(t){return t.getUnreadNotificationCount("total")||0}},watch:{currentRoomId:function(){this.$emit("close"),this.$navigation.push({name:"Chat",params:{roomId:x["a"].sanitizeRoomId(this.currentRoomId)}},-1)}}},R=w,k=(n("edab"),n("adda")),I=n("8860"),T=n("da13"),E=n("8270"),S=n("5d23"),$=n("1baa"),A=Object(c["a"])(R,_,y,!1,null,null,null),P=A.exports;u()(A,{VImg:k["a"],VList:I["a"],VListItem:T["a"],VListItemAvatar:E["a"],VListItemContent:S["a"],VListItemGroup:$["a"],VListItemSubtitle:S["b"],VListItemTitle:S["c"]});var M={components:{RoomList:P},methods:{logout:function(){var t=this;this.$store.dispatch("auth/logout"),this.$nextTick((function(){t.$navigation.push({path:"/login"},-1)}))}}},O=M,D=n("8336"),L=Object(c["a"])(O,b,C,!1,null,null,null),V=L.exports;u()(L,{VBtn:D["a"]});var U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chat-root fill-height d-flex flex-column",attrs:{"ma-0":"","pa-0":""}},[n("ChatHeader",{staticClass:"chat-header flex-grow-0 flex-shrink-0",on:{"header-click":function(e){return t.$refs.roomInfoSheet.open()}}}),n("div",{ref:"chatContainer",staticClass:"chat-content flex-grow-1 flex-shrink-1",staticStyle:{"overflow-x":"hidden","overflow-y":"auto"},on:{scroll:t.onScroll,click:t.closeContextMenuIfOpen}},[n("div",{ref:"messageOperationsStrut",staticClass:"message-operations-strut"},[t.selectedEvent&&t.showContextMenu?n("message-operations",{style:t.opStyle,attrs:{event:t.selectedEvent,incoming:t.selectedEvent.getSender()!=t.$matrix.currentUserId},on:{close:function(e){t.showContextMenu=!1},addreaction:t.addReaction,addreply:function(e){return t.addReply(t.selectedEvent)},edit:function(e){return t.edit(t.selectedEvent)},redact:function(e){return t.redact(t.selectedEvent)},download:function(e){return t.download(t.selectedEvent)}}}):t._e()],1),n("resize-observer",{ref:"chatContainerResizer",on:{notify:t.handleChatContainerResize}}),t._l(t.events,(function(e,o){return n("div",{key:e.getId(),attrs:{eventId:e.getId()}},[t.showDayMarkerBeforeEvent(e)?n("div",{staticClass:"day-marker",attrs:{title:t.dayForEvent(e)}}):t._e(),e.isRelation()||e.isRedacted()||e.isRedaction()?t._e():n("div",{ref:e.getId(),refInFor:!0},[n("div",{staticStyle:{position:"relative","user-select":"none"},on:{touchstart:function(n){t.touchStart(n,e)},touchend:t.touchEnd,touchcancel:t.touchCancel,touchmove:t.touchMove}},[n(t.componentForEvent(e),{tag:"component",attrs:{room:t.room,event:e,nextEvent:t.events[o+1],reactions:t.timelineWindow._timelineSet.getRelationsForEvent(e.getId(),"m.annotation","m.reaction"),timelineSet:t.timelineWindow._timelineSet},on:{"send-quick-reaction":t.sendQuickReaction,"context-menu":function(e){return t.showContextMenuForEvent(e)},"own-avatar-clicked":t.viewProfile}}),e.getId()==t.readMarker&&o<t.events.length-1?n("div",{staticClass:"read-marker",attrs:{title:"Unread messages"}}):t._e()],1)])])}))],2),t.room?n("v-container",{staticClass:"input-area-outer",attrs:{fluid:""}},[n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.showScrollToEnd,expression:"showScrollToEnd"}],staticClass:"scroll-to-end",attrs:{fab:"",small:"",elevation:"0",color:"black"},on:{click:function(e){return e.stopPropagation(),t.smoothScrollToEnd(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("arrow_downward")])],1),n("v-row",{staticClass:"ma-0 pa-0"},[t.replyToEvent?n("div",[t._v(" REPLYING TO EVENT: "+t._s(t.replyToEvent.getContent().body)+" ")]):t._e(),n("div",{staticClass:"typing"},[t._v(" "+t._s(t.typingMembersString)+" ")])]),n("v-row",{staticClass:"input-area-inner align-center"},[n("v-col",{staticClass:"flex-grow-1 flex-shrink-1 ma-0 pa-0"},[n("v-textarea",{ref:"messageInput",staticClass:"input-area-text",attrs:{height:"undefined","full-width":"","auto-grow":"",rows:"1","no-resize":"",placeholder:"Your message...","hide-details":"","background-color":"white"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),function(){t.sendCurrentTextMessage()}())}},model:{value:t.currentInput,callback:function(e){t.currentInput=e},expression:"currentInput"}})],1),t.editedEvent||t.replyToEvent?n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[n("v-btn",{attrs:{fab:"",small:"",elevation:"0",color:"black"},on:{click:function(e){return e.stopPropagation(),t.cancelEditReply(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("cancel")])],1)],1):t._e(),!t.currentInput||0==t.currentInput.length||t.showRecorder?n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[n("v-btn",{directives:[{name:"blur",rawName:"v-blur"},{name:"longTap",rawName:"v-longTap:250",value:[t.showRecordingUI,t.startRecording],expression:"[showRecordingUI, startRecording]",arg:"250"}],ref:"mic_button",staticClass:"mic-button",staticStyle:{"z-index":"10"},attrs:{fab:"",small:"",elevation:"0",disabled:!t.canRecordAudio}},[n("v-icon",{attrs:{color:t.showRecorder?"white":"black"}},[t._v("mic")])],1)],1):n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[n("v-btn",{attrs:{fab:"",small:"",elevation:"0",color:"black",disabled:t.sendButtonDisabled},on:{click:function(e){return e.stopPropagation(),t.sendCurrentTextMessage(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v(t._s(t.editedEvent?"save":"arrow_upward"))])],1)],1),n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[n("label",{ref:"attachmentLabel",attrs:{icon:"",flat:""}},[t.showRecorder?t._e():n("v-btn",{attrs:{icon:"",large:"",color:"black",disabled:t.attachButtonDisabled},on:{click:t.showAttachmentPicker}},[n("v-icon",{attrs:{"x-large":""}},[t._v("add_circle_outline")])],1),n("input",{ref:"attachment",staticStyle:{display:"none"},attrs:{type:"file",name:"attachment",accept:"image/*|audio/*|video/*|application/pdf"},on:{change:function(e){return t.handlePickedAttachment(e)}}})],1)])],1),n("VoiceRecorder",{attrs:{micButtonRef:t.$refs.mic_button,ptt:t.showRecorderPTT,show:t.showRecorder},on:{close:function(e){t.showRecorder=!1},file:t.onVoiceRecording}})],1):t._e(),t.currentImageInputPath?n("div",[n("v-dialog",{staticClass:"ma-0 pa-0",attrs:{width:"50%"},model:{value:t.currentImageInputPath,callback:function(e){t.currentImageInputPath=e},expression:"currentImageInputPath"}},[n("v-card",{staticClass:"ma-0 pa-0"},[n("v-card-text",{staticClass:"ma-0 pa-0"},[t.currentImageInput?n("v-img",{staticStyle:{"max-height":"50vh"},attrs:{"aspect-ratio":1,src:t.currentImageInput,contain:""}}):t._e(),t.currentSendError?n("div",[t._v(t._s(t.currentSendError))]):n("div",[t._v(t._s(t.currentSendProgress))])],1),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",text:""},on:{click:t.cancelSendAttachment}},[t._v("Cancel")]),t.currentSendShowSendButton?n("v-btn",{attrs:{color:"primary",text:"",disabled:null!=t.currentSendOperation},on:{click:t.sendAttachment}},[t._v("Send")]):t._e()],1)],1)],1)],1):t._e(),t.showEmojiPicker?n("div",[n("v-dialog",{staticClass:"ma-0 pa-0",model:{value:t.showEmojiPicker,callback:function(e){t.showEmojiPicker=e},expression:"showEmojiPicker"}},[n("VEmojiPicker",{staticStyle:{width:"100%"},on:{select:t.emojiSelected}})],1)],1):t._e(),n("v-dialog",{staticClass:"ma-0 pa-0",attrs:{width:"50%"},model:{value:t.showNotAllowedForGuests,callback:function(e){t.showNotAllowedForGuests=e},expression:"showNotAllowedForGuests"}},[n("v-card",[n("v-card-title",[t._v("You are logged in as a guest")]),n("v-card-text",[n("div",[t._v("Unfortunately guests are not allowed to upload files.")])]),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.showNotAllowedForGuests=!1}}},[t._v("Ok")])],1)],1)],1),t.initialLoadDone?t._e():n("v-container",{staticStyle:{position:"absolute"},attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center",justify:"center"}},[n("v-col",{staticClass:"text-center"},[n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)],1)],1),n("RoomInfoBottomSheet",{ref:"roomInfoSheet"})],1)},N=[],j=(n("b680"),n("2532"),n("3ca3"),n("18a5"),n("ddb0"),n("2b3d"),n("c4f4")),B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"bubble"},[n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}}),t.inReplyToText?n("div",{staticClass:"original-message"},[n("div",{staticClass:"original-message-sender"},[t._v(" "+t._s(t.inReplyToSender||"Someone")+" said: ")]),n("div",{staticClass:"original-message-text",domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.inReplyToText)))}})]):t._e(),n("div",{staticClass:"message"},[n("span",{domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.messageText)))}}),t.event.replacingEventId()?n("span",{staticClass:"edit-marker"},[t._v("(edited)")]):t._e()])],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},F=[],W=(n("a15b"),n("d81d"),n("ac1f"),n("5319"),n("1276"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.reactions,expression:"reactions"}],staticClass:"quick-reaction-container"},t._l(t.reactionMap,(function(e,o){return n("span",{key:o,class:{"quick-reaction":!0,sent:e.includes(t.$matrix.currentUserId)},on:{mousedown:function(e){return t.onClickEmoji(o)}}},[t._v(" "+t._s(o)+" "),n("span",{staticClass:"quick-reaction-count"},[t._v(t._s(e.length))])])})),0)}),H=[],z=n("b85c"),J={props:{event:{type:Object,default:function(){return{}}},reactions:{type:Object,default:function(){return null}}},data:function(){return{reactionMap:{}}},beforeDestroy:function(){this.reactions&&this.reactions.off("Relations.add",this.onAddRelation)},methods:{onClickEmoji:function(t){this.$bubble("send-quick-reaction",{reaction:t,event:this.event})},onAddRelation:function(t){this.processReactions()},processReactions:function(){var t={};if(this.reactions&&this.reactions._eventsCount>0){var e,n=this.reactions.getRelations(),o=Object(z["a"])(n);try{for(o.s();!(e=o.n()).done;){var i=e.value,r=i.getRelation().key,a=i.getSender();if(t[r]){var s=t[r];s.includes(a)||s.push(a)}else t[r]=[a]}}catch(c){o.e(c)}finally{o.f()}}this.reactionMap=t}},watch:{reactions:{handler:function(t,e){e&&e.off("Relations.add",this.onAddRelation),t&&t.on("Relations.add",this.onAddRelation),this.processReactions()},immediate:!0}}},Y=J,X=(n("f220"),Object(c["a"])(Y,W,H,!1,null,null,null)),G=X.exports,q=n("74fe"),Q=n("1901");q.options.defaults.className="link",q.options.defaults.target=null;var K={components:{QuickReactions:G},props:{room:{type:Object,default:function(){return null}},event:{type:Object,default:function(){return{}}},nextEvent:{type:Object,default:function(){return null}},reactions:{type:Object,default:function(){return null}},timelineSet:{type:Object,default:function(){return null}}},data:function(){return{inReplyToEvent:null,inReplyToSender:null}},mounted:function(){var t=this.event.getWireContent()["m.relates_to"];if(t&&t["m.in_reply_to"]){var e=t["m.in_reply_to"].event_id;if(e&&this.timelineSet){var n=this.timelineSet.findEventById(e);n&&(this.inReplyToEvent=n,this.inReplyToSender=this.messageEventDisplayName(n))}}},computed:{showSenderAndTime:function(){if(this.nextEvent&&this.nextEvent.getSender()==this.event.getSender()){var t=this.nextEvent.event.origin_server_ts,e=this.event.event.origin_server_ts;return t-e<12e4}return!0},inReplyToText:function(){var t=this.event.getWireContent()["m.relates_to"];if(t&&t["m.in_reply_to"]){var e=this.event.getContent(),n=e.body.split("\n").reverse();while(n.length&&!n[0].startsWith("> "))n.shift();""===n[0]&&n.shift();var o=n.map((function(t){return t.replace(/^> (<.*> )?/g,"")})).reverse().join("\n");if(o)return o;if(this.inReplyToEvent){var i=this.inReplyToEvent.getContent();return i.body}return"<original text>"}return null},messageText:function(){var t=this.event.getWireContent()["m.relates_to"];if(t&&t["m.in_reply_to"]){var e=this.event.getContent(),n=e.body.split("\n");while(n.length&&n[0].startsWith("> "))n.shift();return""===n[0]&&n.shift(),n.join("\n")}return this.event.getContent().body},messageClasses:function(){return{messageIn:!0,"from-admin":this.senderIsAdminOrModerator(this.event)}},userAvatar:function(){return this.$matrix.userAvatar?this.$matrix.matrixClient.mxcUrlToHttp(this.$matrix.userAvatar,80,80,"scale",!0):null},userAvatarLetter:function(){return this.$matrix.currentUser?(this.$matrix.userDisplayName||this.$matrix.currentUserId.substring(1)).substring(0,1).toUpperCase():null}},methods:{ownAvatarClicked:function(){this.$emit("own-avatar-clicked",{event:this.event})},showContextMenu:function(t){this.$emit("context-menu",{event:this.event,anchor:t})},stateEventDisplayName:function(t){if(t.getSender()==this.$matrix.currentUserId)return"You";if(this.room){var e=this.room.getMember(t.getSender());if(e)return e.name}return t.getContent().displayname||t.event.state_key},messageEventDisplayName:function(t){return this.stateEventDisplayName(t)},messageEventAvatar:function(t){if(this.room){var e=this.room.getMember(t.getSender());if(e)return e.getAvatarUrl(this.$matrix.matrixClient.getHomeserverUrl(),40,40,"scale",!0)}return null},senderIsAdminOrModerator:function(t){if(this.room){var e=this.room.getMember(t.getSender());if(e)return e.powerLevel>0}return!1},formatTime:function(t){var e=new Date;e.setTime(t);var n=new Date;return e.getDate()==n.getDate()&&e.getMonth()==n.getMonth()&&e.getFullYear()==n.getFullYear()?e.toLocaleTimeString():e.toLocaleString()},linkify:function(t){return Q(t)}}},Z={mixins:[K]},tt=Z,et=(n("902b"),n("8212")),nt=n("132d"),ot=Object(c["a"])(tt,B,F,!1,null,null,null),it=ot.exports;u()(ot,{VAvatar:et["a"],VBtn:D["a"],VIcon:nt["a"]});var rt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"bubble image-bubble"},[n("v-img",{ref:"image",attrs:{"aspect-ratio":16/9,src:t.src,cover:t.cover,contain:t.contain}}),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},at=[],st={mixins:[K],data:function(){return{src:null,cover:!0,contain:!1}},mounted:function(){var t=this,e=this.$refs.image.$el.clientWidth,n=9*e/16;x["a"].getThumbnail(this.$matrix.matrixClient,this.event,e,n).then((function(e){var n=t.event.getContent().info;n&&n.mimetype&&n.mimetype.startsWith("image/jp")?(t.cover=!0,t.contain=!1):(t.cover=!1,t.contain=!0),t.src=e})).catch((function(t){console.log("Failed to fetch thumbnail: ",t)}))},beforeDestroy:function(){if(this.src){var t=this.src;this.src=null,URL.revokeObjectURL(t)}}},ct=st,lt=(n("e7e5"),Object(c["a"])(ct,rt,at,!1,null,null,null)),ut=lt.exports;u()(lt,{VAvatar:et["a"],VBtn:D["a"],VIcon:nt["a"],VImg:k["a"]});var dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"audio-bubble"},[n("audio",{attrs:{controls:"",src:t.src}},[t._v("Audio file")]),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},mt=[],ht={data:function(){return{src:null,downloadProgress:null}},mounted:function(){var t=this;console.log("Mounted with event:",JSON.stringify(this.event.getContent())),x["a"].getAttachment(this.$matrix.matrixClient,this.event,(function(e){t.downloadProgress=e,console.log("Progress: "+e)})).then((function(e){t.src=e})).catch((function(t){console.log("Failed to fetch attachment: ",t)}))},beforeDestroy:function(){if(this.src){var t=this.src;this.src=null,URL.revokeObjectURL(t)}}},vt={mixins:[K,ht]},ft=vt,gt=(n("9cdd"),Object(c["a"])(ft,dt,mt,!1,null,null,null)),pt=gt.exports;u()(gt,{VAvatar:et["a"],VBtn:D["a"],VIcon:nt["a"]});var bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"bubble image-bubble"},[n("v-responsive",{attrs:{"aspect-ratio":16/9,src:t.src}},[n("video",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.src,controls:""}},[t._v("Video file")]),t.downloadProgress?n("div",{staticClass:"download-overlay"},[n("div",{staticClass:"text-center download-text"},[t._v(t._s(t.downloadProgress)+"% downloaded")])]):t._e()]),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},Ct=[],_t={mixins:[K,ht]},yt=_t,xt=(n("c302"),n("6b53")),wt=Object(c["a"])(yt,bt,Ct,!1,null,null,null),Rt=wt.exports;u()(wt,{VAvatar:et["a"],VBtn:D["a"],VIcon:nt["a"],VResponsive:xt["a"]});var kt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"bubble"},[n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}}),t.inReplyToText?n("div",{staticClass:"original-message"},[n("div",{staticClass:"original-message-sender"},[t._v(" "+t._s(t.inReplyToSender||"Someone")+" said: ")]),n("div",{staticClass:"original-message-text",domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.inReplyToText)))}})]):t._e(),n("div",{staticClass:"message"},[n("span",{domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.messageText)))}}),t.event.replacingEventId()?n("span",{staticClass:"edit-marker"},[t._v("(edited)")]):t._e()])],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")]),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])],1)},It=[],Tt={mixins:[K]},Et=Tt,St=(n("e7c8"),Object(c["a"])(Et,kt,It,!1,null,null,null)),$t=St.exports;u()(St,{VAvatar:et["a"],VBtn:D["a"],VIcon:nt["a"]});var At=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"bubble image-bubble"},[n("v-img",{ref:"image",attrs:{"aspect-ratio":16/9,src:t.src,cover:t.cover,contain:t.contain}}),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" "),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])])],1)},Pt=[],Mt={mixins:[K],data:function(){return{src:null,cover:!0,contain:!1}},mounted:function(){var t=this,e=this.$refs.image.$el.clientWidth,n=9*e/16;x["a"].getThumbnail(this.$matrix.matrixClient,this.event,e,n).then((function(e){var n=t.event.getContent().info;n&&n.mimetype&&n.mimetype.startsWith("image/jp")?(t.cover=!0,t.contain=!1):(t.cover=!1,t.contain=!0),t.src=e})).catch((function(t){console.log("Failed to fetch thumbnail: ",t)}))},beforeDestroy:function(){if(this.src){var t=this.src;this.src=null,URL.revokeObjectURL(t)}}},Ot=Mt,Dt=(n("7924"),Object(c["a"])(Ot,At,Pt,!1,null,null,null)),Lt=Dt.exports;u()(Dt,{VAvatar:et["a"],VBtn:D["a"],VIcon:nt["a"],VImg:k["a"]});var Vt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"audio-bubble"},[n("audio",{attrs:{controls:"",src:t.src}},[t._v("Audio file")]),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")]),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])],1)},Ut=[],Nt={mixins:[K,ht]},jt=Nt,Bt=(n("6a42"),Object(c["a"])(jt,Vt,Ut,!1,null,null,null)),Ft=Bt.exports;u()(Bt,{VAvatar:et["a"],VBtn:D["a"],VIcon:nt["a"]});var Wt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"bubble image-bubble"},[n("v-responsive",{staticClass:"ma-0 pa-0",attrs:{"aspect-ratio":16/9}},[n("video",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.src,controls:""}},[t._v("Video file")])]),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")]),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])],1)},Ht=[],zt={mixins:[K,ht]},Jt=zt,Yt=(n("bed4"),Object(c["a"])(Jt,Wt,Ht,!1,null,null,null)),Xt=Yt.exports;u()(Yt,{VAvatar:et["a"],VBtn:D["a"],VIcon:nt["a"],VResponsive:xt["a"]});var Gt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageJoin"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" joined the chat ")])},qt=[],Qt={mixins:[K]},Kt=Qt,Zt=(n("2757"),Object(c["a"])(Kt,Gt,qt,!1,null,null,null)),te=Zt.exports,ee=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageJoin"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" left the chat ")])},ne=[],oe={mixins:[K]},ie=oe,re=(n("ffff"),Object(c["a"])(ie,ee,ne,!1,null,null,null)),ae=re.exports,se=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageJoin"},[t._v(" "+t._s(t.event.getContent().displayname||t.stateEventDisplayName(t.event))+" was invited to the chat... ")])},ce=[],le={mixins:[K]},ue=le,de=(n("a826"),Object(c["a"])(ue,se,ce,!1,null,null,null)),me=de.exports,he=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageJoin"},[t.displayNameChange?n("div",[t._v(" "+t._s(t.changer)+" changed display name to "+t._s(t.event.getContent().displayname)+" ")]):t._e(),t.avatarChange?n("div",[t._v(" "+t._s(t.changer)+" changed the avatar ")]):t._e()])},ve=[],fe={mixins:[K],computed:{displayNameChange:function(){var t=this.event.getContent(),e=this.event.getPrevContent();return t.displayname!=e.displayname},avatarChange:function(){var t=this.event.getContent(),e=this.event.getPrevContent();return t.avatar_url!=e.avatar_url},changer:function(){return this.event.getSender()==this.$matrix.currentUserId?"You":this.displayNameChange?this.event.getPrevContent().displayname:this.stateEventDisplayName(this.event)}}},ge=fe,pe=(n("065a"),Object(c["a"])(ge,he,ve,!1,null,null,null)),be=pe.exports,Ce=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" changed room name to "+t._s(t.event.getContent().name)+" ")])},_e=[],ye={mixins:[K]},xe=ye,we=(n("d034"),Object(c["a"])(xe,Ce,_e,!1,null,null,null)),Re=we.exports,ke=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" changed topic to "+t._s(t.event.getContent().topic)+" ")])},Ie=[],Te={mixins:[K]},Ee=Te,Se=(n("2920"),Object(c["a"])(Ee,ke,Ie,!1,null,null,null)),$e=Se.exports,Ae=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" changed the room avatar ")])},Pe=[],Me={mixins:[K]},Oe=Me,De=(n("ef8b"),Object(c["a"])(Oe,Ae,Pe,!1,null,null,null)),Le=De.exports,Ve=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" made room history "+t._s(t.history(t.event))+" ")])},Ue=[],Ne={mixins:[K],methods:{history:function(t){var e=t.getContent().history_visibility;switch(e){case"world_readable":return"readable by anyone";case"shared":return"readable to all members in the room";case"invited":return"readable to members from when they were invited";case"joined":return"readable to members from when they joined"}return e}}},je=Ne,Be=(n("ac7e"),Object(c["a"])(je,Ve,Ue,!1,null,null,null)),Fe=Be.exports,We=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v("Event: "+t._s(t.event.getType()))])},He=[],ze={mixins:[K]},Je=ze,Ye=(n("3811"),Object(c["a"])(Je,We,He,!1,null,null,null)),Xe=Ye.exports,Ge=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{"message-operations":!0,incoming:t.incoming,outgoing:!t.incoming}},[n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.addReaction(e)}}},[n("v-icon",[t._v("mood")])],1),t.incoming?n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.addReply(e)}}},[n("v-icon",[t._v("reply")])],1):t._e(),t.isEditable?n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.edit(e)}}},[n("v-icon",[t._v("edit")])],1):t._e(),t.isRedactable?n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.redact(e)}}},[n("v-icon",[t._v("delete")])],1):t._e(),t.isDownloadable?n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.download(e)}}},[n("v-icon",[t._v("get_app")])],1):t._e()],1)},qe=[],Qe={mixins:[K],props:{incoming:{type:Boolean,default:function(){return!0}},event:{type:Object,default:function(){return{}}}},computed:{isEditable:function(){return!this.incoming&&"m.text"==this.event.getContent().msgtype},isDownloadable:function(){var t=this.event.getContent().msgtype;return["m.video","m.audio","m.image","m.file"].includes(t)},isRedactable:function(){var t=this.$matrix.matrixClient.getRoom(this.event.getRoomId());return!!(t&&t.currentState&&t.currentState.maySendRedactionForEvent(this.event,this.$matrix.currentUserId))}},methods:{addReaction:function(){this.$emit("close"),this.$emit("addreaction",{event:this.event})},addReply:function(){this.$emit("close"),this.$emit("addreply",{event:this.event})},edit:function(){this.$emit("close"),this.$emit("edit",{event:this.event})},redact:function(){this.$emit("close"),this.$emit("redact",{event:this.event})},download:function(){this.$emit("close"),this.$emit("download",{event:this.event})}}},Ke=Qe,Ze=(n("9c37"),Object(c["a"])(Ke,Ge,qe,!1,null,null,null)),tn=Ze.exports;u()(Ze,{VBtn:D["a"],VIcon:nt["a"]});var en=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.room?n("v-container",{attrs:{fluid:""}},[n("v-row",{staticClass:"chat-header-row flex-nowrap"},[n("v-col",{staticClass:"chat-header-members text-start ma-0 pa-0",staticStyle:{overflow:"hidden",cursor:"pointer"},attrs:{cols:"auto"},on:{click:function(e){return e.stopPropagation(),t.onHeaderClicked(e)}}},[n("v-avatar",{staticClass:"mr-2",attrs:{size:"40"}},[n("v-img",{attrs:{src:t.room.avatar}})],1)],1),n("v-col",{staticClass:"ma-0 pa-0 flex-shrink-1 flex-nowrap",staticStyle:{overflow:"hidden",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),t.onHeaderClicked(e)}}},[n("div",{staticClass:"d-flex flex-nowrap room-name"},[t._v(t._s(t.room.summary.info.title)+" ")]),n("div",{staticClass:"num-members"},[t._v(t._s(t.memberCount)+t._s(t.memberCount>1?" members":" member"))])]),n("v-col",{staticClass:"text-end ma-0 pa-0",attrs:{cols:"auto"}},[n("v-btn",{staticClass:"leave-button",attrs:{text:""},on:{click:function(e){return e.stopPropagation(),t.leaveRoom(e)}}},[t._v("Leave")])],1)],1),n("LeaveRoomDialog",{attrs:{show:t.showLeaveConfirmation,room:t.room},on:{close:function(e){t.showLeaveConfirmation=!1}}})],1):t._e()},nn=[],on=n("dd2a"),rn={name:"ChatHeader",components:{LeaveRoomDialog:on["a"]},data:function(){return{memberCount:null,showLeaveConfirmation:!1}},mounted:function(){this.$matrix.on("Room.timeline",this.onEvent),this.updateMemberCount()},destroyed:function(){this.$matrix.off("Room.timeline",this.onEvent)},computed:{room:function(){return this.$matrix.currentRoom}},watch:{room:{handler:function(t,e){this.memberCount=t?t.getJoinedMemberCount():null}}},methods:{onEvent:function(t){t.getRoomId()===this.roomId&&"m.room.member"==t.getType()&&this.updateMemberCount()},onHeaderClicked:function(){this.$emit("header-click",{event:this.event})},updateMemberCount:function(){this.room?this.memberCount=this.room.getJoinedMemberCount():this.memberCount=0},leaveRoom:function(){this.showLeaveConfirmation=!0}}},an=rn,sn=(n("ba1e"),n("62ad")),cn=n("a523"),ln=n("0fd9"),un=Object(c["a"])(an,en,nn,!1,null,null,null),dn=un.exports;u()(un,{VAvatar:et["a"],VBtn:D["a"],VCol:sn["a"],VContainer:cn["a"],VImg:k["a"],VRow:ln["a"]});var mn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"grow",mode:"out-in"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],ref:"vrroot",class:{"voice-recorder":!0,ptt:t.ptt,row:!t.ptt}},[t.ptt?t._e():n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{staticClass:"mt-3",attrs:{align:"center"}},[n("v-col",{attrs:{cols:"4",align:"center"}},[n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.state==t.states.RECORDED,expression:"state == states.RECORDED"}],attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.redo(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("undo")])],1)],1),n("v-col",{attrs:{cols:"4",align:"center"}},[t.state==t.states.RECORDING?n("v-btn",{staticStyle:{"background-color":"white",padding:"30px"},attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.pauseRecording(e)}}},[n("v-icon",{attrs:{color:"black"}},[t._v("stop")])],1):t.state==t.states.RECORDED?n("v-btn",{staticStyle:{"background-color":"#3ae17d",padding:"30px"},attrs:{icon:"",disabled:!t.recordedFile},on:{click:function(e){return e.stopPropagation(),t.send(e)}}},[n("v-icon",{attrs:{color:"black"}},[t._v("arrow_upward")])],1):n("v-btn",{staticStyle:{"background-color":"red",padding:"30px"},attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.startRecording(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("fiber_manual_record")])],1)],1),n("v-col",{attrs:{cols:"4",align:"center"}},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.cancelRecording(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("close")])],1)],1)],1)],1),n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center"}},[n("v-col",{attrs:{cols:"3"}},[n("div",{staticClass:"recording-time"},[t._v(" "+t._s(t.recordingTime)+" ")])]),t.ptt?n("v-col",{attrs:{cols:"6"}},[n("div",{staticClass:"swipe-info"},[t._v("<< Swipe to cancel")])]):t._e()],1)],1),n("transition",{attrs:{name:"fade",mode:"out-in"}},[t.willCancel?n("div",{staticClass:"will-cancel",staticStyle:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center"}},[n("v-col",{attrs:{cols:"3"}},[n("v-icon",{attrs:{color:"white"}},[t._v("delete_outline")])],1),n("v-col",{attrs:{cols:"6"}},[n("div",{staticClass:"swipe-info"},[t._v("Release to cancel")])])],1)],1)],1):t._e()]),n("transition",{attrs:{name:"fade",mode:"out-in"}},[t.recordingLocked?n("div",{staticClass:"locked",staticStyle:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center"}},[n("v-col",{attrs:{cols:"3"}},[n("div",{staticClass:"recording-time"},[t._v(" "+t._s(t.recordingTime)+" ")])]),n("v-col",{attrs:{cols:"3"}},[n("v-btn",{staticClass:"swipe-info",attrs:{text:""},on:{click:function(e){return e.stopPropagation(),t.cancelRecording(e)}}},[t._v("Cancel")])],1),n("v-col",{attrs:{cols:"3"}},[n("v-btn",{staticClass:"swipe-info",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.stopRecording(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("stop")])],1)],1)],1)],1)],1):t._e()]),t.state==t.states.ERROR?n("div",{staticClass:"error",staticStyle:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center"}},[n("v-col",[n("div",{staticClass:"swipe-info"},[t._v("Failed to record audio")])]),n("v-col",{attrs:{align:"right"}},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.cancelRecording(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("close")])],1)],1)],1)],1)],1):t._e(),n("VoiceRecorderLock",{directives:[{name:"show",rawName:"v-show",value:t.state==t.states.RECORDING&&t.ptt,expression:"state == states.RECORDING && ptt"}],style:t.lockButtonStyle,attrs:{isLocked:t.recordingLocked}})],1)])},hn=[],vn=n("3835"),fn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{ref:"vr_lock",class:{"voice-recorder-lock":!0,locked:t.isLocked}},[n("div",{class:{thumb:!0,locked:t.isLocked}})])])},gn=[],pn={name:"VoiceRecorderLock",props:{isLocked:{type:Boolean,default:function(){return!1}}}},bn=pn,Cn=(n("21ef"),Object(c["a"])(bn,fn,gn,!1,null,null,null)),_n=Cn.exports,yn={INITIAL:"intial",RECORDING:"recording",RECORDED:"recorded",ERROR:"error"};n("121f");var xn={name:"VoiceRecorder",components:{VoiceRecorderLock:_n},props:{show:{type:Boolean,default:function(){return!1}},ptt:{type:Boolean,default:function(){return!1}},micButtonRef:{type:Object,default:function(){return null}}},data:function(){return{willCancel:!1,startCoordinateX:null,startCoordinateY:null,states:yn,state:yn.INITIAL,recordStartedAt:null,recordingTime:String.fromCharCode(160),recordTimer:null,recordingLocked:!1,recordedFile:null}},watch:{micButtonRef:function(t){if(t){var e=t.$el.getBoundingClientRect(),n=e.left,o=e.right-e.left;e=this.$refs.vrroot.parentElement.getBoundingClientRect();var i=e.right-e.left;document.documentElement.style.setProperty("--v-mic-button-left",n+"px"),document.documentElement.style.setProperty("--v-mic-button-width",o+"px"),document.documentElement.style.setProperty("--v-mic-button-container-width",i+"px");var r=o/i;document.documentElement.style.setProperty("--v-mic-button-initial-scale",r);var a=n+o/2-i/2;document.documentElement.style.setProperty("--v-mic-button-initial-translate",a+"px")}},show:function(t){t?(this.state=yn.INITIAL,this.recordedFile=null,this.ptt?(document.addEventListener("mouseup",this.mouseUp,!1),document.addEventListener("mousemove",this.mouseMove,!1),document.addEventListener("touchend",this.mouseUp,!1),document.addEventListener("touchmove",this.mouseMove,!1),this.startRecording()):(console.log("Not PTT"),this.micButtonRef.$el.style.display="none")):(document.removeEventListener("mouseup",this.mouseUp,!1),document.removeEventListener("mousemove",this.mouseMove,!1),document.removeEventListener("touchend",this.mouseUp,!1),document.removeEventListener("touchmove",this.mouseMove,!1),this.startCoordinateX=null,this.startCoordinateY=null,this.willCancel=!1,this.startCoordinateX=null,this.startCoordinateY=null,this.recordingLocked=!1,this.micButtonRef.$el.style.display="block")}},computed:{lockButtonStyle:function(){var t=0,e=20;if(this.micButtonRef){var n=this.micButtonRef.$el.getBoundingClientRect();t=n.left,e=n.right-n.left}var o="position:absolute;top:-50px;left:"+t+"px;width:"+e+"px;height:40px";return o}},methods:{close:function(){this.stopRecordTimer(),this.recordingTime=String.fromCharCode(160),this.$emit("close")},mouseUp:function(t){document.removeEventListener("mouseup",this.mouseUp,!1),document.removeEventListener("mousemove",this.mouseMove,!1),document.removeEventListener("touchend",this.mouseUp,!1),document.removeEventListener("touchmove",this.mouseMove,!1),this.state==yn.RECORDING?this.recordingLocked||(this.willCancel?this.cancelRecording():this.stopRecording()):this.cancelRecording()},mouseMove:function(t){var e=t.clientX,n=t.clientY;t.touches&&t.touches.length>0&&(e=t.touches[0].clientX,n=t.touches[0].clientY),this.startCoordinateX||(this.startCoordinateX=e,this.startCoordinateY=n),this.willCancel=e<this.startCoordinateX-30,n<this.startCoordinateY-30&&!this.willCancel&&(this.recordingLocked=!0),t.preventDefault(),t.stopPropagation()},startRecording:function(){var t=this,e=n("9de0");this.recorder=new e({bitRate:32}),this.recorder.start().then((function(){t.state=yn.RECORDING,t.recordStartedAt=Date.now(),t.startRecordTimer()})).catch((function(e){console.error(e),t.state=yn.ERROR}))},cancelRecording:function(){this.state=yn.INITIAL,this.recorder&&this.recorder.stop(),this.stopRecordTimer(),this.recordingTime=String.fromCharCode(160),this.close()},pauseRecording:function(){this.state=yn.RECORDED,this.stopRecordTimer(),this.getFile(!1)},stopRecording:function(){this.state=yn.RECORDED,this.stopRecordTimer(),this.recordingTime=String.fromCharCode(160),this.close(),this.getFile(!0)},redo:function(){this.state=yn.INITIAL,this.recordedFile=null,this.recordingTime=String.fromCharCode(160)},send:function(){this.$emit("file",{file:this.recordedFile})},getFile:function(t){var e=this;this.recorder.stop().getMp3().then((function(n){var o=Object(vn["a"])(n,2),i=o[0],r=o[1];e.recordedFile=new File(i,x["a"].formatRecordStartTime(e.recordStartedAt)+".mp3",{type:r.type,lastModified:Date.now()}),t&&e.send()})).catch((function(t){alert("We could not retrieve your message"),console.log(t)}))},startRecordTimer:function(){var t=this;this.stopRecordTimer(),this.recordingTime=String.fromCharCode(160),this.recordTimer=setInterval((function(){var e=Date.now();t.recordingTime=x["a"].formatRecordDuration(e-t.recordStartedAt)}),500)},stopRecordTimer:function(){this.recordTimer&&(clearInterval(this.recordTimer),this.recordTimer=null)}}},wn=xn,Rn=(n("decf"),n("60c0"),Object(c["a"])(wn,mn,hn,!1,null,null,null)),kn=Rn.exports;u()(Rn,{VBtn:D["a"],VCol:sn["a"],VContainer:cn["a"],VIcon:nt["a"],VRow:ln["a"]});var In=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("SwipeableBottomSheet",{ref:"roomInfoSheet",staticClass:"bottom-sheet",attrs:{halfY:.5,openY:.1,"data-closed":t.closed?1:0}},[n("div",{ref:"roomInfoSheetContent",staticClass:"room-info-sheet"},[n("div",{staticClass:"text-center current-room"},[n("v-avatar",{staticClass:"room-avatar"},[t.roomAvatar?n("v-img",{attrs:{src:t.roomAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.roomName.substring(0,1).toUpperCase()))])],1),n("div",{staticClass:"h4"},[t._v("This group")]),n("div",{staticClass:"h2"},[t._v(t._s(t.roomName))]),n("v-btn",{staticClass:"filled-button",attrs:{height:"20px",color:"black"},on:{click:function(e){return e.stopPropagation(),t.showDetails(e)}}},[t._v("View details")])],1),n("room-list",{attrs:{title:"Other groups"},on:{close:t.close}})],1)])},Tn=[],En=n("3776"),Sn=n("241d"),$n={name:"RoomInfoBottomSheet",mixins:[Sn["a"]],components:{SwipeableBottomSheet:En["a"],RoomList:P},data:function(){return{closed:!0}},mounted:function(){var t=this;this.$watch("$refs.roomInfoSheet.state",(function(e,n){t.closed="close"==e}))},methods:{open:function(){"half"==this.$refs.roomInfoSheet.state?this.$refs.roomInfoSheet.setState("close"):(this.$refs.roomInfoSheetContent.parentElement.scrollTop=0,this.$refs.roomInfoSheet.setState("half"))},close:function(){this.$refs.roomInfoSheet.setState("close")},showDetails:function(){this.close(),this.$navigation.push({name:"RoomInfo"})}}},An=$n,Pn=(n("9eba"),Object(c["a"])(An,In,Tn,!1,null,null,null)),Mn=Pn.exports;u()(Pn,{VAvatar:et["a"],VBtn:D["a"],VImg:k["a"]});var On=5e3;function Dn(t){this.node=t,this.previousScrollHeightMinusTop=0,this.previousScrollTop=0,this.readyFor="up"}Dn.prototype.restore=function(){"up"===this.readyFor?this.node.scrollTop=this.node.scrollHeight-this.previousScrollHeightMinusTop:this.node.scrollTop=this.previousScrollTop},Dn.prototype.prepareFor=function(t){this.readyFor=t||"up","up"===this.readyFor?this.previousScrollHeightMinusTop=this.node.scrollHeight-this.node.scrollTop:this.previousScrollTop=this.node.scrollTop};var Ln={name:"Chat",components:{ChatHeader:dn,MessageIncomingText:it,MessageIncomingImage:ut,MessageIncomingAudio:pt,MessageIncomingVideo:Rt,MessageOutgoingText:$t,MessageOutgoingImage:Lt,MessageOutgoingAudio:Ft,MessageOutgoingVideo:Xt,ContactJoin:te,ContactLeave:ae,ContactInvited:me,ContactChanged:be,RoomNameChanged:Re,RoomTopicChanged:$e,RoomAvatarChanged:Le,RoomHistoryVisibility:Fe,DebugEvent:Xe,MessageOperations:tn,VoiceRecorder:kn,RoomInfoBottomSheet:Mn},data:function(){return{events:[],currentInput:"",typingMembers:[],timelineWindow:null,scrollPosition:null,currentImageInput:null,currentImageInputPath:null,currentSendOperation:null,currentSendProgress:null,currentSendShowSendButton:!0,currentSendError:null,showEmojiPicker:!1,selectedEvent:null,editedEvent:null,replyToEvent:null,showContextMenu:!1,showContextMenuAnchor:null,initialLoadDone:!1,showRecorder:!1,showRecorderPTT:!1,chatContainerSize:0,showScrollToEnd:!1,showNotAllowedForGuests:!1,rrTimer:null,lastRR:null}},mounted:function(){var t=this.$refs.chatContainer;this.scrollPosition=new Dn(t),this.chatContainerSize=this.$refs.chatContainerResizer.$el.clientHeight},beforeDestroy:function(){this.stopRRTimer()},destroyed:function(){this.$matrix.off("Room.timeline",this.onEvent),this.$matrix.off("RoomMember.typing",this.onUserTyping)},computed:{currentUser:function(){return this.$store.state.auth.user},room:function(){return this.$matrix.currentRoom},roomId:function(){return!this.$matrix.ready&&this.currentUser?null:this.room?this.room.roomId:this.$matrix.currentRoomId},roomAliasOrId:function(){return this.room?this.room.getCanonicalAlias()||this.room.roomId:this.$matrix.currentRoomId},readMarker:function(){return this.lastRR?this.lastRR.getId():this.fullyReadMarker||this.room.getEventReadUpTo(this.$matrix.currentUserId,!1)},fullyReadMarker:function(){var t=this.room.getAccountData("m.fully_read");return t?t.getContent().event_id:null},attachButtonDisabled:function(){return null!=this.editedEvent||null!=this.replyToEvent||this.currentInput.length>0},sendButtonDisabled:function(){return 0==this.currentInput.length},typingMembersString:function(){var t=this.typingMembers.length;return t>1?t+" members are typing":t>0?this.typingMembers[0].name+" is typing":""},opStyle:function(){var t=this.selectedEvent&&this.$refs[this.selectedEvent.getId()],e=0,n=0;if(t&&t[0]&&this.showContextMenuAnchor){var o=this.showContextMenuAnchor.getBoundingClientRect(),i=this.$refs.messageOperationsStrut.getBoundingClientRect();e=o.top-i.top,n=o.left-i.left}return"top:"+e+"px;left:"+n+"px"},canRecordAudio:function(){return x["a"].browserCanRecordAudio()}},watch:{roomId:{immediate:!0,handler:function(t,e){if(!t||t!=e){if(console.log("Chat: Current room changed to "+(t||"null")),this.$matrix.off("Room.timeline",this.onEvent),this.$matrix.off("RoomMember.typing",this.onUserTyping),this.events=[],this.timelineWindow=null,this.typingMembers=[],this.initialLoadDone=!1,this.stopRRTimer(),this.lastRR=null,!this.room)return(this.roomId&&this.roomId.startsWith("#")||this.roomId)&&this.onRoomNotJoined(),void(this.initialLoadDone=!0);this.room.hasMembershipState(this.currentUser.user_id,"join")?this.onRoomJoined(this.readMarker):this.onRoomNotJoined()}}}},methods:{onRoomJoined:function(t){var e=this;this.$matrix.on("Room.timeline",this.onEvent),this.$matrix.on("RoomMember.typing",this.onUserTyping),console.log("Read up to "+t),this.timelineWindow=new j["TimelineWindow"](this.$matrix.matrixClient,this.room.getUnfilteredTimelineSet(),{});var n=this;this.timelineWindow.load(t,20).then((function(){console.log("This is",n),n.events=n.timelineWindow.getEvents();var e=function t(){var e=n.$refs.chatContainer;return e.scrollHeight<=e.clientHeight&&n.timelineWindow&&n.timelineWindow.canPaginate(j["EventTimeline"].BACKWARDS)?n.timelineWindow.paginate(j["EventTimeline"].BACKWARDS,10,!0,5).then((function(e){return n.events=n.timelineWindow.getEvents(),e?t.call(n):Promise.reject("Failed to paginate")})):Promise.resolve("Done")}.bind(n);e().catch((function(t){console.log("ERROR "+t)})).finally((function(){n.initialLoadDone=!0,t&&n.scrollToEvent(t),n.restartRRTimer()}))})).catch((function(n){console.log("Error fetching events!",n,e),"M_UNKNOWN"==n.errcode&&t?e.onRoomJoined(null):(e.events=e.timelineWindow.getEvents(),e.initialLoadDone=!0)}))},onRoomNotJoined:function(){this.$navigation.push({name:"Join",params:{roomId:x["a"].sanitizeRoomId(this.roomAliasOrId)}},0)},touchX:function(t){return-1!==t.type.indexOf("mouse")?t.clientX:t.touches[0].clientX},touchY:function(t){return-1!==t.type.indexOf("mouse")?t.clientY:t.touches[0].clientY},touchStart:function(t,e){this.selectedEvent!=e&&(this.showContextMenu=!1),this.selectedEvent=e,this.touchStartX=this.touchX(t),this.touchStartY=this.touchY(t),this.touchTimer=setTimeout(this.touchTimerElapsed,500)},touchEnd:function(){this.touchTimer&&clearTimeout(this.touchTimer)},touchCancel:function(){this.touchTimer&&clearTimeout(this.touchTimer)},touchMove:function(t){this.touchCurrentX=this.touchX(t),this.touchCurrentY=this.touchY(t);var e=4,n=Math.abs(this.touchStartX-this.touchCurrentX)>e||Math.abs(this.touchStartY-this.touchCurrentY)>e;n&&this.touchTimer&&clearTimeout(this.touchTimer)},touchTimerElapsed:function(){this.showContextMenu=!0},handleChatContainerResize:function(t){t.ignoredWidth;var e=t.height,n=e-this.chatContainerSize;this.chatContainerSize=e;var o=this.$refs.chatContainer;n<0&&(o.scrollTop-=n)},componentForEvent:function(t){switch(t.getType()){case"m.room.member":if("join"==t.getContent().membership)return t.getPrevContent()&&"join"==t.getPrevContent().membership?be:te;if("leave"==t.getContent().membership)return ae;if("invite"==t.getContent().membership)return me;break;case"m.room.message":return t.getSender()!=this.$matrix.currentUserId?"m.image"==t.getContent().msgtype?ut:"m.audio"==t.getContent().msgtype?pt:"m.video"==t.getContent().msgtype?Rt:it:"m.image"==t.getContent().msgtype?Lt:"m.audio"==t.getContent().msgtype?Ft:"m.video"==t.getContent().msgtype?Xt:$t;case"m.room.name":return Re;case"m.room.topic":return $e;case"m.room.avatar":return Le;case"m.room.history_visibility":return Fe}return Xe},paginateBackIfNeeded:function(){var t=this;this.$nextTick((function(){var e=t.$refs.chatContainer;e.scrollHeight<=e.clientHeight&&t.handleScrolledToTop()}))},onScroll:function(t){var e=this.$refs.chatContainer;e&&(0==e.scrollTop?this.handleScrolledToTop():e.scrollHeight-e.scrollTop.toFixed(0)==e.clientHeight&&this.handleScrolledToBottom(!1),this.showScrollToEnd=e.scrollHeight-e.scrollTop.toFixed(0)>e.clientHeight,this.restartRRTimer())},onEvent:function(t){if(console.log("OnEvent",JSON.stringify(t)),t.getRoomId()===this.roomId){this.initialLoadDone&&this.paginateBackIfNeeded();var e=this.$refs.chatContainer,n=t.getSender()==this.$matrix.currentUserId;e.scrollHeight-e.scrollTop.toFixed(0)==e.clientHeight&&(n=!0),this.initialLoadDone&&t.forwardLooking&&!t.isRelation()&&this.handleScrolledToBottom(n)}},onUserTyping:function(t,e){if(e.roomId===this.roomId){if(e.typing)this.typingMembers.includes(e)||this.typingMembers.push(e);else{var n=this.typingMembers.indexOf(e);n>-1&&this.typingMembers.splice(n,1)}console.log("Typing: ",this.typingMembers)}},sendCurrentTextMessage:function(){this.currentInput.length>0&&!this.showRecorder&&(this.sendMessage(this.currentInput),this.currentInput="",this.editedEvent=null,this.replyToEvent=null)},sendMessage:function(t){t&&t.length>0&&x["a"].sendTextMessage(this.$matrix.matrixClient,this.roomId,t,this.editedEvent,this.replyToEvent).then((function(){console.log("Sent message")})).catch((function(t){console.log("Failed to send:",t)}))},showAttachmentPicker:function(){this.$refs.attachment.click()},handlePickedAttachment:function(t){var e=this;if(t.target.files&&t.target.files[0]){var n=new FileReader;n.onload=function(n){e.currentSendShowSendButton=!0,e.currentImageInput=n.target.result,e.currentImageInputPath=t.target.files[0]},n.readAsDataURL(t.target.files[0])}},onUploadProgress:function(t){t.total?this.currentSendProgress="Uploaded "+(t.loaded||0)+" of "+t.total:this.currentSendProgress="Uploaded "+(t.loaded||0)},sendAttachment:function(t){var e=this;this.currentImageInputPath&&(this.currentSendProgress=null,this.currentSendOperation=x["a"].sendImage(this.$matrix.matrixClient,this.roomId,this.currentImageInputPath,this.onUploadProgress),this.currentSendOperation.then((function(){e.currentSendOperation=null,e.currentImageInput=null,e.currentImageInputPath=null,e.currentSendProgress=null,t&&e.sendMessage(t)})).catch((function(t){e.currentSendError=t.toLocaleString(),e.currentSendOperation=null,e.currentSendProgress=null})))},cancelSendAttachment:function(){this.currentSendOperation&&this.currentSendOperation.reject("Canceled"),this.currentSendOperation=null,this.currentImageInput=null,this.currentImageInputPath=null,this.currentSendProgress=null,this.currentSendError=null},handleScrolledToTop:function(){var t=this;console.log("@top"),this.timelineWindow&&this.timelineWindow.canPaginate(j["EventTimeline"].BACKWARDS)&&this.timelineWindow.paginate(j["EventTimeline"].BACKWARDS,10,!0).then((function(e){e&&(t.scrollPosition.prepareFor("up"),t.events=t.timelineWindow.getEvents(),t.$nextTick((function(){console.log("Restore scroll!"),t.scrollPosition.restore()})))}))},handleScrolledToBottom:function(t){var e=this;console.log("@bottom"),this.timelineWindow&&this.timelineWindow.canPaginate(j["EventTimeline"].FORWARDS)&&this.timelineWindow.paginate(j["EventTimeline"].FORWARDS,10,!0).then((function(n){n&&(e.scrollPosition.prepareFor("down"),e.events=e.timelineWindow.getEvents(),e.$nextTick((function(){console.log("Restore scroll!"),e.scrollPosition.restore(),t&&e.smoothScrollToEnd()})))}))},scrollToEvent:function(t){var e=this.$refs.chatContainer,n=this.$refs[t];if(e&&n){var o=e.clientHeight/2,i=n[0].offsetTop;e.scrollTo(0,i-o)}},smoothScrollToEnd:function(){this.$nextTick((function(){var t=this.$refs.chatContainer;if(t.children.length>0){var e=t.children[t.children.length-1];console.log("Scroll into view",e),window.requestAnimationFrame((function(){e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}))}}))},addReaction:function(t){var e=t.event;this.selectedEvent=e,this.showEmojiPicker=!0},addReply:function(t){this.replyToEvent=t,this.$refs.messageInput.focus()},edit:function(t){this.editedEvent=t,this.currentInput=t.getContent().body,this.$refs.messageInput.focus()},redact:function(t){this.$matrix.matrixClient.redactEvent(t.getRoomId(),t.getId()).then((function(){console.log("Message redacted")})).catch((function(t){console.log("Redaction failed: ",t)}))},download:function(t){x["a"].getAttachment(this.$matrix.matrixClient,t).then((function(e){var n=document.createElement("a");n.href=e,n.target="_blank",n.download=t.getContent().body||"Download",n.click(),URL.revokeObjectURL(e)})).catch((function(t){console.log("Failed to fetch attachment: ",t)}))},cancelEditReply:function(){this.currentInput="",this.editedEvent=null,this.replyToEvent=null},emojiSelected:function(t){if(this.showEmojiPicker=!1,this.selectedEvent){var e=this.selectedEvent;this.selectedEvent=null,this.sendQuickReaction({reaction:t.data,event:e})}},sendQuickReaction:function(t){x["a"].sendQuickReaction(this.$matrix.matrixClient,this.roomId,t.reaction,t.event).then((function(){console.log("Quick reaction message")})).catch((function(t){console.log("Failed to send quick reaction:",t)}))},showContextMenuForEvent:function(t){var e=t.event,n=this.$refs[e.getId()];n&&console.log("Got the ref",n),this.selectedEvent=e,this.showContextMenu=!0,this.showContextMenuAnchor=t.anchor},viewProfile:function(){this.$navigation.push({name:"Profile"},1)},closeContextMenuIfOpen:function(t){this.showContextMenu&&(this.showContextMenu=!1,t.preventDefault())},stopRRTimer:function(){this.rrTimer&&(clearTimeout(this.rrTimer),this.rrTimer=null)},restartRRTimer:function(){this.stopRRTimer(),this.rrTimer=setTimeout(this.rrTimerElapsed,On)},rrTimerElapsed:function(){var t=this;this.rrTimer=null;var e=this.$refs.chatContainer,n=x["a"].getFirstVisibleElement(e),o=x["a"].getLastVisibleElement(e);if(n&&o){var i=n.getAttribute("eventId"),r=o.getAttribute("eventId");if(r&&this.room){var a=this.room.findEventById(r),s=this.events.indexOf(a),c=0;this.lastRR&&(c=this.lastRR.getTs());for(var l=s;l>=0;l--){if(a=this.events[l],a==this.lastRR||a.getTs()<=c)break;if(!a.getId().startsWith("~"))return void this.$matrix.matrixClient.sendReadReceipt(a).then((function(){t.$matrix.matrixClient.setRoomReadMarkers(t.room.roomId,a.getId())})).then((function(){console.log("RR sent for event: "+a.getId()),t.lastRR=a})).catch((function(t){console.log("Failed to update read marker: ",t)})).finally((function(){t.restartRRTimer()}));if(a.getId()==i)break}}}this.restartRRTimer()},showDayMarkerBeforeEvent:function(t){var e=this.events.indexOf(t);if(e<=0)return!0;var n=this.events[e-1];return x["a"].dayDiff(n.getTs(),t.getTs())>0},dayForEvent:function(t){return x["a"].formatDay(t.getTs())},showRecordingUI:function(){this.showRecorderPTT=!1,this.showRecorder=!0},startRecording:function(){this.showRecorderPTT=!0,this.showRecorder=!0},onVoiceRecording:function(t){this.currentSendShowSendButton=!1,this.currentImageInputPath=t.file;var e=void 0;this.currentInput&&this.currentInput.length>0&&(e=this.currentInput,this.currentInput=""),this.sendAttachment(e),this.showRecorder=!1}}},Vn=Ln,Un=(n("44b9"),n("b0af")),Nn=n("99d9"),jn=n("169a"),Bn=n("ce7e"),Fn=n("490a"),Wn=n("2fa4"),Hn=n("a844"),zn=Object(c["a"])(Vn,U,N,!1,null,null,null),Jn=zn.exports;u()(zn,{VBtn:D["a"],VCard:Un["a"],VCardActions:Nn["a"],VCardText:Nn["b"],VCardTitle:Nn["c"],VCol:sn["a"],VContainer:cn["a"],VDialog:jn["a"],VDivider:Bn["a"],VIcon:nt["a"],VImg:k["a"],VProgressCircular:Fn["a"],VRow:ln["a"],VSpacer:Wn["a"],VTextarea:Hn["a"]});var Yn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"join-root"},[t.waitingForInfo||t.waitingForMembership?t._e():n("div",{staticClass:"text-center"},[t.currentUser?t._e():n("v-btn",{staticClass:"btn-login",attrs:{text:"",small:"",loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handleLogin(e)}}},[t._v("Login")]),n("v-avatar",{staticClass:"join-avatar"},[t.roomAvatar?n("v-img",{attrs:{src:t.roomAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.roomName.substring(0,1).toUpperCase()))])],1),n("div",{staticClass:"join-title"},[t._v("Welcome to "+t._s(t.roomName))]),n("div",{staticClass:"join-message"}),n("v-container",{staticClass:"join-user-info"},[t.canEditProfile?n("v-row",[n("v-col",{staticClass:"flex-grow-0 flex-shrink-0"},[n("v-avatar",{on:{click:t.showAvatarPickerList}},[t.profile?n("v-img",{attrs:{src:t.profile.image}}):t._e()],1)],1),n("v-col",{staticClass:"flex-shrink-1 flex-grow-1"},[n("v-select",{ref:"avatar",attrs:{items:t.availableAvatars,"cache-items":"",label:"User name",outlined:"",dense:"",value:t.availableAvatars[0],"single-line":""},on:{change:t.selectAvatar},scopedSlots:t._u([{key:"selection",fn:function(){return[n("v-text-field",{attrs:{"background-color":"transparent",solo:"",flat:"","hide-details":""},nativeOn:{click:function(t){t.stopPropagation()}},model:{value:t.profile.name,callback:function(e){t.$set(t.profile,"name",e)},expression:"profile.name"}})]},proxy:!0},{key:"item",fn:function(e){return[n("v-avatar",{attrs:{size:"32"}},[n("v-img",{attrs:{src:e.item.image}})],1),n("div",{staticClass:"ml-2"},[t._v(t._s(e.item.name))])]}}],null,!1,1308766746)})],1)],1):n("v-row",[n("v-col",[t._v(" You are joining as: "),n("div",{staticStyle:{display:"inline-block"}},[n("v-avatar",{attrs:{color:"#e0e0e0"}},[t.userAvatar?n("v-img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])],1)],1),t._v(" "+t._s(t.userDisplayName)+" ")])],1)],1),t.currentUser?n("v-btn",{staticClass:"btn-dark",attrs:{large:"",block:"",loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handleJoin(e)}}},[t._v("Join room")]):n("v-btn",{staticClass:"btn-dark",attrs:{large:"",block:"",loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handleJoin(e)}}},[t._v("Join as guest")]),t._m(0),t.loadingMessage?n("div",[t._v(t._s(t.loadingMessage))]):t._e()],1)])},Xn=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"join-privacy"},[t._v(" Enhance your physical privacy. "),n("a",{attrs:{href:"#"}},[t._v("Learn how")])])}],Gn=(n("25f0"),n("86543")),qn=n("db90"),Qn={name:"Join",data:function(){return{roomName:null,roomAvatar:null,guestUser:new Gn["a"](qn.defaultServer,"","",!0),loading:!1,loadingMessage:null,waitingForInfo:!0,waitingForMembership:!1,availableAvatars:[],randomProfile:null,selectedProfile:null}},mounted:function(){this.$matrix.on("Room.myMembership",this.onMyMembership),this.availableAvatars=x["a"].getDefaultAvatars(),this.randomProfile=this.availableAvatars[Math.floor(Math.random()*this.availableAvatars.length)]},destroyed:function(){this.$matrix.off("Room.myMembership",this.onMyMembership)},computed:{currentUser:function(){return this.$store.state.auth.user},room:function(){return this.$matrix.currentRoom},roomId:function(){return this.room?this.room.roomId:this.$matrix.currentRoomId},roomAliasOrId:function(){return this.room?this.room.getCanonicalAlias()||this.room.roomId:this.$matrix.currentRoomId},profile:function(){return{image:(this.selectedProfile?this.selectedProfile.image:null)||this.userAvatar||this.randomProfile.image,name:(this.selectedProfile?this.selectedProfile.name:null)||this.userDisplayName||this.randomProfile.name}},canEditProfile:function(){return!this.currentUser},hasChangedAvatar:function(){return this.userAvatar!=this.profile.image},hasChangedDisplayName:function(){return this.userDisplayName!=this.profile.name},userDisplayName:function(){return this.$matrix.userDisplayName},userAvatar:function(){return this.$matrix.userAvatar?this.$matrix.matrixClient.mxcUrlToHttp(this.$matrix.userAvatar,80,80,"scale",!0):null},userAvatarLetter:function(){return this.currentUser&&this.currentUser.userId?(this.userDisplayName||this.currentUser.userId.substring(1)).substring(0,1).toUpperCase():null}},watch:{roomId:{immediate:!0,handler:function(t,e){var n=this;if(t&&(!t||t!=e)){console.log("Join: Current room changed to "+(t||"null")),this.roomName=this.roomId,this.waitingForInfo=!0;var o=this;this.waitingForMembership=!0,this.currentUser?this.getLoginPromise().then((function(){o.$matrix.setCurrentRoomId(o.roomAliasOrId);var t=o.$matrix.getRoom(o.roomAliasOrId);t&&t.hasMembershipState(o.currentUser.user_id,"join")&&o.$navigation.push({name:"Chat",params:{roomId:x["a"].sanitizeRoomId(n.roomAliasOrId)}},-1)})).catch((function(t){console.log("Error logging in: ",t)})).finally((function(){n.waitingForMembership=!1,n.getRoomInfo()})):(this.waitingForMembership=!1,this.getRoomInfo())}}}},methods:{getLoginPromise:function(){return this.$store.dispatch("auth/login",this.currentUser||this.guestUser)},getRoomInfo:function(){var t=this;if(this.roomId.startsWith("#"))this.$matrix.getPublicRoomInfo(this.roomId).then((function(e){console.log("Found room:",e),t.roomName=e.name,t.roomAvatar=e.avatar})).catch((function(t){console.log("Could not find room info",t)})).finally((function(){t.waitingForInfo=!1}));else{var e=this.$matrix.getRoom(this.roomId);e&&(this.roomName=e.name||this.roomName),this.waitingForInfo=!1}},onMyMembership:function(t,e,n){var o=this;t&&t.roomId==this.roomId&&"join"==e&&this.$nextTick((function(){o.$navigation.push({name:"Chat",params:{roomId:x["a"].sanitizeRoomId(o.roomAliasOrId)}},-1)}))},handleLogin:function(){this.$navigation.push({name:"Login"},1)},handleOpenApp:function(){console.log("Open app...")},handleJoin:function(){var t=this;return this.loading=!0,this.loadingMessage="Logging in...",this.getLoginPromise().then(function(t){return this.hasChangedDisplayName?(console.log("Join: Set display name to: "+this.profile.name),this.$matrix.matrixClient.setDisplayName(this.profile.name,void 0)):(console.log("Join: No display name change"),Promise.resolve(t))}.bind(this)).then(function(){return this.hasChangedAvatar?(console.log("Join: Updating avatar"),x["a"].setAvatar(this.$matrix.matrixClient,this.profile.image,(function(t){console.log("Progress: "+JSON.stringify(t))}))):(console.log("Join: No avatar change"),Promise.resolve("no avatar"))}.bind(this)).then(function(t){return console.log("Join: joining room"),this.loadingMessage="Joining room...",this.$matrix.matrixClient.joinRoom(this.roomId)}.bind(this)).then((function(e){t.loading=!1,t.loadingMessage=null,t.$nextTick((function(){t.$navigation.push({name:"Chat",params:{roomId:x["a"].sanitizeRoomId(t.roomAliasOrId)}},-1)}))})).catch((function(e){console.log("Failed to join room",e),t.loading=!1,t.loadingMessage=e.toString()}))},selectAvatar:function(t){this.selectedProfile=Object.assign({},t)},showAvatarPickerList:function(){this.$refs.avatar.$refs.input.click()}}},Kn=Qn,Zn=(n("3ed2"),n("b974")),to=n("8654"),eo=Object(c["a"])(Kn,Yn,Xn,!1,null,null,null),no=eo.exports;u()(eo,{VAvatar:et["a"],VBtn:D["a"],VCol:sn["a"],VContainer:cn["a"],VImg:k["a"],VRow:ln["a"],VSelect:Zn["a"],VTextField:to["a"]});var oo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login-root"},[t.showBackArrow?n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.$navigation.pop(e)}}},[n("v-icon",[t._v("arrow_back")])],1):t._e(),n("div",{staticClass:"text-center",attrs:{color:"rgba(255,255,255,0.1)"}},[n("div",{staticClass:"h2"},[t._v("Login")]),n("v-form",{model:{value:t.isValid,callback:function(e){t.isValid=e},expression:"isValid"}},[n("v-text-field",{attrs:{label:"Username",color:"black","background-color":"white",outlined:"",rules:[function(t){return!!t||"Username is required"}],error:null!=t.userErrorMessage,"error-messages":t.userErrorMessage,required:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$refs.password.focus()}},model:{value:t.user.user_id,callback:function(e){t.$set(t.user,"user_id",e)},expression:"user.user_id"}}),n("v-text-field",{ref:"password",attrs:{label:"Password",color:"black","background-color":"white",outlined:"",type:"password",rules:[function(t){return!!t||"Password is required"}],error:null!=t.passErrorMessage,"error-messages":t.passErrorMessage,required:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:function(){t.isValid&&!t.loading&&t.handleLogin()}()}},model:{value:t.user.password,callback:function(e){t.$set(t.user,"password",e)},expression:"user.password"}}),n("v-btn",{attrs:{disabled:!t.isValid||t.loading,primary:"",large:"",block:"",loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handleLogin(e)}}},[t._v("Login")])],1)],1)],1)},io=[],ro={name:"Login",data:function(){return{user:new Gn["a"](qn.defaultServer,"",""),isValid:!0,loading:!1,message:"",userErrorMessage:null,passErrorMessage:null}},computed:{loggedIn:function(){return this.$store.state.auth.status.loggedIn},currentUser:function(){return this.$store.state.auth.user},showBackArrow:function(){return this.$navigation&&this.$navigation.canPop()}},created:function(){this.loggedIn&&this.$navigation.push({name:"Chat",params:{roomId:x["a"].sanitizeRoomId(this.$matrix.currentRoomId)}},-1)},watch:{user:{handler:function(){this.userErrorMessage=null,this.passErrorMessage=null},deep:!0},message:function(){this.message&&this.message.toLowerCase().includes("user")?this.userErrorMessage=this.message:this.userErrorMessage=null,this.message&&this.message.toLowerCase().includes("pass")?this.passErrorMessage=this.message:this.passErrorMessage=null}},methods:{handleLogin:function(){var t=this;if(this.user.user_id&&this.user.password){this.message=null;var e=Object.assign({},this.user);e.normalize(),this.loading=!0,this.$store.dispatch("auth/login",e).then((function(){t.$matrix.currentRoomId?t.$navigation.push({name:"Chat",params:{roomId:x["a"].sanitizeRoomId(t.$matrix.currentRoomId)}},-1):t.$navigation.push({name:"Home"},-1)}),(function(e){t.loading=!1,t.message=e.data&&e.data.error||e.message||e.toString(),console.log("Message set to ",t.message)}))}}}},ao=ro,so=(n("5338"),n("4bd4")),co=Object(c["a"])(ao,oo,io,!1,null,null,null),lo=co.exports;u()(co,{VBtn:D["a"],VForm:so["a"],VIcon:nt["a"],VTextField:to["a"]});var uo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.user?n("div",{staticClass:"profile"},[n("div",{staticClass:"chat-header"},[n("v-container",{attrs:{fluid:""}},[n("div",{staticClass:"room-name"},[t._v("My Profile")]),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.$navigation&&t.$navigation.canPop(),expression:"$navigation && $navigation.canPop()"}],staticClass:"back",attrs:{text:""},on:{click:function(e){return e.stopPropagation(),t.$navigation.pop(e)}}},[n("v-icon",[t._v("close")])],1)],1)],1),n("v-container",{staticClass:"user-info"},[n("v-row",[n("v-col",{staticClass:"flex-grow-0 flex-shrink-0"},[n("v-avatar",{staticClass:"avatar",attrs:{size:"48",color:"#e0e0e0"}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])])],1),n("v-col",{staticClass:"flex-shrink-1 flex-grow-1"},[n("div",{staticClass:"h1"},[t._v(t._s(t.displayName))]),t.$matrix.currentUser.is_guest?n("div",[t._v(" This identity is temporary. Set a password to use it again. ")]):t._e(),n("v-btn",{staticClass:"outlined-button",attrs:{block:""},on:{click:function(e){return e.stopPropagation(),t.logout(e)}}},[t._v("Logout")])],1)],1)],1),n("div",{staticClass:"action",on:{click:function(e){t.showEditPasswordDialog=!0}}},[n("v-icon",[t._v("lock")]),n("span",[t._v("Set password")])],1),n("div",{staticClass:"action",on:{click:function(e){t.editValue=t.displayName,t.showEditDisplaynameDialog=!0}}},[n("v-icon",[t._v("edit")]),n("span",[t._v("Change name")])],1),n("v-dialog",{staticClass:"ma-0 pa-0",attrs:{width:"50%"},model:{value:t.showEditPasswordDialog,callback:function(e){t.showEditPasswordDialog=e},expression:"showEditPasswordDialog"}},[n("v-card",[n("v-card-title",[t._v("Change password")]),n("v-card-text",[t._v(" Not yet implemented. ")]),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{text:""},on:{click:function(e){t.showEditPasswordDialog=!1}}},[t._v("Cancel")]),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.showEditPasswordDialog=!1}}},[t._v("Ok")])],1)],1)],1),n("v-dialog",{staticClass:"ma-0 pa-0",attrs:{width:"50%"},model:{value:t.showEditDisplaynameDialog,callback:function(e){t.showEditDisplaynameDialog=e},expression:"showEditDisplaynameDialog"}},[n("v-card",[n("v-card-title",[t._v("Display name")]),n("v-card-text",[n("v-text-field",{model:{value:t.editValue,callback:function(e){t.editValue=e},expression:"editValue"}})],1),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{text:""},on:{click:function(e){t.showEditDisplaynameDialog=!1}}},[t._v("Cancel")]),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.setDisplayName(t.editValue),t.showEditDisplaynameDialog=!1}}},[t._v("Ok")])],1)],1)],1)],1):t._e()},mo=[],ho={name:"Profile",data:function(){return{showEditPasswordDialog:!1,showEditDisplaynameDialog:!1,editValue:null}},computed:{user:function(){return this.$matrix.matrixClient?this.$matrix.matrixClient.getUser(this.$matrix.currentUserId):null},displayName:function(){return this.user?this.user.displayName||this.user.userId:null},userAvatar:function(){return this.user&&this.user.avatarUrl?this.$matrix.matrixClient.mxcUrlToHttp(this.user.avatarUrl,80,80,"scale",!0):null},userAvatarLetter:function(){return this.user?(this.user.displayName||this.user.userId.substring(1)).substring(0,1).toUpperCase():null}},methods:{logout:function(){var t=this;this.$store.dispatch("auth/logout"),this.$nextTick((function(){t.$navigation.push({path:"/login"},-1)}))},setDisplayName:function(t){this.$matrix.matrixClient.setDisplayName(t)},upgradeAccount:function(){var t=this;this.$matrix.upgradeGuestAccount().then((function(e){return t.user=e,t.$store.dispatch("auth/login",t.user)})).then((function(){console.log("Upgrade done!")})).catch((function(t){console.log("ERROR",t)}))}}},vo=ho,fo=(n("b3d7"),Object(c["a"])(vo,uo,mo,!1,null,null,null)),go=fo.exports;u()(fo,{VAvatar:et["a"],VBtn:D["a"],VCard:Un["a"],VCardActions:Nn["a"],VCardText:Nn["b"],VCardTitle:Nn["c"],VCol:sn["a"],VContainer:cn["a"],VDialog:jn["a"],VDivider:Bn["a"],VIcon:nt["a"],VRow:ln["a"],VSpacer:Wn["a"],VTextField:to["a"]}),o["a"].use(p["a"]);var po=[{path:"/",name:"Home",component:V},{path:"/room/:roomId?",name:"Chat",component:Jn,meta:{includeRoom:!0}},{path:"/info",name:"RoomInfo",component:function(){return n.e("chunk-db74bfde").then(n.bind(null,"92df"))},props:!0,meta:{title:"Info",includeRoom:!0}},{path:"/profile",name:"Profile",component:go,meta:{title:"Profile"}},{path:"/login",name:"Login",component:lo,props:!0},{path:"/join/:roomId?",name:"Join",component:no}],bo=new p["a"]({routes:po});bo.beforeEach((function(t,e,n){var o=["/login"],i=!o.includes(t.path),r=localStorage.getItem("user");if("Chat"==t.name||"Join"==t.name){!t.params.roomId&&t.hash&&(t.params.roomId=t.hash);var a=x["a"].sanitizeRoomId(t.params.roomId);bo.app.$matrix.setCurrentRoomId(a),a&&a.startsWith("#")&&(i=!1)}i&&!r?n("/login"):n()})),bo.getRoomLink=function(t){return window.location.origin+window.location.pathname+"#/room/"+encodeURIComponent(x["a"].sanitizeRoomId(t))};var Co=bo,_o=n("2f62"),yo=n("bfa9"),xo=JSON.parse(localStorage.getItem("user")),wo=xo?{status:{loggedIn:!0},user:xo}:{status:{loggedIn:!1},user:null},Ro={namespaced:!0,state:wo,actions:{login:function(t,e){var n=t.commit;return this._vm.$matrix.login(e).then((function(t){return n("loginSuccess",t),Promise.resolve(t)}),(function(t){return n("loginFailure"),Promise.reject(t)}))},logout:function(t){var e=t.commit;this._vm.$matrix.logout(),e("logout")}},mutations:{loginSuccess:function(t,e){t.status.loggedIn=!0,t.user=e},loginFailure:function(t){t.status.loggedIn=!1,t.user=null},logout:function(t){t.status.loggedIn=!1,t.user=null},registerSuccess:function(t){t.status.loggedIn=!1},registerFailure:function(t){t.status.loggedIn=!1}}};o["a"].use(_o["a"]);var ko=new yo["a"]({key:"settings",storage:localStorage,reducer:function(t){return{currentRoomId:t.currentRoomId}}}),Io=new _o["a"].Store({state:{currentRoomId:null},mutations:{setCurrentRoomId:function(t,e){t.currentRoomId=e}},actions:{},modules:{auth:Ro},plugins:[ko.plugin]}),To=n("ba3f"),Eo=n("2909"),So={install:function(t,e){var n=[],o=null,i=void 0;e.beforeResolve((function(t,e,o){i||(n=[t],i=window.history.length),o()})),e.beforeEach((function(t,e,i){if(o&&(console.log("Nav: next routes set, going:",n,o),n=o,o=null,n.length>0))return console.log("Redirecting to",n[n.length-1]),void i(n[n.length-1]);i()}));var r={push:function(t,i){void 0===i&&(i=1),-1==i?o=[t]:0==i?(o=Object(Eo["a"])(n),o.pop(),o.push(t)):(o=Object(Eo["a"])(n),o.push(t));var r=o.length-n.length,a=o.length-1;console.log("Nav - index "+r+" Target "+a),r<0?(console.log("Nav - go "+r),e.go(r)):0==r?(console.log("Nav - replace"),n=o,o=null,e.replace(t).catch((function(t){}))):(console.log("Nav - push"),e.push(t).catch((function(t){})))},canPop:function(){return o?o.length>1:n.length>1},pop:function(){n.pop(),e.go(-1)}};t.prototype.$navigation=r}},$o=(n("d5e8"),n("d1e78"),n("79b5")),Ao=n("252c"),Po=(n("6eb0"),n("4eb5")),Mo=n.n(Po),Oo=n("0ec9"),Do=n.n(Oo),Lo=Do.a.defaults;Lo.disallowedTagsMode="recursiveEscape",Lo.allowedTags=[],o["a"].use(Do.a,Lo),o["a"].config.productionTip=!1,o["a"].use(Ao["a"]),o["a"].use($o["a"]),o["a"].use(To["a"],{store:Io}),o["a"].use(Mo.a),o["a"].use((function(t){t.prototype.$bubble=function(t){for(var e=this,n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];do{var r;(r=e).$emit.apply(r,[t].concat(o)),e=e.$parent}while(e)}})),o["a"].directive("blur",{inserted:function(t){t.onfocus=function(t){return t.target.blur()}}}),o["a"].directive("longTap",{bind:function(t,e,n){t.longTapTimeout=parseInt(e.arg||"500"),t.longTapCallbacks=e.value;for(var o=t.longTapCallbacks.length;o<2;o++)t.longTapCallbacks.splice(0,0,null);var i=function(t){return-1!==t.type.indexOf("mouse")?t.clientX:t.touches[0].clientX},r=function(t){return-1!==t.type.indexOf("mouse")?t.clientY:t.touches[0].clientY},a=function(){t.longTapHandled=!0,t.longTapCallbacks[1]&&t.longTapCallbacks[1].call(),t.longTapTimer=null,t.classList.remove("waiting-for-long-tap")},s=function(e){t.longTapHandled=!1,t.longTapStartX=i(e),t.longTapStartY=r(e),t.longTapTimer=setTimeout(a,t.longTapTimeout),t.classList.add("waiting-for-long-tap"),e.preventDefault()},c=function(){t.longTapHandled=!0,t.longTapTimer&&clearTimeout(t.longTapTimer),t.longTapTimer=null,t.classList.remove("waiting-for-long-tap")},l=function(){t.longTapTimer&&clearTimeout(t.longTapTimer),t.longTapTimer=null,t.longTapHandled||t.longTapCallbacks[0]&&t.longTapCallbacks[0].call(),t.classList.remove("waiting-for-long-tap")},u=function(e){t.longTapCurrentX=i(e),t.longTapCurrentY=r(e);var n=4,o=Math.abs(t.longTapStartX-t.longTapCurrentX)>n||Math.abs(t.longTapStartY-t.longTapCurrentY)>n;o&&c()};t.longTapTouchStart=s,t.longTapTouchEnd=l,t.longTapTouchCancel=c,t.longTapTouchMove=u,t.addEventListener("touchstart",s),t.addEventListener("touchend",l),t.addEventListener("touchcancel",c),t.addEventListener("touchmove",u),t.addEventListener("mousedown",s),t.addEventListener("mouseup",l),t.addEventListener("mousemove",u)},unbind:function(t){t.longTapTimer&&clearTimeout(t.longTapTimer),t.removeEventListener("touchstart",t.longTapTouchStart),t.removeEventListener("touchend",t.longTapTouchEnd),t.removeEventListener("touchcancel",t.longTapTouchCancel),t.removeEventListener("touchmove",t.longTapTouchMove),t.removeEventListener("mousedown",t.longTapTouchStart),t.removeEventListener("mouseup",t.longTapTouchEnd),t.removeEventListener("mousemove",t.longTapTouchMove)}}),o["a"].use(So,Co),new o["a"]({vuetify:g,router:Co,store:Io,matrix:To["a"],render:function(t){return t(v)}}).$mount("#app")},"58d3":function(t,e,n){},"5b89":function(t,e,n){t.exports=n.p+"img/av_cat.152143a7.png"},"5c0b":function(t,e,n){"use strict";n("9c0c")},"5c74":function(t,e,n){t.exports=n.p+"img/av_panda.5b6eb785.png"},6:function(t,e){},"60c0":function(t,e,n){"use strict";n("4faa")},6184:function(t,e,n){},"650e":function(t,e,n){t.exports=n.p+"img/av_tiger.d4418fd9.png"},"65af":function(t,e,n){},"6a23":function(t,e,n){t.exports=n.p+"img/av_osprey.0ee2ef1c.png"},"6a42":function(t,e,n){"use strict";n("d4c3")},"6ba5":function(t,e,n){t.exports=n.p+"img/av_panther.bd8e1503.png"},7:function(t,e){},"720a":function(t,e,n){},"73d8":function(t,e,n){t.exports=n.p+"img/av_otter.e251be0c.png"},"768b":function(t,e,n){t.exports=n.p+"img/av_mantis.a0086bc3.png"},7740:function(t,e,n){t.exports=n.p+"img/av_bunny.2787a707.png"},7924:function(t,e,n){"use strict";n("ce25")},"7af4":function(t,e,n){t.exports=n.p+"img/av_iguna.744f7412.png"},"7e6d":function(t,e,n){t.exports=n.p+"img/av_dragonfly.08cea848.png"},"7edc":function(t,e,n){t.exports=n.p+"img/av_hummingbird.abadb545.png"},8:function(t,e){},"81a0":function(t,e,n){t.exports=n.p+"img/av_turtle.80b5d008.png"},"83ed":function(t,e,n){t.exports=n.p+"img/av_orangutan.31fa41b2.png"},86543:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));n("caad"),n("ac1f"),n("2532"),n("1276"),n("2ca0");var o=n("d4ec"),i=n("bee2"),r=n("ade3"),a=function(){function t(e,n,i,a){Object(o["a"])(this,t),Object(r["a"])(this,"normalize",(function(){if(this.user_id.startsWith("@")&&this.user_id.includes(":")){var t=this.user_id.split(":");this.user_id=t[0].substring(1),this.home_server="https://"+t[1]}})),this.home_server=e,this.user_id=n,this.password=i,this.is_guest=a||!1}return Object(i["a"])(t,null,[{key:"localPart",value:function(t){if(t&&t.startsWith("@")&&t.includes(":")){var e=t.split(":");return e[0].substring(1)}return t}}]),t}();Object(r["a"])(a,"homeServerUrl",(function(t){return t&&!t.startsWith("https://")?"https://"+t:t}))},8828:function(t,e,n){t.exports=n.p+"img/av_owl.711727bb.png"},"8aa7e":function(t,e,n){t.exports=n.p+"img/av_starfish.5fab06a7.png"},"8ead":function(t,e,n){t.exports=n.p+"img/av_horse.5b902952.png"},9:function(t,e){},"902b":function(t,e,n){"use strict";n("d402")},"921a":function(t,e,n){var o={"./av_baboon.png":"bcb7","./av_badger.png":"02f6","./av_bear.png":"c56a","./av_bee.png":"f46f","./av_beta.png":"0130","./av_bunny.png":"7740","./av_butterfly.png":"ebf5","./av_cardinal.png":"f3a3d","./av_cat.png":"5b89","./av_cockatoo.png":"ec1f","./av_crab.png":"a9ada","./av_crane.png":"dcc7","./av_dragonfly.png":"7e6d","./av_eagle.png":"53ed","./av_egret.png":"ad17","./av_elephant.png":"a3d9","./av_flamingo.png":"e199","./av_fox.png":"af6a","./av_gazelle.png":"9c44","./av_giraffe.png":"9968","./av_gorilla.png":"c300","./av_hedgehog.png":"1301","./av_hippo.png":"c517","./av_horse.png":"8ead","./av_hummingbird.png":"7edc","./av_iguna.png":"7af4","./av_jellyfish.png":"061b","./av_leopard.png":"2f9f","./av_lion.png":"cddb","./av_lionfish.png":"d4da","./av_lizard.png":"db7c","./av_macaw.png":"19ad","./av_mantis.png":"768b","./av_octopus.png":"03e5","./av_orangutan.png":"83ed","./av_osprey.png":"6a23","./av_otter.png":"73d8","./av_owl.png":"8828","./av_panda.png":"5c74","./av_pangolin.png":"329e","./av_panther.png":"6ba5","./av_peacock.png":"1eb2","./av_penguin.png":"e175","./av_polar bear.png":"403a","./av_puffin.png":"19df","./av_puppy.png":"b459","./av_rhino.png":"b504","./av_rooster.png":"f305","./av_shark.png":"977f","./av_sloth.png":"b74f","./av_snake.png":"5029","./av_squirrel.png":"0478","./av_starfish.png":"8aa7e","./av_stingray.png":"b302","./av_tiger.png":"650e","./av_tucan.png":"132f","./av_turtle.png":"81a0","./av_walrus.png":"2c30","./av_whaleshark.png":"e99d","./av_yak.png":"b95f","./av_zebra.png":"2f1c"};function i(t){var e=r(t);return n(e)}function r(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}i.keys=function(){return Object.keys(o)},i.resolve=r,t.exports=i,i.id="921a"},"977f":function(t,e,n){t.exports=n.p+"img/av_shark.545e47bb.png"},"97a3":function(t,e,n){},9968:function(t,e,n){t.exports=n.p+"img/av_giraffe.7af253ac.png"},"9c0c":function(t,e,n){},"9c37":function(t,e,n){"use strict";n("d43f")},"9c44":function(t,e,n){t.exports=n.p+"img/av_gazelle.4a3025c3.png"},"9cdd":function(t,e,n){"use strict";n("abbc")},"9eba":function(t,e,n){"use strict";n("4451")},a384:function(t,e,n){},a3d9:function(t,e,n){t.exports=n.p+"img/av_elephant.cbbeeff1.png"},a826:function(t,e,n){"use strict";n("97a3")},a9ada:function(t,e,n){t.exports=n.p+"img/av_crab.331519ac.png"},ab89:function(t,e,n){},abbc:function(t,e,n){},ac7e:function(t,e,n){"use strict";n("6184")},ad17:function(t,e,n){t.exports=n.p+"img/av_egret.605ff296.png"},af6a:function(t,e,n){t.exports=n.p+"img/av_fox.e790d11c.png"},b302:function(t,e,n){t.exports=n.p+"img/av_stingray.e1cf4ae1.png"},b3d7:function(t,e,n){"use strict";n("16b0")},b459:function(t,e,n){t.exports=n.p+"img/av_puppy.3b09488c.png"},b504:function(t,e,n){t.exports=n.p+"img/av_rhino.2299bc9b.png"},b74f:function(t,e,n){t.exports=n.p+"img/av_sloth.1efebb51.png"},b95f:function(t,e,n){t.exports=n.p+"img/av_yak.91a75b41.png"},ba1e:function(t,e,n){"use strict";n("2582")},ba3f:function(t,e,n){"use strict";(function(t){n("4de4"),n("7db0"),n("4160"),n("d3b7"),n("ac1f"),n("1276"),n("2ca0"),n("159b");var o=n("b85c"),i=(n("96cf"),n("1da1")),r=n("c4f4"),a=n.n(r),s=n("d930"),c=n("86543"),l=n("db90");t.Olm=n("33cd");var u=n("3366").LocalStorageCryptoStore;a.a.setCryptoStoreFactory((function(){return new u(window.localStorage)})),e["a"]={install:function(t,e){if(!e||!e.store)throw new Error("Please initialise plugin with a Vuex store.");var n=e.store,r=new t({store:n,data:function(){return{matrixClient:null,matrixClientReady:!1,rooms:[],userDisplayName:null,userAvatar:null,currentRoom:null,notificationCount:0}},mounted:function(){console.log("Matrix service mounted")},computed:{ready:function(){return null!=this.matrixClient&&this.matrixClientReady},currentUser:function(){return this.$store.state.auth.user},currentUserId:function(){var t=this.currentUser||{};return t.user_id},currentRoomId:function(){return this.$store.state.currentRoomId}},watch:{currentRoomId:{immediate:!0,handler:function(t){this.currentRoom=this.getRoom(t)}}},methods:{login:function(t){var e,n=this,o=a.a.createClient(c["a"].homeServerUrl(t.home_server));if(t.is_guest&&!t.access_token){var i=s["a"].randomUser(),r=s["a"].randomPass();e=o.register(i,r,null,{type:"m.login.dummy"}).then((function(t){return console.log("Response",t),t.password=r,t.is_guest=!0,localStorage.setItem("user",JSON.stringify(t)),t}))}else if(!t.is_guest&&t.access_token)e=Promise.resolve(t);else{var l={user:c["a"].localPart(t.user_id),password:t.password,type:"m.login.password"};t.device_id&&(l.device_id=t.device_id),e=o.login("m.login.password",l).then((function(e){var n=e;return t.is_guest&&(n=Object.assign(t,e)),localStorage.setItem("user",JSON.stringify(n)),e}))}return e.then((function(t){return n.getMatrixClient(t)}))},clearCryptoStore:function(){for(var t=[],e=0;e<localStorage.length;++e){var n=localStorage.key(e);n.startsWith("crypto.")&&t.push(n)}for(var o=0,i=t;o<i.length;o++){var r=i[o];localStorage.removeItem(r)}},logout:function(){var t=this;this.matrixClient?(this.removeMatrixClientListeners(this.matrixClient),this.matrixClient.stopClient(),this.matrixClient.clearStores().then((function(){t.clearCryptoStore()})),this.matrixClient=null,this.matrixClientReady=!1):this.clearCryptoStore(),localStorage.removeItem("user"),this.$store.commit("setCurrentRoomId",null)},upgradeGuestAccount:function(){if(!this.matrixClient||!this.currentUser||!this.currentUser.is_guest)return Promise.reject("Invalid params");var t=s["a"].randomPass(),e=this;return this.matrixClient.register(this.matrixClient.getUserIdLocalpart(),t,null,{type:"m.login.dummy"},void 0,this.currentUser.access_token).then((function(n){return console.log("Response",n),n.is_guest=!1,n.password=t,e.currentUser=n,localStorage.setItem("user",JSON.stringify(n)),e.logout(),e.currentUser}))},initClient:function(){var t=this;this.reloadRooms(),this.matrixClientReady=!0,this.matrixClient.emit("Matrix.initialized",this.matrixClient),this.matrixClient.getProfileInfo(this.currentUserId).then((function(e){console.log("Got user profile: "+JSON.stringify(e)),t.userDisplayName=e.displayname,t.userAvatar=e.avatar_url})).catch((function(t){console.log("Failed to get user profile: ",t)}))},getMatrixClient:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var o,i,r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(void 0===t&&(t=e.$store.state.auth.user),!e.matrixClientReady){n.next=5;break}return n.abrupt("return",new Promise((function(e,n){e(t)})));case 5:if(!e.matrixClient){n.next=7;break}return n.abrupt("return",new Promise((function(n,o){e.matrixClient.once("Matrix.initialized",(function(e){n(t)}))})));case 7:return o=new a.a.MemoryStore(window.localStorage),i=new a.a.WebStorageSessionStore(window.localStorage),r=t.home_server,r.startsWith("https://")||(r="https://"+r),s={baseUrl:r,userId:t.user_id,store:o,sessionStore:i,deviceId:t.device_id,accessToken:t.access_token,timelineSupport:!0,unstableClientRelationAggregation:!0},e.matrixClient=a.a.createClient(s),n.abrupt("return",e.matrixClient.initCrypto().then((function(){return console.log("Crypto initialized"),e.addMatrixClientListeners(e.matrixClient),e.matrixClient.startClient(),e.matrixClient})).then((function(t){return t.isInitialSyncComplete()?(console.log("Initial sync done already!"),t):new Promise((function(e,n){t.once("sync",(function(o,i,r){console.log(o),"PREPARED"==o?e(t):"ERROR"==o&&n("Error syncing")}))}))})).then((function(){return e.initClient(),t})));case 14:case"end":return n.stop()}}),n)})))()},addMatrixClientListeners:function(t){t&&(t.on("event",this.onEvent),t.on("Room",this.onRoom),t.on("Session.logged_out",this.onSessionLoggedOut))},removeMatrixClientListeners:function(t){t&&(t.off("event",this.onEvent),t.off("Room",this.onRoom),t.off("Session.logged_out",this.onSessionLoggedOut))},onEvent:function(e){switch(e.getType()){case"m.room.topic":var n=this.matrixClient.getRoom(e.getRoomId());n&&t.set(n,"topic",e.getContent().topic);break;case"m.room.avatar":var o=this.matrixClient.getRoom(e.getRoomId());o&&t.set(o,"avatar",o.getAvatarUrl(this.matrixClient.getHomeserverUrl(),80,80,"scale",!0));break}this.updateNotificationCount()},onRoom:function(t){console.log("Got room: "+t),this.reloadRooms(),this.updateNotificationCount()},onSessionLoggedOut:function(){console.log("Logged out!"),this.matrixClient&&(this.removeMatrixClientListeners(this.matrixClient),this.matrixClient.stopClient(),this.matrixClient=null,this.matrixClientReady=!1),this.$store.commit("setCurrentRoomId",null);var t=JSON.parse(localStorage.getItem("user"));t&&delete t.access_token,localStorage.setItem("user",JSON.stringify(t)),this.$navigation.push({name:"Login"},-1)},reloadRooms:function(){var e=this,n=this.matrixClient.getVisibleRooms();n=n.filter((function(t){return t._selfMembership&&("invite"==t._selfMembership||"join"==t._selfMembership)})),n.forEach((function(n){n.avatar||t.set(n,"avatar",n.getAvatarUrl(e.matrixClient.getHomeserverUrl(),80,80,"scale",!0))})),console.log("Reload rooms",n),t.set(this,"rooms",n);var o=this.getRoom(this.$store.state.currentRoomId);this.currentRoom!=o&&(this.currentRoom=o)},setCurrentRoomId:function(t){this.$store.commit("setCurrentRoomId",t),this.currentRoom=this.getRoom(t)},getRoom:function(t){if(!t)return null;var e=null;if(this.matrixClient){var n=this.matrixClient.getRooms();e=n.find((function(e){return t.startsWith("#")?e.getCanonicalAlias()==t:e.roomId==t}))}return e||null},leaveRoom:function(t){var e=this;return this.matrixClient.leave(t,void 0).then((function(){e.rooms=e.rooms.filter((function(t){t.roomId})),e.matrixClient.store.removeRoom(t)}))},on:function(t,e){this.matrixClient&&this.matrixClient.on(t,e)},off:function(t,e){this.matrixClient&&this.matrixClient.off(t,e)},uploadFile:function(t,e){return this.matrixClient.uploadContent(t,e)},getPublicRoomInfo:function(t){var e=this;if(!t)return Promise.reject("Invalid parameters");var n=t.split(":");if(2!=n.length)return Promise.reject("Unknown room server");var i,r=n[1];if(this.matrixClient)i=this.getMatrixClient().then((function(){return e.matrixClient}));else{var u=a.a.createClient(l.defaultServer),d=localStorage.getItem("tempuser"),m=null;if(d&&(m=JSON.parse(d)),m)i=Promise.resolve(m);else{var h=s["a"].randomUser(),v=s["a"].randomPass();i=u.register(h,v,null,{type:"m.login.dummy"}).then((function(t){return console.log("Response",t),t.password=v,t.is_guest=!0,localStorage.setItem("tempuser",JSON.stringify(t)),t}))}i=i.then((function(t){var e={user:c["a"].localPart(t.user_id),password:t.password,type:"m.login.password"};return t.device_id&&(e.device_id=t.device_id),u.login("m.login.password",e)})),i=i.then((function(t){var e={baseUrl:l.defaultServer,userId:t.user_id,accessToken:t.access_token,timelineSupport:!1},n=a.a.createClient(e);return n.startClient(),n}))}var f,g=function e(n,i){var a,s=Object(o["a"])(i.chunk);try{for(s.s();!(a=s.n()).done;){var c=a.value;if(t.startsWith("#")&&c.canonical_alias==t||t.startsWith("!")&&c.room_id==t)return c.avatar_url&&(c.avatar=n.mxcUrlToHttp(c.avatar_url,80,80,"scale",!0)),Promise.resolve(c)}}catch(l){s.e(l)}finally{s.f()}return i.next_batch?n.publicRooms({server:r,limit:1e3,since:i.next_batch}).then((function(t){return e(n,t)})).catch((function(t){return Promise.reject("Failed to find room: "+t)})):Promise.reject("No more data")};return i.then((function(t){return f=t,f.publicRooms({server:r,limit:1e3})})).then((function(t){return g(f,t)})).catch((function(t){return Promise.reject("Failed to find room: "+t)}))},updateNotificationCount:function(){var t=0;this.rooms.forEach((function(e){t+=e.getUnreadNotificationCount("total")||0})),this.notificationCount=t}}});t.prototype.$matrix=r}}}).call(this,n("c8ba"))},bcb7:function(t,e,n){t.exports=n.p+"img/av_baboon.748ddcc3.png"},bed4:function(t,e,n){"use strict";n("c428")},c300:function(t,e,n){t.exports=n.p+"img/av_gorilla.a95f8263.png"},c302:function(t,e,n){"use strict";n("281b")},c3d5:function(t,e,n){},c428:function(t,e,n){},c517:function(t,e,n){t.exports=n.p+"img/av_hippo.26533229.png"},c56a:function(t,e,n){t.exports=n.p+"img/av_bear.f1aa8118.png"},cb20:function(t,e,n){},cba1:function(t,e,n){},cddb:function(t,e,n){t.exports=n.p+"img/av_lion.4b529348.png"},ce25:function(t,e,n){},d034:function(t,e,n){"use strict";n("2b99")},d22f:function(t,e,n){},d402:function(t,e,n){},d43f:function(t,e,n){},d4c3:function(t,e,n){},d4da:function(t,e,n){t.exports=n.p+"img/av_lionfish.a6538492.png"},d930:function(t,e,n){"use strict";(function(t){n("99af"),n("4160"),n("c975"),n("a15b"),n("d81d"),n("fb6a"),n("a434"),n("b0c0"),n("b64b"),n("d3b7"),n("ac1f"),n("25f0"),n("3ca3"),n("466d"),n("5319"),n("1276"),n("2ca0"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("ddb0"),n("2b3d");var o=n("d4ec"),i=n("bee2"),r=n("bc3a"),a=n.n(r),s=n("10fe"),c=n("5a0c"),l=n("6c27").sha256,u=n("7247"),d=n("eacf"),m=n("23ad");c.extend(m);var h=n("d772");c.extend(h);var v=function(){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return void 0!==t||navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia},f=v(),g=function(){function e(){Object(o["a"])(this,e)}return Object(i["a"])(e,[{key:"getAttachment",value:function(t,e,n){var o=this;return new Promise((function(i,r){var s=e.getContent();if(null==s.url){var c=null,l=null;s.file&&s.file.url&&(l=s.file,c=t.mxcUrlToHttp(l.url)),null==c&&r("No url found!"),a.a.get(c,{responseType:"arraybuffer",onDownloadProgress:function(t){var e=Math.floor(100*t.loaded/t.total);n&&n(e)}}).then((function(t){return o.decryptIfNeeded(l,t)})).then((function(t){i(URL.createObjectURL(new Blob([t.buffer],{type:l.mimetype})))})).catch((function(t){console.log("Download error: ",t),r(t)})).finally((function(){n&&n(null)}))}else i(t.mxcUrlToHttp(s.url))}))}},{key:"getThumbnail",value:function(t,e,n,o){var i=this;return new Promise((function(n,o){var r=e.getContent();if(null==r.url){var s=null,c=null;r&&r.info&&r.info.thumbnail_file&&r.info.thumbnail_file.url?(c=r.info.thumbnail_file,s=t.mxcUrlToHttp(c.url)):r.file&&r.file.url&&(c=r.file,s=t.mxcUrlToHttp(c.url)),null!=s?a.a.get(s,{responseType:"arraybuffer"}).then((function(t){return i.decryptIfNeeded(c,t)})).then((function(t){n(URL.createObjectURL(new Blob([t.buffer],{type:c.mimetype})))})).catch((function(t){console.log("Download error: ",t),o(t)})):o("No url found!")}else n(t.mxcUrlToHttp(r.url))}))}},{key:"decryptIfNeeded",value:function(e,n){return new Promise((function(o,i){var r=d.decode(e.key.k),a=d.decode(e.iv),s=new u.ModeOfOperation.ctr(r,new u.Counter(a)),c=new Uint8Array(n.data),m=new Uint8Array(l.create().update(c).arrayBuffer()),h=d.decode(e.hashes.sha256);if(0==t.compare(t.from(m),t.from(h.buffer))){var v=s.decrypt(c);o(v)}else i("Hashes don't match!")}))}},{key:"sendTextMessage",value:function(t,e,n,o,i){var r=s["makeTextMessage"](n);if(o)r["m.relates_to"]={rel_type:"m.replace",event_id:o.getId()},r["m.new_content"]={body:r.body,msgtype:r.msgtype};else if(i){r["m.relates_to"]={"m.in_reply_to":{event_id:i.getId()}};var a=i.getContent().body.split("\n").map((function(t,e){return"> "+(0==e?"<"+i.getSender()+"> ":"")+t})).join("\n");r.body=a+"\n\n"+r.body}return this.sendMessage(t,e,"m.room.message",r)}},{key:"sendQuickReaction",value:function(t,e,n,o){var i={"m.relates_to":{key:n,rel_type:"m.annotation",event_id:o.getId()}};return this.sendMessage(t,e,"m.reaction",i)}},{key:"sendMessage",value:function(t,e,n,o){return new Promise((function(i,r){t.sendEvent(e,n,o,void 0,void 0).then((function(t){console.log("Message sent: ",t),i(!0)})).catch((function(e){if(console.log("Image send error: ",e),e&&"UnknownDeviceError"==e.name){console.log("Unknown devices. Mark as known before retrying.");for(var n=[],o=0,a=Object.keys(e.devices);o<a.length;o++)for(var s=a[o],c=e.devices[s],l=0,u=Object.keys(c);l<u.length;l++){var d=u[l],m=c[d];m.known||n.push(t.setDeviceKnown(s,d,!0))}Promise.all(n).then((function(){t.resendEvent(e.event,t.getRoom(e.event.getRoomId())).then((function(t){console.log("Message sent: ",t),i(!0)})).catch((function(t){r(t.toLocaleString())}))}))}else r(e.toLocaleString())}))}))}},{key:"sendImage",value:function(e,o,i,r){var a=this;return new Promise((function(s,c){var m=new FileReader;m.onload=function(m){var h=m.target.result,v=new Uint8Array(h),f={mimetype:i.type,size:i.size},g=i.name,p="m.image";i.type.startsWith("audio/")?p="m.audio":i.type.startsWith("video/")?p="m.video":i.type.startsWith("application/pdf")&&(p="m.file");var b={type:i.type,name:g,progressHandler:r,onlyContentUri:!1},C={body:g,info:f,msgtype:p};if("m.file"==p&&(C.filename=i.name),e.isRoomEncrypted(o)){var _=n("1c46"),y=_.randomBytes(32),x=t.concat([_.randomBytes(8),t.alloc(8)]),w=new u.ModeOfOperation.ctr(y,new u.Counter(x)),R=w.encrypt(v);v=R;var k=new Uint8Array(l.create().update(v).arrayBuffer()),I={kty:"oct",key_ops:["encrypt","decrypt"],alg:"A256CTR",k:d.encode(y),ext:!0},T={mimetype:i.type,key:I,iv:t.from(x).toString("base64").replace(/=/g,""),hashes:{sha256:t.from(k).toString("base64").replace(/=/g,"")},v:"v2"};C.file=T,e.uploadContent(v,b).then((function(t){return T.url=t.content_uri,a.sendMessage(e,o,"m.room.message",C)})).then((function(t){s(t)})).catch((function(t){c(t)}))}else e.uploadContent(v,b).then((function(t){return C.url=t.content_uri,a.sendMessage(e,o,"m.room.message",C)})).then((function(t){s(t)})).catch((function(t){c(t)}))},m.onerror=function(t){c(t)},m.readAsArrayBuffer(i)}))}},{key:"randomUser",value:function(){return this.randomString(12,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}},{key:"randomPass",value:function(){return this.randomString(12,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#_-*+")}},{key:"randomString",value:function(t,e){for(var n="",o=e.length,i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*o));return n}},{key:"sanitizeRoomId",value:function(t){return t&&t.match(/^(!|#).+$/)?t:null}},{key:"getFirstVisibleElement",value:function(t){var e=this.findVisibleElements(t);return e&&e.length>0?e[0]:null}},{key:"getLastVisibleElement",value:function(t){var e=this.findVisibleElements(t);return e&&e.length>0?e[e.length-1]:null}},{key:"findVisibleElements",value:function(t){var e=this.findOneVisibleElement(t);if(e){var n=[t.children[e]],o=e-1;while(o>=0&&this.isChildVisible(t,t.children[o]))n.splice(0,0,t.children[o]),o-=1;o=e+1;while(o<t.children.length&&this.isChildVisible(t,t.children[o]))n.push(t.children[o]),o+=1;return n}return null}},{key:"isChildVisible",value:function(t,e){var n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),i=!(n.right<o.left||n.left>o.right||n.bottom<o.top||n.top>o.bottom);return i}},{key:"findOneVisibleElement",value:function(t){var e=0,n=t.children.length-1,o=t.scrollTop;while(e<=n){var i=Math.floor((e+n)/2),r=t.children[i];if(this.isChildVisible(t,r))return i;r.offsetTop<o?e=i+1:n=i-1}return null}},{key:"_importAll",value:function(t){var e=[];return t.keys().forEach((function(n){console.log("Avatar",n);var o=n.split("_")[1];o=o.slice(0,o.indexOf(".")),o=o.charAt(0).toUpperCase()+o.slice(1);var i=t(n);e.push({id:n,image:i,name:"Guest "+o})})),e}},{key:"getDefaultAvatars",value:function(){return this._importAll(n("921a"))}},{key:"setAvatar",value:function(t,e,n){return new Promise((function(o,i){a.a.get(e,{responseType:"arraybuffer"}).then((function(e){var r={type:e.headers["content-type"].split(";")[0],name:"Avatar",progressHandler:n,onlyContentUri:!1};t.uploadContent(e.data,r).then((function(e){var n=e.content_uri;return t.setAvatarUrl(n)})).then((function(t){o(t)})).catch((function(t){i(t)}))})).catch((function(t){i(t)}))}))}},{key:"dayDiff",value:function(t,e){var n=c(t).endOf("day"),o=c(e).endOf("day");return o.diff(n,"day")}},{key:"formatDay",value:function(t){var e=c(t).endOf("day"),n=c().endOf("day"),o=n.diff(e,"day");return o<1?"Today":o<2?"Yesterday":o<7?o+" days ago":e.format("L")}},{key:"formatRecordDuration",value:function(t){return c.duration(t).format("HH:mm:ss")}},{key:"formatRecordStartTime",value:function(t){var e=c(t);return e.format("lll")}},{key:"browserCanRecordAudio",value:function(){return f}}]),e}();e["a"]=new g}).call(this,n("b639").Buffer)},d9a4:function(t,e,n){"use strict";n("4060")},db7c:function(t,e,n){t.exports=n.p+"img/av_lizard.542e0b1b.png"},db90:function(t){t.exports=JSON.parse('{"defaultServer":"https://nang.zom.im"}')},dcc7:function(t,e,n){t.exports=n.p+"img/av_crane.5ebd657e.png"},dd2a:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-dialog",{directives:[{name:"show",rawName:"v-show",value:t.room,expression:"room"}],staticClass:"ma-0 pa-0",attrs:{width:"80%"},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[n("v-card",[n("v-card-title",{staticClass:"dialog-title"},[t._v("Are you sure you want to leave?")]),n("v-card-text",[n("div",{staticClass:"dialog-text"},[t._v("You may not be able to rejoin.")])]),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{text:""},on:{click:function(e){t.showDialog=!1}}},[t._v("Cancel")]),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.onLeaveRoom(),t.showDialog=!1}}},[t._v("Next")])],1)],1)],1)},i=[],r={name:"LeaveRoomDialog",props:{show:{type:Boolean,default:function(){return!1}},room:{type:Object,default:function(){return null}}},data:function(){return{showDialog:!1}},watch:{show:{handler:function(t,e){this.showDialog=t}},showDialog:function(){this.showDialog||this.$emit("close")}},methods:{onLeaveRoom:function(){var t=this,e=this.room.roomId;this.$matrix.leaveRoom(e).then((function(){console.log("Left room"),t.$navigation.push({name:"Home",params:{roomId:null}},-1)})).catch((function(t){console.log("Error leaving",t)}))}}},a=r,s=(n("d9a4"),n("2877")),c=n("6544"),l=n.n(c),u=n("8336"),d=n("b0af"),m=n("99d9"),h=n("169a"),v=n("ce7e"),f=n("2fa4"),g=Object(s["a"])(a,o,i,!1,null,null,null);e["a"]=g.exports;l()(g,{VBtn:u["a"],VCard:d["a"],VCardActions:m["a"],VCardText:m["b"],VCardTitle:m["c"],VDialog:h["a"],VDivider:v["a"],VSpacer:f["a"]})},decf:function(t,e,n){"use strict";n("c3d5")},e175:function(t,e,n){t.exports=n.p+"img/av_penguin.80792892.png"},e199:function(t,e,n){t.exports=n.p+"img/av_flamingo.6c04a0d8.png"},e7c8:function(t,e,n){"use strict";n("fad0")},e7e5:function(t,e,n){"use strict";n("d22f")},e99d:function(t,e,n){t.exports=n.p+"img/av_whaleshark.8efe40d9.png"},ebf5:function(t,e,n){t.exports=n.p+"img/av_butterfly.873f2a9e.png"},ec1f:function(t,e,n){t.exports=n.p+"img/av_cockatoo.ca3d9f21.png"},edab:function(t,e,n){"use strict";n("ef26")},ef26:function(t,e,n){},ef8b:function(t,e,n){"use strict";n("a384")},f09e:function(t,e,n){},f220:function(t,e,n){"use strict";n("cba1")},f305:function(t,e,n){t.exports=n.p+"img/av_rooster.14950a79.png"},f3a3d:function(t,e,n){t.exports=n.p+"img/av_cardinal.1ca8cd7d.png"},f46f:function(t,e,n){t.exports=n.p+"img/av_bee.33719139.png"},fad0:function(t,e,n){},ffff:function(t,e,n){"use strict";n("58d3")}});
//# sourceMappingURL=app.7bca946c.js.map