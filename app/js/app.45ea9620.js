(function(t){function e(e){for(var o,i,s=e[0],c=e[1],l=e[2],u=0,d=[];u<s.length;u++)i=s[u],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&d.push(a[i][0]),a[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);m&&m(e);while(d.length)d.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(o=!1)}o&&(r.splice(e--,1),t=c(c.s=n[0]))}return t}var o={},i={app:0},a={app:0},r=[];function s(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-0f0ce3f1":"6d5ab5c7","chunk-3bf6242b":"c94db1bb","chunk-b8c12378":"f8877c94"}[t]+".js"}function c(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(t){var e=[],n={"chunk-0f0ce3f1":1,"chunk-3bf6242b":1,"chunk-b8c12378":1};i[t]?e.push(i[t]):0!==i[t]&&n[t]&&e.push(i[t]=new Promise((function(e,n){for(var o="css/"+({}[t]||t)+"."+{"chunk-0f0ce3f1":"2c696b8e","chunk-3bf6242b":"89cc564d","chunk-b8c12378":"ccfe4992"}[t]+".css",a=c.p+o,r=document.getElementsByTagName("link"),s=0;s<r.length;s++){var l=r[s],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===o||u===a))return e()}var d=document.getElementsByTagName("style");for(s=0;s<d.length;s++){l=d[s],u=l.getAttribute("data-href");if(u===o||u===a)return e()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=e,m.onerror=function(e){var o=e&&e.target&&e.target.src||a,r=new Error("Loading CSS chunk "+t+" failed.\n("+o+")");r.code="CSS_CHUNK_LOAD_FAILED",r.request=o,delete i[t],m.parentNode.removeChild(m),n(r)},m.href=a;var v=document.getElementsByTagName("head")[0];v.appendChild(m)})).then((function(){i[t]=0})));var o=a[t];if(0!==o)if(o)e.push(o[2]);else{var r=new Promise((function(e,n){o=a[t]=[e,n]}));e.push(o[2]=r);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=s(t);var d=new Error;l=function(e){u.onerror=u.onload=null,clearTimeout(m);var n=a[t];if(0!==n){if(n){var o=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;d.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",d.name="ChunkLoadError",d.type=o,d.request=i,n[1](d)}a[t]=void 0}};var m=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(e)},c.m=t,c.c=o,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)c.d(n,o,function(e){return t[e]}.bind(null,o));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="",c.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=e,l=l.slice();for(var d=0;d<l.length;d++)e(l[d]);var m=u;r.push([3,"chunk-vendors"]),n()})({0:function(t,e){},"0130":function(t,e,n){t.exports=n.p+"img/av_beta.41c39e4d.png"},"02f6":function(t,e,n){t.exports=n.p+"img/av_badger.d4acb400.png"},"03e5":function(t,e,n){t.exports=n.p+"img/av_octopus.5212bf6b.png"},"0478":function(t,e,n){t.exports=n.p+"img/av_squirrel.d47c4b85.png"},"061b":function(t,e,n){t.exports=n.p+"img/av_jellyfish.03a9c0d4.png"},"065a":function(t,e,n){"use strict";n("f09e")},"0bce":function(t,e,n){"use strict";n("3331")},1:function(t,e){},10:function(t,e){},11:function(t,e){},12:function(t,e){},"124a":function(t,e,n){},13:function(t,e){},1301:function(t,e,n){t.exports=n.p+"img/av_hedgehog.7cb0a229.png"},"132f":function(t,e,n){t.exports=n.p+"img/av_tucan.30beb3d2.png"},14:function(t,e){},15:function(t,e){},16:function(t,e){},"16b0":function(t,e,n){},"193e":function(t,e,n){"use strict";n("b899")},"19ad":function(t,e,n){t.exports=n.p+"img/av_macaw.a05c791e.png"},"19df":function(t,e,n){t.exports=n.p+"img/av_puffin.9d99a93a.png"},"1b02":function(t,e,n){"use strict";n.r(e),e["default"]="# List your sticker pack names here, one per line\n"},"1ba1":function(t,e,n){"use strict";n("86d4")},"1eb2":function(t,e,n){t.exports=n.p+"img/av_peacock.bcef575d.png"},2:function(t,e){},"21ef":function(t,e,n){"use strict";n("720a")},"230c":function(t,e,n){},"241d":function(t,e,n){"use strict";n("b0c0");e["a"]={data:function(){return{roomJoinRule:null,userCanChangeJoinRule:!1,userCanPurgeRoom:!1}},mounted:function(){this.$matrix.on("Room.timeline",this.roomInfoMixinOnEvent),this.updatePermissions()},destroyed:function(){this.$matrix.off("Room.timeline",this.roomInfoMixinOnEvent)},computed:{room:function(){return this.$matrix.currentRoom},roomName:function(){return this.room?this.room.name:""},roomTopic:function(){return this.room?this.room.topic:""},roomAvatar:function(){return this.room?this.room.avatar:""},publicRoomLink:function(){return this.room&&"public"==this.roomJoinRule?this.$router.getRoomLink(this.room.getCanonicalAlias()||this.room.roomId):null}},watch:{room:{handler:function(t,e){this.updatePermissions()}},roomJoinRule:{handler:function(t,e){t&&e&&t!=e&&this.setRoomJoinRule(t)}}},methods:{getRoomJoinRule:function(){return this.$matrix.getRoomJoinRule(this.room)},updatePermissions:function(){if(this.room){this.roomJoinRule=this.getRoomJoinRule();var t=this.room.currentState.mayClientSendStateEvent("m.room.join_rules",this.$matrix.matrixClient)&&this.room.currentState.mayClientSendStateEvent("m.room.guest_access",this.$matrix.matrixClient);this.userCanChangeJoinRule=t,this.userCanPurgeRoom=t}else this.roomJoinRule=null,this.userCanChangeJoinRule=!1,this.userCanPurgeRoom=!1},roomInfoMixinOnEvent:function(t){t.getRoomId()===this.roomId&&("m.room.join_rules"!=t.getType()&&"m.room.guest_access"!=t.getType()||this.updatePermissions())}}}},2582:function(t,e,n){},2757:function(t,e,n){"use strict";n("43b6")},"281b":function(t,e,n){},2883:function(t,e,n){},2920:function(t,e,n){"use strict";n("2883")},"2b99":function(t,e,n){},"2c30":function(t,e,n){t.exports=n.p+"img/av_walrus.3a9e78aa.png"},"2c71":function(t,e,n){"use strict";n("84b5")},"2f1c":function(t,e,n){t.exports=n.p+"img/av_zebra.2c4af008.png"},"2f9f":function(t,e,n){t.exports=n.p+"img/av_leopard.60f857fd.png"},3:function(t,e,n){t.exports=n("56d7")},"329e":function(t,e,n){t.exports=n.p+"img/av_pangolin.366738bb.png"},3331:function(t,e,n){},3811:function(t,e,n){"use strict";n("65af")},"3ed2":function(t,e,n){"use strict";n("ab89")},4:function(t,e){},"403a":function(t,e,n){t.exports=n.p+"img/av_polar bear.3e1fa612.png"},4060:function(t,e,n){},4162:function(t,e,n){},"43b6":function(t,e,n){},4451:function(t,e,n){},"44b9":function(t,e,n){"use strict";n("cb20")},"49c5":function(t,e,n){},"4faa":function(t,e,n){},5:function(t,e){},5029:function(t,e,n){t.exports=n.p+"img/av_snake.4e6fc2ae.png"},5338:function(t,e,n){"use strict";n("230c")},"53ed":function(t,e,n){t.exports=n.p+"img/av_eagle.ffb9de18.png"},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("99af"),n("a434");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("v-main",[n("router-view")],1)],1)},a=[],r=(n("ac1f"),n("5319"),{name:"App",mounted:function(){"http"!=window.location.protocol?this.currentUser&&this.$matrix.login(this.currentUser).then((function(){console.log("Matrix client ready")})).catch((function(t){console.log("Error creating client",t)})):window.location.href=window.location.href.replace("http:","https:")},computed:{currentUser:function(){return this.$store.state.auth.user},title:function(){var t="Keanu Weblite";return this.$matrix.notificationCount>0&&(t+=" ["+this.$matrix.notificationCount+"]"),this.$route.meta.title&&(t+="  - "+this.$route.meta.title),this.$route.meta.includeRoom&&(this.$matrix.currentRoom?t+=" - "+(this.$matrix.currentRoom.summary.info.title||this.$matrix.currentRoom.roomId):this.$matrix.currentRoomId&&(t+=" - "+this.$matrix.currentRoomId)),t}},watch:{title:function(t){document.title=t}}}),s=r,c=(n("5c0b"),n("2877")),l=n("6544"),u=n.n(l),d=n("7496"),m=n("f6c4"),v=Object(c["a"])(s,i,a,!1,null,null,null),h=v.exports;u()(v,{VApp:d["a"],VMain:m["a"]});var f=n("f309");o["a"].use(f["a"]);var p=new f["a"]({icons:{iconfont:"md"}}),g=(n("d3b7"),n("3ca3"),n("ddb0"),n("caad"),n("b0c0"),n("2ca0"),n("8c4f")),b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"pa-4"},[n("RoomList",{attrs:{showInvites:""}}),n("v-btn",{staticClass:"outlined-button",attrs:{block:"",depressed:""},on:{click:function(e){return e.stopPropagation(),t.logout(e)}}},[t._v("Logout")]),t.loading?n("v-container",{staticStyle:{position:"absolute","background-color":"rgba(0,0,0,0.2)"},attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center",justify:"center"}},[n("v-col",{staticClass:"text-center"},[n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)],1)],1):t._e()],1)},_=[],C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list",{staticClass:"room-list",attrs:{dense:""}},[t.showInvites?n("div",{staticClass:"h4"},[t._v(t._s(t.invitesTitle))]):t._e(),t.showInvites?n("v-list-item-group",{attrs:{color:"primary"},model:{value:t.currentRoomId,callback:function(e){t.currentRoomId=e},expression:"currentRoomId"}},[n("v-slide-y-transition",{attrs:{group:""}},t._l(t.$matrix.invites,(function(e){return n("v-list-item",{key:e.roomId,attrs:{disabled:t.roomsProcessing[e.roomId],value:e.roomId}},[n("v-list-item-avatar",{attrs:{size:"40",color:"#e0e0e0"}},[n("v-img",{attrs:{src:e.avatar}})],1),n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(e.name||e.summary.info.title))]),n("v-list-item-subtitle",[t._v(t._s(e.topic))])],1),n("v-list-item-action",[n("v-btn",{attrs:{icon:""},on:{click:function(n){return n.stopPropagation(),t.acceptInvitation(e)}}},[n("v-icon",[t._v("check_circle")])],1),n("v-btn",{attrs:{icon:""},on:{click:function(n){return n.stopPropagation(),t.rejectInvitation(e)}}},[n("v-icon",[t._v("cancel")])],1)],1)],1)})),1)],1):t._e(),n("div",{staticClass:"h4"},[t._v(t._s(t.title))]),n("v-list-item-group",{attrs:{color:"primary"},model:{value:t.currentRoomId,callback:function(e){t.currentRoomId=e},expression:"currentRoomId"}},t._l(t.$matrix.joinedRooms,(function(e){return n("v-list-item",{key:e.roomId,attrs:{value:e.roomId}},[n("v-list-item-avatar",{attrs:{size:"40",color:"#e0e0e0"}},[n("v-img",{attrs:{src:e.avatar}})],1),n("div",{staticClass:"room-list-notification-count"},[t._v(t._s(t.notificationCount(e)))]),n("v-list-item-content",[n("v-list-item-title",[t._v(t._s(e.summary.info.title))]),n("v-list-item-subtitle",[t._v(t._s(e.topic))])],1)],1)})),1)],1)},y=[],w=n("d930"),x={name:"RoomList",props:{title:{type:String,default:"Rooms"},invitesTitle:{type:String,default:"Invites"},showInvites:{type:Boolean,default:!1}},data:function(){return{currentRoomId:null,roomsProcessing:{}}},methods:{notificationCount:function(t){return t.getUnreadNotificationCount("total")||0},acceptInvitation:function(t){var e=this;o["a"].set(this.roomsProcessing,t.roomId,!0),this.$matrix.matrixClient.joinRoom(t.roomId).then((function(n){e.$nextTick((function(){e.$navigation.push({name:"Chat",params:{roomId:w["a"].sanitizeRoomId(t.getCanonicalAlias()||t.roomId)}},-1)}))})).catch((function(t){console.error("Failed to accept invite: ",t)})).finally((function(){o["a"].delete(e.roomsProcessing,t.roomId)}))},rejectInvitation:function(t){var e=this;o["a"].set(this.roomsProcessing,t.roomId,!0),this.$matrix.leaveRoom(t.roomId).catch((function(t){console.error("Failed to reject invite: ",t)})).finally((function(){o["a"].delete(e.roomsProcessing,t.roomId)}))}},watch:{currentRoomId:function(){this.$emit("close"),this.$navigation.push({name:"Chat",params:{roomId:w["a"].sanitizeRoomId(this.currentRoomId)}},-1)}}},R=x,k=(n("edab"),n("1ba1"),n("8336")),I=n("132d"),T=n("adda"),E=n("8860"),S=n("da13"),P=n("1800"),$=n("8270"),A=n("5d23"),M=n("1baa"),O=n("0789"),L=Object(c["a"])(R,C,y,!1,null,"070dea70",null),V=L.exports;u()(L,{VBtn:k["a"],VIcon:I["a"],VImg:T["a"],VList:E["a"],VListItem:S["a"],VListItemAction:P["a"],VListItemAvatar:$["a"],VListItemContent:A["a"],VListItemGroup:M["a"],VListItemSubtitle:A["b"],VListItemTitle:A["c"],VSlideYTransition:O["e"]});var j={components:{RoomList:V},computed:{loading:function(){return!this.$matrix.ready}},methods:{logout:function(){var t=this;this.$store.dispatch("auth/logout"),this.$nextTick((function(){t.$navigation.push({path:"/login"},-1)}))}}},D=j,N=n("62ad"),U=n("a523"),B=n("490a"),F=n("0fd9"),W=Object(c["a"])(D,b,_,!1,null,null,null),z=W.exports;u()(W,{VBtn:k["a"],VCol:N["a"],VContainer:U["a"],VProgressCircular:B["a"],VRow:F["a"]});var H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chat-root fill-height d-flex flex-column",attrs:{"ma-0":"","pa-0":""}},[n("ChatHeader",{staticClass:"chat-header flex-grow-0 flex-shrink-0",on:{"header-click":function(e){return t.$refs.roomInfoSheet.open()}}}),n("div",{ref:"chatContainer",staticClass:"chat-content flex-grow-1 flex-shrink-1",staticStyle:{"overflow-x":"hidden","overflow-y":"auto"},on:{scroll:t.onScroll,click:t.closeContextMenuIfOpen}},[n("div",{ref:"messageOperationsStrut",staticClass:"message-operations-strut"},[t.selectedEvent&&t.showContextMenu?n("message-operations",{ref:"messageOperations",style:t.opStyle,attrs:{emojis:t.recentEmojis,event:t.selectedEvent},on:{close:function(e){t.showContextMenu=!1},addreaction:t.addReaction,addquickreaction:t.addQuickReaction,addreply:function(e){return t.addReply(t.selectedEvent)},edit:function(e){return t.edit(t.selectedEvent)},redact:function(e){return t.redact(t.selectedEvent)},download:function(e){return t.download(t.selectedEvent)},more:t.showMoreMessageOperations}}):t._e()],1),n("resize-observer",{ref:"chatContainerResizer",on:{notify:t.handleChatContainerResize}}),t.showCreatedRoomWelcomeHeader?n("CreatedRoomWelcomeHeader",{on:{close:t.closeCreateRoomWelcomeHeader}}):t._e(),t._l(t.events,(function(e,o){return n("div",{key:e.getId(),attrs:{eventId:e.getId()}},[t.showDayMarkerBeforeEvent(e)?n("div",{staticClass:"day-marker",attrs:{title:t.dayForEvent(e)}}):t._e(),e.isRelation()||e.isRedacted()||e.isRedaction()?t._e():n("div",{ref:e.getId(),refInFor:!0},[n("div",{staticStyle:{position:"relative","user-select":"none"},on:{touchstart:function(n){t.touchStart(n,e)},touchend:t.touchEnd,touchcancel:t.touchCancel,touchmove:t.touchMove}},[n(t.componentForEvent(e),{tag:"component",attrs:{room:t.room,event:e,nextEvent:t.events[o+1],reactions:t.timelineWindow._timelineSet.getRelationsForEvent(e.getId(),"m.annotation","m.reaction"),timelineSet:t.timelineWindow._timelineSet},on:{"send-quick-reaction":t.sendQuickReaction,"context-menu":function(e){return t.showContextMenuForEvent(e)},"own-avatar-clicked":t.viewProfile,download:function(n){return t.download(e)}}}),e.getId()==t.readMarker&&o<t.events.length-1?n("div",{staticClass:"read-marker",attrs:{title:"Unread messages"}}):t._e()],1)])])}))],2),t.room?n("v-container",{staticClass:"input-area-outer",attrs:{fluid:""}},[n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.showScrollToEnd,expression:"showScrollToEnd"}],staticClass:"scroll-to-end",attrs:{fab:"",small:"",elevation:"0",color:"black"},on:{click:function(e){return e.stopPropagation(),t.scrollToEndOfTimeline(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("arrow_downward")])],1),n("v-row",{staticClass:"ma-0 pa-0"},[t.replyToEvent?n("div",[t._v(" REPLYING TO EVENT: "+t._s(t.replyToEvent.getContent().body)+" ")]):t._e(),n("div",{staticClass:"typing"},[t._v(" "+t._s(t.typingMembersString)+" ")])]),n("v-row",{staticClass:"input-area-inner align-center"},[n("v-col",{staticClass:"flex-grow-1 flex-shrink-1 ma-0 pa-0"},[n("v-textarea",{ref:"messageInput",staticClass:"input-area-text",attrs:{height:"undefined","full-width":"","auto-grow":"",rows:"1","no-resize":"",placeholder:"Your message...","hide-details":"","background-color":"white"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),function(){t.sendCurrentTextMessage()}())}},model:{value:t.currentInput,callback:function(e){t.currentInput=e},expression:"currentInput"}})],1),t.editedEvent||t.replyToEvent?n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[n("v-btn",{attrs:{fab:"",small:"",elevation:"0",color:"black"},on:{click:function(e){return e.stopPropagation(),t.cancelEditReply(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("cancel")])],1)],1):t._e(),!t.currentInput||0==t.currentInput.length||t.showRecorder?n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[n("v-btn",{directives:[{name:"blur",rawName:"v-blur"},{name:"longTap",rawName:"v-longTap:250",value:[t.showRecordingUI,t.startRecording],expression:"[showRecordingUI, startRecording]",arg:"250"}],ref:"mic_button",staticClass:"mic-button",staticStyle:{"z-index":"10"},attrs:{fab:"",small:"",elevation:"0",disabled:!t.canRecordAudio}},[n("v-icon",{attrs:{color:t.showRecorder?"white":"black"}},[t._v("mic")])],1)],1):n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[n("v-btn",{attrs:{fab:"",small:"",elevation:"0",color:"black",disabled:t.sendButtonDisabled},on:{click:function(e){return e.stopPropagation(),t.sendCurrentTextMessage(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v(t._s(t.editedEvent?"save":"arrow_upward"))])],1)],1),t.config.useShortCodeStickers?n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[t.showRecorder?t._e():n("v-btn",{attrs:{icon:"",large:"",color:"black",disabled:t.attachButtonDisabled},on:{click:t.showStickerPicker}},[n("v-icon",{attrs:{large:""}},[t._v("face")])],1)],1):t._e(),n("v-col",{staticClass:"input-area-button text-center flex-grow-0 flex-shrink-1"},[n("label",{ref:"attachmentLabel",attrs:{icon:"",flat:""}},[t.showRecorder?t._e():n("v-btn",{attrs:{icon:"",large:"",color:"black",disabled:t.attachButtonDisabled},on:{click:t.showAttachmentPicker}},[n("v-icon",{attrs:{"x-large":""}},[t._v("add_circle_outline")])],1),n("input",{ref:"attachment",staticStyle:{display:"none"},attrs:{type:"file",name:"attachment",accept:"image/*|audio/*|video/*|application/pdf"},on:{change:function(e){return t.handlePickedAttachment(e)}}})],1)])],1),n("VoiceRecorder",{attrs:{micButtonRef:t.$refs.mic_button,ptt:t.showRecorderPTT,show:t.showRecorder},on:{close:function(e){t.showRecorder=!1},file:t.onVoiceRecording}})],1):t._e(),t.currentImageInputPath?n("div",[n("v-dialog",{staticClass:"ma-0 pa-0",attrs:{width:"50%"},model:{value:t.currentImageInputPath,callback:function(e){t.currentImageInputPath=e},expression:"currentImageInputPath"}},[n("v-card",{staticClass:"ma-0 pa-0"},[n("v-card-text",{staticClass:"ma-0 pa-0"},[t.currentImageInput?n("v-img",{staticStyle:{"max-height":"50vh"},attrs:{"aspect-ratio":1,src:t.currentImageInput,contain:""}}):t._e(),t.currentSendError?n("div",[t._v(t._s(t.currentSendError))]):n("div",[t._v(t._s(t.currentSendProgress))])],1),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",text:""},on:{click:t.cancelSendAttachment}},[t._v("Cancel")]),t.currentSendShowSendButton?n("v-btn",{attrs:{color:"primary",text:"",disabled:null!=t.currentSendOperation},on:{click:t.sendAttachment}},[t._v("Send")]):t._e()],1)],1)],1)],1):t._e(),n("MessageOperationsBottomSheet",{ref:"messageOperationsSheet",attrs:{"xv-show":"showEmojiPicker"}},[t.selectedEvent?n("MessageOperationsPicker",{attrs:{event:t.selectedEvent},on:{close:function(e){t.showEmojiPicker=!1},addreaction:t.addReaction,addquickreaction:t.addQuickReaction,addreply:function(e){return t.addReply(t.selectedEvent)},edit:function(e){return t.edit(t.selectedEvent)},redact:function(e){return t.redact(t.selectedEvent)},download:function(e){return t.download(t.selectedEvent)}}}):t._e(),n("VEmojiPicker",{ref:"emojiPicker",staticStyle:{width:"100%"},on:{select:t.emojiSelected}})],1),n("StickerPickerBottomSheet",{ref:"stickerPickerSheet",staticStyle:{"z-index":"10"},on:{selectSticker:t.sendSticker}}),n("v-dialog",{staticClass:"ma-0 pa-0",attrs:{width:"50%"},model:{value:t.showNotAllowedForGuests,callback:function(e){t.showNotAllowedForGuests=e},expression:"showNotAllowedForGuests"}},[n("v-card",[n("v-card-title",[t._v("You are logged in as a guest")]),n("v-card-text",[n("div",[t._v("Unfortunately guests are not allowed to upload files.")])]),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.showNotAllowedForGuests=!1}}},[t._v("Ok")])],1)],1)],1),!t.initialLoadDone||t.loading?n("v-container",{staticStyle:{position:"absolute","background-color":"rgba(0,0,0,0.2)"},attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center",justify:"center"}},[n("v-col",{staticClass:"text-center"},[n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)],1)],1):t._e(),n("RoomInfoBottomSheet",{ref:"roomInfoSheet"})],1)},J=[],Y=(n("b680"),n("2532"),n("2b3d"),n("18a5"),n("c4f4")),G=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"bubble"},[n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}}),t.inReplyToText?n("div",{staticClass:"original-message"},[n("div",{staticClass:"original-message-sender"},[t._v(" "+t._s(t.inReplyToSender||"Someone")+" said: ")]),n("div",{staticClass:"original-message-text",domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.inReplyToText)))}})]):t._e(),n("div",{staticClass:"message"},[n("span",{domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.messageText)))}}),t.event.replacingEventId()?n("span",{staticClass:"edit-marker"},[t._v("(edited)")]):t._e()])],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},q=[],Q=(n("1276"),n("a15b"),n("d81d"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.reactions,expression:"reactions"}],staticClass:"quick-reaction-container"},t._l(t.reactionMap,(function(e,o){return n("span",{key:o,class:{"quick-reaction":!0,sent:e.includes(t.$matrix.currentUserId)},on:{mousedown:function(e){return t.onClickEmoji(o)}}},[t._v(" "+t._s(o)+" "),n("span",{staticClass:"quick-reaction-count"},[t._v(t._s(e.length))])])})),0)}),X=[],K=n("b85c"),Z={props:{event:{type:Object,default:function(){return{}}},reactions:{type:Object,default:function(){return null}}},data:function(){return{reactionMap:{}}},beforeDestroy:function(){this.reactions&&this.reactions.off("Relations.add",this.onAddRelation)},methods:{onClickEmoji:function(t){this.$bubble("send-quick-reaction",{reaction:t,event:this.event})},onAddRelation:function(t){this.processReactions()},processReactions:function(){var t={};if(this.reactions&&this.reactions._eventsCount>0){var e,n=this.reactions.getRelations(),o=Object(K["a"])(n);try{for(o.s();!(e=o.n()).done;){var i=e.value,a=i.getRelation().key,r=i.getSender();if(t[a]){var s=t[a];s.includes(r)||s.push(r)}else t[a]=[r]}}catch(c){o.e(c)}finally{o.f()}}this.reactionMap=t}},watch:{reactions:{handler:function(t,e){e&&e.off("Relations.add",this.onAddRelation),t&&t.on("Relations.add",this.onAddRelation),this.processReactions()},immediate:!0}}},tt=Z,et=(n("f220"),Object(c["a"])(tt,Q,X,!1,null,null,null)),nt=et.exports,ot=n("74fe"),it=n("1901");ot.options.defaults.className="link",ot.options.defaults.target=null;var at={components:{QuickReactions:nt},props:{room:{type:Object,default:function(){return null}},event:{type:Object,default:function(){return{}}},nextEvent:{type:Object,default:function(){return null}},reactions:{type:Object,default:function(){return null}},timelineSet:{type:Object,default:function(){return null}}},data:function(){return{inReplyToEvent:null,inReplyToSender:null}},mounted:function(){var t=this.event.getWireContent()["m.relates_to"];if(t&&t["m.in_reply_to"]){var e=t["m.in_reply_to"].event_id;if(e&&this.timelineSet){var n=this.timelineSet.findEventById(e);n&&(this.inReplyToEvent=n,this.inReplyToSender=this.messageEventDisplayName(n))}}},computed:{incoming:function(){return this.event&&this.event.getSender()!=this.$matrix.currentUserId},showSenderAndTime:function(){if(this.nextEvent&&this.nextEvent.getSender()==this.event.getSender()){var t=this.nextEvent.event.origin_server_ts,e=this.event.event.origin_server_ts;return t-e<12e4}return!0},inReplyToText:function(){var t=this.event.getWireContent()["m.relates_to"];if(t&&t["m.in_reply_to"]){var e=this.event.getContent(),n=e.body.split("\n").reverse();while(n.length&&!n[0].startsWith("> "))n.shift();""===n[0]&&n.shift();var o=n.map((function(t){return t.replace(/^> (<.*> )?/g,"")})).reverse().join("\n");if(o)return o;if(this.inReplyToEvent){var i=this.inReplyToEvent.getContent();return i.body}return"<original text>"}return null},messageText:function(){var t=this.event.getWireContent()["m.relates_to"];if(t&&t["m.in_reply_to"]){var e=this.event.getContent(),n=e.body.split("\n");while(n.length&&n[0].startsWith("> "))n.shift();return""===n[0]&&n.shift(),n.join("\n")}return this.event.getContent().body},messageClasses:function(){return{messageIn:!0,"from-admin":this.senderIsAdminOrModerator(this.event)}},userAvatar:function(){return this.$matrix.userAvatar?this.$matrix.matrixClient.mxcUrlToHttp(this.$matrix.userAvatar,80,80,"scale",!0):null},userAvatarLetter:function(){return this.$matrix.currentUser?(this.$matrix.currentUserDisplayName||this.$matrix.currentUserId.substring(1)).substring(0,1).toUpperCase():null}},methods:{ownAvatarClicked:function(){this.$emit("own-avatar-clicked",{event:this.event})},showContextMenu:function(t){this.$emit("context-menu",{event:this.event,anchor:t})},stateEventDisplayName:function(t){if(t.getSender()==this.$matrix.currentUserId)return"You";if(this.room){var e=this.room.getMember(t.getSender());if(e)return e.name}return t.getContent().displayname||t.event.state_key},messageEventDisplayName:function(t){return this.stateEventDisplayName(t)},messageEventAvatar:function(t){if(this.room){var e=this.room.getMember(t.getSender());if(e)return e.getAvatarUrl(this.$matrix.matrixClient.getHomeserverUrl(),40,40,"scale",!0)}return null},senderIsAdminOrModerator:function(t){if(this.room){var e=this.room.getMember(t.getSender());if(e)return e.powerLevel>0}return!1},formatTime:function(t){var e=new Date;e.setTime(t);var n=new Date;return e.getDate()==n.getDate()&&e.getMonth()==n.getMonth()&&e.getFullYear()==n.getFullYear()?e.toLocaleTimeString():e.toLocaleString()},linkify:function(t){return it(t)}}},rt={mixins:[at]},st=rt,ct=(n("902b"),n("8212")),lt=Object(c["a"])(st,G,q,!1,null,null,null),ut=lt.exports;u()(lt,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"]});var dt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"bubble"},[n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}}),t.inReplyToText?n("div",{staticClass:"original-message"},[n("div",{staticClass:"original-message-sender"},[t._v(" "+t._s(t.inReplyToSender||"Someone")+" said: ")]),n("div",{staticClass:"original-message-text",domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.inReplyToText)))}})]):t._e(),n("div",{staticClass:"message"},[n("span",[t._v("File: ")]),n("span",{staticStyle:{cursor:"pointer"},domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.messageText)))},on:{click:function(e){return e.stopPropagation(),t.$emit("download")}}}),t.event.replacingEventId()?n("span",{staticClass:"edit-marker"},[t._v("(edited)")]):t._e()])],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},mt=[],vt={mixins:[at]},ht=vt,ft=(n("2c71"),Object(c["a"])(ht,dt,mt,!1,null,null,null)),pt=ft.exports;u()(ft,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"]});var gt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"bubble image-bubble"},[n("v-img",{ref:"image",attrs:{"aspect-ratio":16/9,src:t.src,cover:t.cover,contain:t.contain}}),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},bt=[],_t={mixins:[at],data:function(){return{src:null,cover:!0,contain:!1}},mounted:function(){var t=this,e=this.$refs.image.$el.clientWidth,n=9*e/16;w["a"].getThumbnail(this.$matrix.matrixClient,this.event,e,n).then((function(e){var n=t.event.getContent().info;n&&n.mimetype&&n.mimetype.startsWith("image/jp")?(t.cover=!0,t.contain=!1):(t.cover=!1,t.contain=!0),t.src=e})).catch((function(t){console.log("Failed to fetch thumbnail: ",t)}))},beforeDestroy:function(){if(this.src){var t=this.src;this.src=null,URL.revokeObjectURL(t)}}},Ct=_t,yt=(n("e7e5"),Object(c["a"])(Ct,gt,bt,!1,null,null,null)),wt=yt.exports;u()(yt,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"],VImg:T["a"]});var xt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"audio-bubble"},[n("audio",{attrs:{controls:"",src:t.src}},[t._v("Audio file")]),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},Rt=[],kt={data:function(){return{src:null,downloadProgress:null}},mounted:function(){var t=this;console.log("Mounted with event:",JSON.stringify(this.event.getContent())),w["a"].getAttachment(this.$matrix.matrixClient,this.event,(function(e){t.downloadProgress=e,console.log("Progress: "+e)})).then((function(e){t.src=e})).catch((function(t){console.log("Failed to fetch attachment: ",t)}))},beforeDestroy:function(){if(this.src){var t=this.src;this.src=null,URL.revokeObjectURL(t)}}},It={mixins:[at,kt]},Tt=It,Et=(n("9cdd"),Object(c["a"])(Tt,xt,Rt,!1,null,null,null)),St=Et.exports;u()(Et,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"]});var Pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"bubble image-bubble"},[n("v-responsive",{attrs:{"aspect-ratio":16/9,src:t.src}},[n("video",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.src,controls:""}},[t._v("Video file")]),t.downloadProgress?n("div",{staticClass:"download-overlay"},[n("div",{staticClass:"text-center download-text"},[t._v(t._s(t.downloadProgress)+"% downloaded")])]):t._e()]),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},$t=[],At={mixins:[at,kt]},Mt=At,Ot=(n("c302"),n("6b53")),Lt=Object(c["a"])(Mt,Pt,$t,!1,null,null,null),Vt=Lt.exports;u()(Lt,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"],VResponsive:Ot["a"]});var jt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.messageClasses},[n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"}},[t.messageEventAvatar(t.event)?n("img",{attrs:{src:t.messageEventAvatar(t.event)}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.messageEventDisplayName(t.event).substring(0,1).toUpperCase()))])]),n("div",{staticClass:"bubble sticker-bubble"},[n("v-img",{ref:"image",attrs:{"aspect-ratio":16/9,src:t.src,cover:t.cover,contain:t.contain}}),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),t.showSenderAndTime?n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"sender"},[t._v(t._s(t.messageEventDisplayName(t.event)))]),n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")])]):t._e()],1)},Dt=[],Nt=n("d4ec"),Ut=n("bee2"),Bt=(n("8a79"),{ordering:[]}),Ft={};try{for(var Wt=n("1b02").default,zt=Wt.split("\n"),Ht=0;Ht<zt.length;Ht++){var Jt=zt[Ht];Jt&&Jt.length>0&&!Jt.startsWith("#")&&(Bt[Jt]=[],Bt.ordering.push(Jt))}}catch(Ta){}function Yt(t){return t.keys().map((function(e){var n=e.split("/"),o=n[1],i=n[2].split(".")[0],a=t(e);void 0!==Bt[o]&&(Bt[o].push({image:a,name:i}),Ft[":"+o+"-"+i+":"]=a)}))}Yt(n("a28e"));var Gt=function(){function t(){Object(Nt["a"])(this,t)}return Object(Ut["a"])(t,[{key:"isStickerShortcode",value:function(t){if(t&&t.startsWith(":")&&t.startsWith(":")&&t.length>=5){var e=this.getStickerImage(t);return void 0!=e&&null!=e}return!1}},{key:"getStickerShortcode",value:function(t,e){return":"+t+"-"+e.name+":"}},{key:"getPacks",value:function(){return Bt.ordering}},{key:"getStickerImage",value:function(t){return t?t.length<5||!t.startsWith(":")||!t.endsWith(":")?null:Ft[t]:null}},{key:"stickersInPack",value:function(t){return Bt[t]}}]),t}(),qt=new Gt,Qt=qt,Xt={mixins:[at],data:function(){return{src:null,cover:!1,contain:!0}},mounted:function(){this.src=Qt.getStickerImage(this.event.getContent().body)}},Kt=Xt,Zt=(n("955c"),Object(c["a"])(Kt,jt,Dt,!1,null,null,null)),te=Zt.exports;u()(Zt,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"],VImg:T["a"]});var ee=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"bubble"},[n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}}),t.inReplyToText?n("div",{staticClass:"original-message"},[n("div",{staticClass:"original-message-sender"},[t._v(" "+t._s(t.inReplyToSender||"Someone")+" said: ")]),n("div",{staticClass:"original-message-text",domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.inReplyToText)))}})]):t._e(),n("div",{staticClass:"message"},[n("span",{domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.messageText)))}}),t.event.replacingEventId()?n("span",{staticClass:"edit-marker"},[t._v("(edited)")]):t._e()])],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")]),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])],1)},ne=[],oe={mixins:[at]},ie=oe,ae=(n("e7c8"),Object(c["a"])(ie,ee,ne,!1,null,null,null)),re=ae.exports;u()(ae,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"]});var se=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"bubble"},[n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}}),t.inReplyToText?n("div",{staticClass:"original-message"},[n("div",{staticClass:"original-message-sender"},[t._v(" "+t._s(t.inReplyToSender||"Someone")+" said: ")]),n("div",{staticClass:"original-message-text",domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.inReplyToText)))}})]):t._e(),n("div",{staticClass:"message"},[n("span",[t._v("File: ")]),n("span",{staticStyle:{cursor:"pointer"},domProps:{innerHTML:t._s(t.linkify(t.$sanitize(t.messageText)))},on:{click:function(e){return e.stopPropagation(),t.$emit("download")}}}),t.event.replacingEventId()?n("span",{staticClass:"edit-marker"},[t._v("(edited)")]):t._e()])],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")]),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])],1)},ce=[],le={mixins:[at]},ue=le,de=(n("b9f6"),Object(c["a"])(ue,se,ce,!1,null,null,null)),me=de.exports;u()(de,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"]});var ve=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"bubble image-bubble"},[n("v-img",{ref:"image",attrs:{"aspect-ratio":16/9,src:t.src,cover:t.cover,contain:t.contain}}),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" "),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])])],1)},he=[],fe={mixins:[at],data:function(){return{src:null,cover:!0,contain:!1}},mounted:function(){var t=this,e=this.$refs.image.$el.clientWidth,n=9*e/16;w["a"].getThumbnail(this.$matrix.matrixClient,this.event,e,n).then((function(e){var n=t.event.getContent().info;n&&n.mimetype&&n.mimetype.startsWith("image/jp")?(t.cover=!0,t.contain=!1):(t.cover=!1,t.contain=!0),t.src=e})).catch((function(t){console.log("Failed to fetch thumbnail: ",t)}))},beforeDestroy:function(){if(this.src){var t=this.src;this.src=null,URL.revokeObjectURL(t)}}},pe=fe,ge=(n("7924"),Object(c["a"])(pe,ve,he,!1,null,null,null)),be=ge.exports;u()(ge,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"],VImg:T["a"]});var _e=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"audio-bubble"},[n("audio",{attrs:{controls:"",src:t.src}},[t._v("Audio file")]),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")]),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])],1)},Ce=[],ye={mixins:[at,kt]},we=ye,xe=(n("6a42"),Object(c["a"])(we,_e,Ce,!1,null,null,null)),Re=xe.exports;u()(xe,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"]});var ke=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"bubble image-bubble"},[n("v-responsive",{staticClass:"ma-0 pa-0",attrs:{"aspect-ratio":16/9}},[n("video",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.src,controls:""}},[t._v("Video file")])]),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" ")]),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])],1)},Ie=[],Te={mixins:[at,kt]},Ee=Te,Se=(n("bed4"),Object(c["a"])(Ee,ke,Ie,!1,null,null,null)),Pe=Se.exports;u()(Se,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"],VResponsive:Ot["a"]});var $e=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageOut"},[n("div",{ref:"opbutton",staticClass:"op-button"},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.showContextMenu(t.$refs.opbutton)}}},[n("v-icon",[t._v("more_vert")])],1)],1),n("div",{staticClass:"bubble sticker-bubble"},[n("v-img",{ref:"image",attrs:{"aspect-ratio":16/9,src:t.src,cover:t.cover,contain:t.contain}}),n("QuickReactions",{attrs:{event:t.event,reactions:t.reactions}})],1),n("v-avatar",{staticClass:"avatar",attrs:{size:"32",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.ownAvatarClicked(e)}}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])]),n("div",{staticClass:"senderAndTime"},[n("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.event.event.origin_server_ts))+" "),n("div",{staticClass:"status"},[t._v(t._s(t.event.status))])])])],1)},Ae=[],Me={mixins:[at],data:function(){return{src:null,cover:!1,contain:!0}},mounted:function(){this.src=Qt.getStickerImage(this.event.getContent().body)}},Oe=Me,Le=(n("6877"),Object(c["a"])(Oe,$e,Ae,!1,null,null,null)),Ve=Le.exports;u()(Le,{VAvatar:ct["a"],VBtn:k["a"],VIcon:I["a"],VImg:T["a"]});var je=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageJoin"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" joined the chat ")])},De=[],Ne={mixins:[at]},Ue=Ne,Be=(n("2757"),Object(c["a"])(Ue,je,De,!1,null,null,null)),Fe=Be.exports,We=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageJoin"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" left the chat ")])},ze=[],He={mixins:[at]},Je=He,Ye=(n("ffff"),Object(c["a"])(Je,We,ze,!1,null,null,null)),Ge=Ye.exports,qe=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageJoin"},[t._v(" "+t._s(t.event.getContent().displayname||t.stateEventDisplayName(t.event))+" was invited to the chat... ")])},Qe=[],Xe={mixins:[at]},Ke=Xe,Ze=(n("a826"),Object(c["a"])(Ke,qe,Qe,!1,null,null,null)),tn=Ze.exports,en=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"messageJoin"},[t.displayNameChange?n("div",[t._v(" "+t._s(t.changer)+" changed display name to "+t._s(t.event.getContent().displayname)+" ")]):t._e(),t.avatarChange?n("div",[t._v(" "+t._s(t.changer)+" changed the avatar ")]):t._e()])},nn=[],on={mixins:[at],computed:{displayNameChange:function(){var t=this.event.getContent(),e=this.event.getPrevContent();return t.displayname!=e.displayname},avatarChange:function(){var t=this.event.getContent(),e=this.event.getPrevContent();return t.avatar_url!=e.avatar_url},changer:function(){return this.event.getSender()==this.$matrix.currentUserId?"You":this.displayNameChange?this.event.getPrevContent().displayname:this.stateEventDisplayName(this.event)}}},an=on,rn=(n("065a"),Object(c["a"])(an,en,nn,!1,null,null,null)),sn=rn.exports,cn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" changed room name to "+t._s(t.event.getContent().name)+" ")])},ln=[],un={mixins:[at]},dn=un,mn=(n("d034"),Object(c["a"])(dn,cn,ln,!1,null,null,null)),vn=mn.exports,hn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" changed topic to "+t._s(t.event.getContent().topic)+" ")])},fn=[],pn={mixins:[at]},gn=pn,bn=(n("2920"),Object(c["a"])(gn,hn,fn,!1,null,null,null)),_n=bn.exports,Cn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" changed the room avatar ")])},yn=[],wn={mixins:[at]},xn=wn,Rn=(n("ef8b"),Object(c["a"])(xn,Cn,yn,!1,null,null,null)),kn=Rn.exports,In=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" made room history "+t._s(t.history(t.event))+" ")])},Tn=[],En={mixins:[at],methods:{history:function(t){var e=t.getContent().history_visibility;switch(e){case"world_readable":return"readable by anyone";case"shared":return"readable to all members in the room";case"invited":return"readable to members from when they were invited";case"joined":return"readable to members from when they joined"}return e}}},Sn=En,Pn=(n("ac7e"),Object(c["a"])(Sn,In,Tn,!1,null,null,null)),$n=Pn.exports,An=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v(" "+t._s(t.stateEventDisplayName(t.event))+" made the room "+t._s(t.joinRule(t.event))+" ")])},Mn=[],On={mixins:[at],methods:{joinRule:function(t){var e=t.getContent().join_rule;switch(e){case"invite":return"invite only";case"public":return"public"}return e}}},Ln=On,Vn=(n("d2ea"),Object(c["a"])(Ln,An,Mn,!1,null,null,null)),jn=Vn.exports,Dn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statusEvent"},[t._v("Event: "+t._s(t.event.getType()))])},Nn=[],Un={mixins:[at]},Bn=Un,Fn=(n("3811"),Object(c["a"])(Bn,Dn,Nn,!1,null,null,null)),Wn=Fn.exports,zn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{"message-operations":!0,incoming:t.incoming,outgoing:!t.incoming}},[t._l(t.emojis,(function(e,o){return[o<t.maxRecents?n("v-btn",{key:e.data,staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(n){return n.stopPropagation(),t.addQuickReaction(e.data)}}},[n("span",{staticClass:"recent-emoji"},[t._v(t._s(e.data))])]):t._e()]})),t.incoming?n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.addReply(e)}}},[n("v-icon",[t._v("reply")])],1):t._e(),n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.more(e)}}},[n("v-icon",[t._v("more_horiz")])],1)],2)},Hn=[],Jn={computed:{isEditable:function(){return!this.incoming&&"m.text"==this.event.getContent().msgtype},isDownloadable:function(){var t=this.event.getContent().msgtype;return["m.video","m.audio","m.image","m.file"].includes(t)},isRedactable:function(){var t=this.$matrix.matrixClient.getRoom(this.event.getRoomId());return!!(t&&t.currentState&&t.currentState.maySendRedactionForEvent(this.event,this.$matrix.currentUserId))}},methods:{addReaction:function(){this.$emit("close"),this.$emit("addreaction",{event:this.event})},addQuickReaction:function(t){this.$emit("close"),this.$emit("addquickreaction",{event:this.event,emoji:t})},addReply:function(){this.$emit("close"),this.$emit("addreply",{event:this.event})},edit:function(){this.$emit("close"),this.$emit("edit",{event:this.event})},redact:function(){this.$emit("close"),this.$emit("redact",{event:this.event})},download:function(){this.$emit("close"),this.$emit("download",{event:this.event})},more:function(){this.$emit("close"),this.$emit("more",{event:this.event})}}},Yn={mixins:[at,Jn],data:function(){return{maxRecents:5}},props:{emojis:{type:Array,default:function(){return[]}}},watch:{emojis:{immediate:!0,handler:function(t,e){console.log("Emojis changed",t,e)}}}},Gn=Yn,qn=(n("9c37"),Object(c["a"])(Gn,zn,Hn,!1,null,null,null)),Qn=qn.exports;u()(qn,{VBtn:k["a"],VIcon:I["a"]});var Xn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{"message-operations-picker":!0,incoming:t.incoming,outgoing:!t.incoming}},[n("v-container",{attrs:{fluid:""}},[n("v-row",[t.incoming?n("v-col",[n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.addReply(e)}}},[n("v-icon",[t._v("reply")])],1),n("div",[t._v("Reply")])],1):t._e(),t.isEditable?n("v-col",[n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.edit(e)}}},[n("v-icon",[t._v("edit")])],1),n("div",[t._v("Edit")])],1):t._e(),t.isRedactable?n("v-col",[n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.redact(e)}}},[n("v-icon",[t._v("delete")])],1),n("div",[t._v("Delete")])],1):t._e(),t.isDownloadable?n("v-col",[n("v-btn",{staticClass:"ma-0 pa-0",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.download(e)}}},[n("v-icon",[t._v("get_app")])],1),n("div",[t._v("Download")])],1):t._e()],1)],1)],1)},Kn=[],Zn={mixins:[at,Jn]},to=Zn,eo=(n("819a"),Object(c["a"])(to,Xn,Kn,!1,null,null,null)),no=eo.exports;u()(eo,{VBtn:k["a"],VCol:N["a"],VContainer:U["a"],VIcon:I["a"],VRow:F["a"]});var oo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.room?n("v-container",{attrs:{fluid:""}},[n("v-row",{staticClass:"chat-header-row flex-nowrap"},[n("v-col",{staticClass:"chat-header-members text-start ma-0 pa-0",staticStyle:{overflow:"hidden",cursor:"pointer"},attrs:{cols:"auto"},on:{click:function(e){return e.stopPropagation(),t.onHeaderClicked(e)}}},[n("v-avatar",{staticClass:"mr-2",attrs:{size:"40"}},[n("v-img",{attrs:{src:t.room.avatar}})],1)],1),n("v-col",{staticClass:"ma-0 pa-0 flex-shrink-1 flex-nowrap",staticStyle:{overflow:"hidden",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),t.onHeaderClicked(e)}}},[n("div",{staticClass:"d-flex flex-nowrap room-name-inline"},[t._v(t._s(t.room.summary.info.title)+" ")]),n("div",{staticClass:"num-members"},[t._v(t._s(t.memberCount)+t._s(t.memberCount>1?" members":" member"))])]),n("v-col",{staticClass:"text-end ma-0 pa-0",attrs:{cols:"auto"}},[n("v-btn",{staticClass:"leave-button",attrs:{text:""},on:{click:function(e){return e.stopPropagation(),t.leaveRoom(e)}}},[t._v("Leave")])],1)],1),n("LeaveRoomDialog",{attrs:{show:t.showLeaveConfirmation,room:t.room},on:{close:function(e){t.showLeaveConfirmation=!1}}})],1):t._e()},io=[],ao=n("dd2a"),ro={name:"ChatHeader",components:{LeaveRoomDialog:ao["a"]},data:function(){return{memberCount:null,showLeaveConfirmation:!1}},mounted:function(){this.$matrix.on("Room.timeline",this.onEvent),this.updateMemberCount()},destroyed:function(){this.$matrix.off("Room.timeline",this.onEvent)},computed:{room:function(){return this.$matrix.currentRoom}},watch:{room:{handler:function(t,e){this.memberCount=t?t.getJoinedMemberCount():null}}},methods:{onEvent:function(t){t.getRoomId()===this.roomId&&"m.room.member"==t.getType()&&this.updateMemberCount()},onHeaderClicked:function(){this.$emit("header-click",{event:this.event})},updateMemberCount:function(){this.room?this.memberCount=this.room.getJoinedMemberCount():this.memberCount=0},leaveRoom:function(){this.showLeaveConfirmation=!0}}},so=ro,co=(n("ba1e"),Object(c["a"])(so,oo,io,!1,null,null,null)),lo=co.exports;u()(co,{VAvatar:ct["a"],VBtn:k["a"],VCol:N["a"],VContainer:U["a"],VImg:T["a"],VRow:F["a"]});var uo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"grow",mode:"out-in"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],ref:"vrroot",class:{"voice-recorder":!0,ptt:t.ptt,row:!t.ptt}},[t.ptt?t._e():n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{staticClass:"mt-3",attrs:{align:"center"}},[n("v-col",{attrs:{cols:"4",align:"center"}},[n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.state==t.states.RECORDED,expression:"state == states.RECORDED"}],attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.redo(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("undo")])],1)],1),n("v-col",{attrs:{cols:"4",align:"center"}},[t.state==t.states.RECORDING?n("v-btn",{staticStyle:{"background-color":"white",padding:"30px"},attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.pauseRecording(e)}}},[n("v-icon",{attrs:{color:"black"}},[t._v("stop")])],1):t.state==t.states.RECORDED?n("v-btn",{staticStyle:{"background-color":"#3ae17d",padding:"30px"},attrs:{icon:"",disabled:!t.recordedFile},on:{click:function(e){return e.stopPropagation(),t.send(e)}}},[n("v-icon",{attrs:{color:"black"}},[t._v("arrow_upward")])],1):n("v-btn",{staticStyle:{"background-color":"red",padding:"30px"},attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.startRecording(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("fiber_manual_record")])],1)],1),n("v-col",{attrs:{cols:"4",align:"center"}},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.cancelRecording(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("close")])],1)],1)],1)],1),n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center"}},[n("v-col",{attrs:{cols:"3"}},[n("div",{staticClass:"recording-time"},[t._v(" "+t._s(t.recordingTime)+" ")])]),t.ptt?n("v-col",{attrs:{cols:"6"}},[n("div",{staticClass:"swipe-info"},[t._v("<< Swipe to cancel")])]):t._e()],1)],1),n("transition",{attrs:{name:"fade",mode:"out-in"}},[t.willCancel?n("div",{staticClass:"will-cancel",staticStyle:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center"}},[n("v-col",{attrs:{cols:"3"}},[n("v-icon",{attrs:{color:"white"}},[t._v("delete_outline")])],1),n("v-col",{attrs:{cols:"6"}},[n("div",{staticClass:"swipe-info"},[t._v("Release to cancel")])])],1)],1)],1):t._e()]),n("transition",{attrs:{name:"fade",mode:"out-in"}},[t.recordingLocked?n("div",{staticClass:"locked",staticStyle:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center"}},[n("v-col",{attrs:{cols:"3"}},[n("div",{staticClass:"recording-time"},[t._v(" "+t._s(t.recordingTime)+" ")])]),n("v-col",{attrs:{cols:"3"}},[n("v-btn",{staticClass:"swipe-info",attrs:{text:""},on:{click:function(e){return e.stopPropagation(),t.cancelRecording(e)}}},[t._v("Cancel")])],1),n("v-col",{attrs:{cols:"3"}},[n("v-btn",{staticClass:"swipe-info",attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.stopRecording(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("stop")])],1)],1)],1)],1)],1):t._e()]),t.state==t.states.ERROR?n("div",{staticClass:"error",staticStyle:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-row",{attrs:{align:"center"}},[n("v-col",[n("div",{staticClass:"swipe-info"},[t._v(" "+t._s(t.errorMessage||"Failed to record audio")+" ")])]),n("v-col",{attrs:{align:"right"}},[n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.cancelRecording(e)}}},[n("v-icon",{attrs:{color:"white"}},[t._v("close")])],1)],1)],1)],1)],1):t._e(),n("VoiceRecorderLock",{directives:[{name:"show",rawName:"v-show",value:t.state==t.states.RECORDING&&t.ptt,expression:"state == states.RECORDING && ptt"}],style:t.lockButtonStyle,attrs:{isLocked:t.recordingLocked}})],1)])},mo=[],vo=n("1da1"),ho=(n("96cf"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{ref:"vr_lock",class:{"voice-recorder-lock":!0,locked:t.isLocked}},[n("div",{class:{thumb:!0,locked:t.isLocked}})])])}),fo=[],po={name:"VoiceRecorderLock",props:{isLocked:{type:Boolean,default:function(){return!1}}}},go=po,bo=(n("21ef"),Object(c["a"])(go,ho,fo,!1,null,null,null)),_o=bo.exports,Co=n("a9ee"),yo=n.n(Co),wo=n("bea0"),xo=n.n(wo),Ro={INITIAL:"intial",RECORDING:"recording",RECORDED:"recorded",ERROR:"error"};n("121f");var ko={name:"VoiceRecorder",components:{VoiceRecorderLock:_o},props:{show:{type:Boolean,default:function(){return!1}},ptt:{type:Boolean,default:function(){return!1}},micButtonRef:{type:Object,default:function(){return null}}},data:function(){return{willCancel:!1,startCoordinateX:null,startCoordinateY:null,states:Ro,state:Ro.INITIAL,recordStartedAt:null,recordingTime:String.fromCharCode(160),recordTimer:null,recordingLocked:!1,recordedFile:null,errorMessage:null}},watch:{micButtonRef:function(t){if(t){var e=t.$el.getBoundingClientRect(),n=e.left,o=e.right-e.left;e=this.$refs.vrroot.parentElement.getBoundingClientRect();var i=e.right-e.left;document.documentElement.style.setProperty("--v-mic-button-left",n+"px"),document.documentElement.style.setProperty("--v-mic-button-width",o+"px"),document.documentElement.style.setProperty("--v-mic-button-container-width",i+"px");var a=o/i;document.documentElement.style.setProperty("--v-mic-button-initial-scale",a);var r=n+o/2-i/2;document.documentElement.style.setProperty("--v-mic-button-initial-translate",r+"px")}},show:function(t){t?(this.state=Ro.INITIAL,this.errorMessage=null,this.recordedFile=null,this.ptt?(document.addEventListener("mouseup",this.mouseUp,!1),document.addEventListener("mousemove",this.mouseMove,!1),document.addEventListener("touchend",this.mouseUp,!1),document.addEventListener("touchmove",this.mouseMove,!1),this.startRecording()):(console.log("Not PTT"),this.micButtonRef.$el.style.display="none")):(document.removeEventListener("mouseup",this.mouseUp,!1),document.removeEventListener("mousemove",this.mouseMove,!1),document.removeEventListener("touchend",this.mouseUp,!1),document.removeEventListener("touchmove",this.mouseMove,!1),this.startCoordinateX=null,this.startCoordinateY=null,this.willCancel=!1,this.startCoordinateX=null,this.startCoordinateY=null,this.recordingLocked=!1,this.micButtonRef.$el.style.display="block")}},computed:{lockButtonStyle:function(){var t=0,e=20;if(this.micButtonRef){var n=this.micButtonRef.$el.getBoundingClientRect();t=n.left,e=n.right-n.left}var o="position:absolute;top:-50px;left:"+t+"px;width:"+e+"px;height:40px";return o}},methods:{close:function(){this.stopRecordTimer(),this.recordingTime=String.fromCharCode(160),this.$emit("close")},mouseUp:function(t){document.removeEventListener("mouseup",this.mouseUp,!1),document.removeEventListener("mousemove",this.mouseMove,!1),document.removeEventListener("touchend",this.mouseUp,!1),document.removeEventListener("touchmove",this.mouseMove,!1),this.state==Ro.RECORDING?this.recordingLocked||(this.willCancel?this.cancelRecording():this.stopRecording()):this.cancelRecording()},mouseMove:function(t){var e=t.clientX,n=t.clientY;t.touches&&t.touches.length>0&&(e=t.touches[0].clientX,n=t.touches[0].clientY),this.startCoordinateX||(this.startCoordinateX=e,this.startCoordinateY=n),this.willCancel=e<this.startCoordinateX-30,n<this.startCoordinateY-30&&!this.willCancel&&(this.recordingLocked=!0),t.preventDefault(),t.stopPropagation()},startRecording:function(){var t=this,e={audio:{channelCount:1,sampleRate:16e3,echoCancellation:!1,autoGainControl:!0,noiseSuppression:!0,volume:1},video:!1};navigator.mediaDevices.getUserMedia(e).then((function(e){t.recorder=yo()(e,{type:"audio",mimeType:"audio/webm",sampleRate:16e3,desiredSampRate:16e3,numberOfAudioChannels:1}),t.recorder.startRecording(),t.state=Ro.RECORDING,t.recordStartedAt=Date.now(),t.startRecordTimer()})).catch((function(e){console.error(e),e&&"NotAllowedError"==e.name&&(t.errorMessage=e.message),t.state=Ro.ERROR}))},cancelRecording:function(){this.state=Ro.INITIAL,this.recorder&&(this.recorder.stopRecording(),this.recorder.destroy(),this.recorder=null),this.stopRecordTimer(),this.recordingTime=String.fromCharCode(160),this.close()},pauseRecording:function(){this.state=Ro.RECORDED,this.stopRecordTimer(),this.getFile(!1)},stopRecording:function(){this.state=Ro.RECORDED,this.stopRecordTimer(),this.recordingTime=String.fromCharCode(160),this.close(),this.getFile(!0)},redo:function(){this.state=Ro.INITIAL,this.recordedFile=null,this.recordingTime=String.fromCharCode(160)},send:function(){this.$emit("file",{file:this.recordedFile})},getFile:function(t){var e=this,n=Date.now()-this.recordStartedAt;this.recorder.stopRecording((function(){e.correctMetadata(e.recorder.getBlob(),n).then((function(n){e.recordedFile=new File([n],w["a"].formatRecordStartTime(e.recordStartedAt)+".webm",{type:n.type,lastModified:Date.now()}),t&&e.send()}))}))},startRecordTimer:function(){var t=this;this.stopRecordTimer(),this.recordingTime=String.fromCharCode(160),this.recordTimer=setInterval((function(){var e=Date.now();t.recordingTime=w["a"].formatRecordDuration(e-t.recordStartedAt)}),500)},stopRecordTimer:function(){this.recordTimer&&(clearInterval(this.recordTimer),this.recordTimer=null)},correctMetadata:function(t,e){return Object(vo["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,o){try{xo()(t,e,(function(e){var o=new Blob([e],{type:t.type});n(o)}))}catch(i){console.error(i),o(i)}})));case 1:case"end":return n.stop()}}),n)})))()}}},Io=ko,To=(n("decf"),n("60c0"),Object(c["a"])(Io,uo,mo,!1,null,null,null)),Eo=To.exports;u()(To,{VBtn:k["a"],VCol:N["a"],VContainer:U["a"],VIcon:I["a"],VRow:F["a"]});var So=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("BottomSheet",{ref:"sheet",staticClass:"room-info-bottom-sheet"},[n("div",{ref:"roomInfoSheetContent",staticClass:"room-info-sheet"},[n("div",{staticClass:"text-center current-room"},[n("v-avatar",{staticClass:"room-avatar"},[t.roomAvatar?n("v-img",{attrs:{src:t.roomAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.roomName.substring(0,1).toUpperCase()))])],1),n("div",{staticClass:"h4"},[t._v("This group")]),n("div",{staticClass:"h2"},[t._v(t._s(t.roomName))]),n("v-btn",{staticClass:"filled-button",attrs:{height:"20px",color:"black"},on:{click:function(e){return e.stopPropagation(),t.showDetails(e)}}},[t._v("View details")])],1),n("room-list",{attrs:{title:"Other groups"},on:{close:t.close}}),n("v-btn",{staticClass:"outlined-button",attrs:{height:"20px",color:"black"},on:{click:function(e){return e.stopPropagation(),t.createRoom(e)}}},[t._v("Create group")])],1)])},Po=[],$o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"sheet",staticClass:"bottom-sheet",style:"closed"==t.state?{"pointer-events":"none"}:{}},[n("v-fade-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:"closed"!=t.state,expression:"state != 'closed'"}],staticClass:"bottom-sheet-bg",on:{click:function(e){return e.stopPropagation(),t.onBackgroundClick(e)}}})]),n("div",{ref:"pan",staticClass:"bottom-sheet-content",style:{top:(t.isMove?t.y:t.calcY())+"px"},attrs:{"data-state":t.isMove?"move":t.state}},[t._m(0),n("div",{staticStyle:{position:"absolute",top:"20px",left:"0",right:"0",bottom:"0","overflow-y":"auto",padding:"20px"}},[t._t("default")],2)])],1)},Ao=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"bottom-sheet-handle"},[n("div",{staticClass:"bottom-sheet-handle-decoration"})])}],Mo=(n("a9e3"),n("c8b5")),Oo=n.n(Mo),Lo={props:{openY:{type:Number,default:.1},halfY:{type:Number,default:.5},defaultState:{type:String,default:"closed"}},data:function(){return{mc:null,y:0,startY:0,isMove:!1,state:this.defaultState,rect:{}}},mounted:function(){var t=this;window.onresize=function(){t.rect=t.$refs.sheet.getBoundingClientRect()},this.rect=this.$refs.sheet.getBoundingClientRect(),this.mc=new Oo.a(this.$refs.pan),this.mc.get("pan").set({direction:Oo.a.DIRECTION_ALL});var e=this;this.mc.on("panup pandown",(function(t){e.y=t.center.y-16})),this.mc.on("panstart",(function(t){e.startY=t.center.y,e.isMove=!0})),this.mc.on("panend",(function(t){switch(e.isMove=!1,e.state){case"small":e.startY-t.center.y>120&&(e.state="open"),e.startY-t.center.y<-50&&(e.state="closed");break;case"open":e.startY-t.center.y<-120&&(e.state="small");break}}))},beforeDestroy:function(){this.mc.destroy(),window.onresize=null},methods:{calcY:function(){switch(this.state){case"closed":return this.rect.height;case"open":return this.rect.height*this.openY;case"small":return this.rect.height*this.halfY;default:return this.y}},open:function(){this.setState("small")},close:function(){this.setState("closed")},setState:function(t){this.state=t},onBackgroundClick:function(){"open"==this.state?this.setState("small"):this.setState("closed")}}},Vo=Lo,jo=(n("5885"),Object(c["a"])(Vo,$o,Ao,!1,null,"3693185f",null)),Do=jo.exports;u()(jo,{VFadeTransition:O["c"]});var No=n("241d"),Uo={name:"RoomInfoBottomSheet",mixins:[No["a"]],components:{BottomSheet:Do,RoomList:V},methods:{open:function(){this.$refs.sheet.open()},close:function(){this.$refs.sheet.close()},showDetails:function(){this.close(),this.$navigation.push({name:"RoomInfo"})},createRoom:function(){this.close(),this.$navigation.push({name:"CreateRoom"})}}},Bo=Uo,Fo=(n("9eba"),Object(c["a"])(Bo,So,Po,!1,null,null,null)),Wo=Fo.exports;u()(Fo,{VAvatar:ct["a"],VBtn:k["a"],VImg:T["a"]});var zo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"created-room-welcome-header"},[n("div",{staticClass:"h4"},[t._v("Welcome!")]),n("div",{staticClass:"mt-2"},[t._v("Here are a few things to know about your group:")]),"public"==t.roomJoinRule?n("div",{staticClass:"mt-2"},[t._v("Anyone can join by opening this link: "+t._s(t.publicRoomLink))]):"invite"==t.roomJoinRule?n("div",{staticClass:"mt-2"},[t._v("Only people you invite can join.")]):t._e(),n("div",{staticClass:"mt-2"},[t._v("You can change 'join permissions' and 'message history' at any time in the group settings.")]),n("div",{staticClass:"text-right"},[n("v-btn",{attrs:{text:""},on:{click:function(e){return e.stopPropagation(),t.$emit("close")}}},[t._v("Got it")])],1)])},Ho=[],Jo={name:"CreatedRoomWelcomeHeader",mixins:[No["a"]]},Yo=Jo,Go=(n("98614"),Object(c["a"])(Yo,zo,Ho,!1,null,null,null)),qo=Go.exports;u()(Go,{VBtn:k["a"]});var Qo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"message-operations-bottom-sheet"},[n("v-fade-transition",[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.closed,expression:"!closed"}],staticStyle:{position:"absolute",top:"0",left:"0",bottom:"0",right:"0","background-color":"rgba(0, 0, 0, 0.3)"},on:{click:function(e){return e.stopPropagation(),t.backgroundClick(e)}}})]),n("SwipeableBottomSheet",{ref:"sheet",staticClass:"bottom-sheet ma-0 pa-0",attrs:{halfY:.5,openY:.2,"data-closed":t.closed?1:0}},[t._t("default")],2)],1)},Xo=[],Ko=n("3776"),Zo={name:"MessageOperationsBottomSheet",components:{SwipeableBottomSheet:Ko["a"]},data:function(){return{closed:!0}},mounted:function(){var t=this;this.$watch("$refs.sheet.state",(function(e,n){t.closed="close"==e}))},methods:{open:function(){"half"==this.$refs.sheet.state?this.$refs.sheet.setState("close"):this.$refs.sheet.setState("half")},close:function(){this.$refs.sheet.setState("close")},backgroundClick:function(){"half"==this.$refs.sheet.state?this.$refs.sheet.setState("close"):this.$refs.sheet.setState("half")}}},ti=Zo,ei=(n("193e"),Object(c["a"])(ti,Qo,Xo,!1,null,null,null)),ni=ei.exports;u()(ei,{VFadeTransition:O["c"]});var oi=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("BottomSheet",{ref:"sheet",staticClass:"sticker-picker"},[n("v-tabs",{staticClass:"tabs",attrs:{centered:"","show-arrows":""},model:{value:t.currentStickerPack,callback:function(e){t.currentStickerPack=e},expression:"currentStickerPack"}},[n("v-tabs-slider"),t._l(t.packs,(function(e){return n("v-tab",{key:e},[t._v(" "+t._s(e)+" "),n("v-icon",[t._v("mdi-phone")])],1)}))],2),n("v-tabs-items",{staticClass:"tab-items",model:{value:t.currentStickerPack,callback:function(e){t.currentStickerPack=e},expression:"currentStickerPack"}},t._l(t.packs,(function(e){return n("v-tab-item",{key:e},[n("v-card",{attrs:{flat:""}},[n("v-container",{attrs:{fluid:""}},[n("v-row",t._l(t.stickersInPack(e),(function(o){return n("v-col",{key:e+o.name,attrs:{cols:"2"}},[n("v-img",{attrs:{src:o.image,contain:""},on:{click:function(n){return t.selectSticker(e,o)}}})],1)})),1)],1)],1)],1)})),1)],1)},ii=[],ai={components:{BottomSheet:Do},data:function(){return{currentStickerPack:"tab-0"}},computed:{packs:function(){return Qt.getPacks()}},mounted:function(){},methods:{open:function(){this.$refs.sheet.open()},stickersInPack:function(t){return Qt.stickersInPack(t)},selectSticker:function(t,e){this.$refs.sheet.close(),this.$emit("selectSticker",Qt.getStickerShortcode(t,e))}}},ri=ai,si=(n("efbf"),n("7bbb"),n("b0af")),ci=n("71a3"),li=n("c671"),ui=n("fe57"),di=n("aac8"),mi=n("9a96"),vi=Object(c["a"])(ri,oi,ii,!1,null,null,null),hi=vi.exports;u()(vi,{VCard:si["a"],VCol:N["a"],VContainer:U["a"],VIcon:I["a"],VImg:T["a"],VRow:F["a"],VTab:ci["a"],VTabItem:li["a"],VTabs:ui["a"],VTabsItems:di["a"],VTabsSlider:mi["a"]});var fi=n("db90"),pi=5e3,gi=.3;function bi(t){this.node=t,this.previousScrollHeightMinusTop=0,this.previousScrollTop=0,this.readyFor="up"}bi.prototype.restore=function(){"up"===this.readyFor?this.node.scrollTop=this.node.scrollHeight-this.previousScrollHeightMinusTop:this.node.scrollTop=this.previousScrollTop},bi.prototype.prepareFor=function(t){this.readyFor=t||"up","up"===this.readyFor?this.previousScrollHeightMinusTop=this.node.scrollHeight-this.node.scrollTop:this.previousScrollTop=this.node.scrollTop};var _i={name:"Chat",components:{ChatHeader:lo,MessageIncomingText:ut,MessageIncomingFile:pt,MessageIncomingImage:wt,MessageIncomingAudio:St,MessageIncomingVideo:Vt,MessageIncomingSticker:te,MessageOutgoingText:re,MessageOutgoingFile:me,MessageOutgoingImage:be,MessageOutgoingAudio:Re,MessageOutgoingVideo:Pe,MessageOutgoingSticker:Ve,ContactJoin:Fe,ContactLeave:Ge,ContactInvited:tn,ContactChanged:sn,RoomNameChanged:vn,RoomTopicChanged:_n,RoomAvatarChanged:kn,RoomHistoryVisibility:$n,RoomJoinRules:jn,DebugEvent:Wn,MessageOperations:Qn,MessageOperationsPicker:no,VoiceRecorder:Eo,RoomInfoBottomSheet:Wo,CreatedRoomWelcomeHeader:qo,MessageOperationsBottomSheet:ni,StickerPickerBottomSheet:hi,BottomSheet:Do},data:function(){return{config:fi,events:[],currentInput:"",typingMembers:[],timelineWindow:null,timelineWindowPaginating:!1,scrollPosition:null,currentImageInput:null,currentImageInputPath:null,currentSendOperation:null,currentSendProgress:null,currentSendShowSendButton:!0,currentSendError:null,showEmojiPicker:!1,selectedEvent:null,editedEvent:null,replyToEvent:null,showContextMenu:!1,showContextMenuAnchor:null,initialLoadDone:!1,loading:!1,showRecorder:!1,showRecorderPTT:!1,chatContainerSize:0,showScrollToEnd:!1,showNotAllowedForGuests:!1,rrTimer:null,lastRR:null,showCreatedRoomWelcomeHeader:!1,recentEmojis:[]}},mounted:function(){var t=this.$refs.chatContainer;this.scrollPosition=new bi(t),this.chatContainerSize=this.$refs.chatContainerResizer.$el.clientHeight},beforeDestroy:function(){this.stopRRTimer()},destroyed:function(){this.$matrix.off("Room.timeline",this.onEvent),this.$matrix.off("RoomMember.typing",this.onUserTyping)},computed:{currentUser:function(){return this.$store.state.auth.user},room:function(){return this.$matrix.currentRoom},roomId:function(){return!this.$matrix.ready&&this.currentUser?null:this.room?this.room.roomId:this.$matrix.currentRoomId},roomAliasOrId:function(){return this.room?this.room.getCanonicalAlias()||this.room.roomId:this.$matrix.currentRoomId},readMarker:function(){return this.lastRR?this.lastRR.getId():this.fullyReadMarker||this.room.getEventReadUpTo(this.$matrix.currentUserId,!1)},fullyReadMarker:function(){var t=this.room.getAccountData("m.fully_read");return t?t.getContent().event_id:null},attachButtonDisabled:function(){return null!=this.editedEvent||null!=this.replyToEvent||this.currentInput.length>0},sendButtonDisabled:function(){return 0==this.currentInput.length},typingMembersString:function(){var t=this.typingMembers.length;return t>1?t+" members are typing":t>0?this.typingMembers[0].name+" is typing":""},opStyle:function(){var t=this.selectedEvent&&this.$refs[this.selectedEvent.getId()],e=0,n=0;if(t&&t[0]&&this.showContextMenuAnchor){var o=this.showContextMenuAnchor.getBoundingClientRect(),i=this.$refs.messageOperationsStrut.getBoundingClientRect();e=o.top-i.top,n=o.left-i.left,n+250>i.right&&(n=i.right-250)}return"top:"+e+"px;left:"+n+"px"},canRecordAudio:function(){return w["a"].browserCanRecordAudio()},debugging:function(){return(window.location.host||"").startsWith("localhost")}},watch:{roomId:{immediate:!0,handler:function(t,e){if(!t||t!=e){if(console.log("Chat: Current room changed to "+(t||"null")),this.$matrix.off("Room.timeline",this.onEvent),this.$matrix.off("RoomMember.typing",this.onUserTyping),this.events=[],this.timelineWindow=null,this.typingMembers=[],this.initialLoadDone=!1,this.stopRRTimer(),this.lastRR=null,!this.room)return(this.roomId&&this.roomId.startsWith("#")||this.roomId)&&this.onRoomNotJoined(),void(this.initialLoadDone=!0);this.room.hasMembershipState(this.currentUser.user_id,"join")?this.onRoomJoined(this.readMarker):this.onRoomNotJoined()}}}},methods:{onRoomJoined:function(t){var e=this,n=this.room.currentState.getStateEvents("m.room.create","");if(n){var o=n.getContent().creator;o==this.$matrix.currentUserId&&n.getLocalAge()<3e5&&(this.showCreatedRoomWelcomeHeader=!0)}this.$matrix.on("Room.timeline",this.onEvent),this.$matrix.on("RoomMember.typing",this.onUserTyping),console.log("Read up to "+t),this.timelineWindow=new Y["TimelineWindow"](this.$matrix.matrixClient,this.room.getUnfilteredTimelineSet(),{});var i=this;this.timelineWindow.load(t,20).then((function(){console.log("This is",i),i.events=i.timelineWindow.getEvents();var n=function t(){var e=i.$refs.chatContainer;return e.scrollHeight<=(1+2*gi)*e.clientHeight&&i.timelineWindow&&i.timelineWindow.canPaginate(Y["EventTimeline"].BACKWARDS)?i.timelineWindow.paginate(Y["EventTimeline"].BACKWARDS,10,!0,5).then((function(e){return i.events=i.timelineWindow.getEvents(),e?t.call(i):Promise.reject("Failed to paginate")})):Promise.resolve("Done")}.bind(i);n().catch((function(t){console.log("ERROR "+t)})).finally((function(){i.initialLoadDone=!0,t&&!e.showCreatedRoomWelcomeHeader?i.scrollToEvent(t):e.showCreatedRoomWelcomeHeader&&i.onScroll(),i.restartRRTimer()}))})).catch((function(n){console.log("Error fetching events!",n,e),"M_UNKNOWN"==n.errcode&&t?e.onRoomJoined(null):(e.events=e.timelineWindow.getEvents(),e.initialLoadDone=!0)}))},onRoomNotJoined:function(){this.$navigation.push({name:"Join",params:{roomId:w["a"].sanitizeRoomId(this.roomAliasOrId)}},0)},scrollToEndOfTimeline:function(){var t=this;if(this.timelineWindow&&this.timelineWindow.canPaginate(Y["EventTimeline"].FORWARDS)){this.loading=!0;var e=new Y["TimelineWindow"](this.$matrix.matrixClient,this.room.getUnfilteredTimelineSet(),{}),n=this;e.load(null,20).then((function(){n.timelineWindow=e,n.events=n.timelineWindow.getEvents()})).finally((function(){t.loading=!1}))}else this.smoothScrollToEnd()},touchX:function(t){return-1!==t.type.indexOf("mouse")?t.clientX:t.touches[0].clientX},touchY:function(t){return-1!==t.type.indexOf("mouse")?t.clientY:t.touches[0].clientY},touchStart:function(t,e){this.selectedEvent!=e&&(this.showContextMenu=!1),this.selectedEvent=e,this.touchStartX=this.touchX(t),this.touchStartY=this.touchY(t),this.touchTimer=setTimeout(this.touchTimerElapsed,500)},touchEnd:function(){this.touchTimer&&clearTimeout(this.touchTimer)},touchCancel:function(){this.touchTimer&&clearTimeout(this.touchTimer)},touchMove:function(t){this.touchCurrentX=this.touchX(t),this.touchCurrentY=this.touchY(t);var e=4,n=Math.abs(this.touchStartX-this.touchCurrentX)>e||Math.abs(this.touchStartY-this.touchCurrentY)>e;n&&this.touchTimer&&clearTimeout(this.touchTimer)},touchTimerElapsed:function(){this.updateRecentEmojis(),this.showContextMenu=!0},handleChatContainerResize:function(t){t.ignoredWidth;var e=t.height,n=e-this.chatContainerSize;this.chatContainerSize=e;var o=this.$refs.chatContainer;n<0&&(o.scrollTop-=n)},componentForEvent:function(t){switch(t.getType()){case"m.room.member":if("join"==t.getContent().membership)return t.getPrevContent()&&"join"==t.getPrevContent().membership?sn:Fe;if("leave"==t.getContent().membership)return Ge;if("invite"==t.getContent().membership)return tn;break;case"m.room.message":return t.getSender()!=this.$matrix.currentUserId?"m.image"==t.getContent().msgtype?wt:"m.audio"==t.getContent().msgtype?St:"m.video"==t.getContent().msgtype?Vt:"m.file"==t.getContent().msgtype?pt:Qt.isStickerShortcode(t.getContent().body)?te:ut:"m.image"==t.getContent().msgtype?be:"m.audio"==t.getContent().msgtype?Re:"m.video"==t.getContent().msgtype?Pe:"m.file"==t.getContent().msgtype?me:Qt.isStickerShortcode(t.getContent().body)?Ve:re;case"m.room.name":return vn;case"m.room.topic":return _n;case"m.room.avatar":return kn;case"m.room.history_visibility":return $n;case"m.room.join_rules":return jn}return this.debugging?Wn:null},paginateBackIfNeeded:function(){var t=this;this.$nextTick((function(){var e=t.$refs.chatContainer;e.scrollHeight<=e.clientHeight&&t.handleScrolledToTop()}))},onScroll:function(t){var e=this.$refs.chatContainer;if(e){var n=e.clientHeight*gi;e.scrollTop<=n?this.handleScrolledToTop():e.scrollHeight-e.scrollTop.toFixed(0)-e.clientHeight<=n&&this.handleScrolledToBottom(!1),this.showScrollToEnd=e.scrollHeight-e.scrollTop.toFixed(0)>e.clientHeight||this.timelineWindow&&this.timelineWindow.canPaginate(Y["EventTimeline"].FORWARDS),this.restartRRTimer()}},onEvent:function(t){if(console.log("OnEvent",JSON.stringify(t)),t.getRoomId()===this.roomId){this.initialLoadDone&&this.paginateBackIfNeeded();var e=this.$refs.chatContainer,n=t.getSender()==this.$matrix.currentUserId;e.scrollHeight-e.scrollTop.toFixed(0)==e.clientHeight&&(n=!0),this.initialLoadDone&&t.forwardLooking&&!t.isRelation()&&this.handleScrolledToBottom(n)}},onUserTyping:function(t,e){if(e.roomId===this.roomId){if(e.typing)this.typingMembers.includes(e)||this.typingMembers.push(e);else{var n=this.typingMembers.indexOf(e);n>-1&&this.typingMembers.splice(n,1)}console.log("Typing: ",this.typingMembers)}},sendCurrentTextMessage:function(){this.currentInput.length>0&&!this.showRecorder&&(this.sendMessage(this.currentInput),this.currentInput="",this.editedEvent=null,this.replyToEvent=null)},sendMessage:function(t){t&&t.length>0&&w["a"].sendTextMessage(this.$matrix.matrixClient,this.roomId,t,this.editedEvent,this.replyToEvent).then((function(){console.log("Sent message")})).catch((function(t){console.log("Failed to send:",t)}))},showAttachmentPicker:function(){this.$refs.attachment.click()},handlePickedAttachment:function(t){var e=this;if(t.target.files&&t.target.files[0]){var n=new FileReader;n.onload=function(n){e.currentSendShowSendButton=!0,e.currentImageInput=n.target.result,e.currentImageInputPath=t.target.files[0]},n.readAsDataURL(t.target.files[0])}},showStickerPicker:function(){this.$refs.stickerPickerSheet.open()},onUploadProgress:function(t){t.total?this.currentSendProgress="Uploaded "+(t.loaded||0)+" of "+t.total:this.currentSendProgress="Uploaded "+(t.loaded||0)},sendAttachment:function(t){var e=this;this.currentImageInputPath&&(this.currentSendProgress=null,this.currentSendOperation=w["a"].sendImage(this.$matrix.matrixClient,this.roomId,this.currentImageInputPath,this.onUploadProgress),this.currentSendOperation.then((function(){e.currentSendOperation=null,e.currentImageInput=null,e.currentImageInputPath=null,e.currentSendProgress=null,t&&e.sendMessage(t)})).catch((function(t){e.currentSendError=t.toLocaleString(),e.currentSendOperation=null,e.currentSendProgress=null})))},cancelSendAttachment:function(){this.currentSendOperation&&this.currentSendOperation.reject("Canceled"),this.currentSendOperation=null,this.currentImageInput=null,this.currentImageInputPath=null,this.currentSendProgress=null,this.currentSendError=null},handleScrolledToTop:function(){var t=this;console.log("@top"),this.timelineWindow&&this.timelineWindow.canPaginate(Y["EventTimeline"].BACKWARDS)&&!this.timelineWindowPaginating&&(this.timelineWindowPaginating=!0,this.timelineWindow.paginate(Y["EventTimeline"].BACKWARDS,10,!0).then((function(e){e&&(t.scrollPosition.prepareFor("up"),t.events=t.timelineWindow.getEvents(),t.$nextTick((function(){console.log("Restore scroll!"),t.scrollPosition.restore()})))})).finally((function(){t.timelineWindowPaginating=!1})))},handleScrolledToBottom:function(t){var e=this;console.log("@bottom"),this.timelineWindow&&this.timelineWindow.canPaginate(Y["EventTimeline"].FORWARDS)&&!this.timelineWindowPaginating&&(this.timelineWindowPaginating=!0,this.timelineWindow.paginate(Y["EventTimeline"].FORWARDS,10,!0).then((function(n){n&&(e.scrollPosition.prepareFor("down"),e.events=e.timelineWindow.getEvents(),e.$nextTick((function(){console.log("Restore scroll!"),e.scrollPosition.restore(),t&&e.smoothScrollToEnd()})))})).finally((function(){e.timelineWindowPaginating=!1})))},scrollToEvent:function(t){var e=this.$refs.chatContainer,n=this.$refs[t];if(e&&n){var o=e.clientHeight/2,i=n[0].offsetTop;e.scrollTo(0,i-o)}},smoothScrollToEnd:function(){this.$nextTick((function(){var t=this.$refs.chatContainer;if(t.children.length>0){var e=t.children[t.children.length-1];console.log("Scroll into view",e),window.requestAnimationFrame((function(){e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}))}}))},showMoreMessageOperations:function(t){this.addReaction(t)},addReaction:function(t){var e=t.event;this.selectedEvent=e,this.$refs.messageOperationsSheet.open(),this.showEmojiPicker=!0},addQuickReaction:function(t){this.sendQuickReaction({reaction:t.emoji,event:t.event})},addReply:function(t){this.replyToEvent=t,this.$refs.messageInput.focus()},edit:function(t){this.editedEvent=t,this.currentInput=t.getContent().body,this.$refs.messageInput.focus()},redact:function(t){this.$matrix.matrixClient.redactEvent(t.getRoomId(),t.getId()).then((function(){console.log("Message redacted")})).catch((function(t){console.log("Redaction failed: ",t)}))},download:function(t){w["a"].getAttachment(this.$matrix.matrixClient,t).then((function(e){var n=document.createElement("a");n.href=e,n.target="_blank",n.download=t.getContent().body||"Download",n.click(),URL.revokeObjectURL(e)})).catch((function(t){console.log("Failed to fetch attachment: ",t)}))},cancelEditReply:function(){this.currentInput="",this.editedEvent=null,this.replyToEvent=null},emojiSelected:function(t){if(this.showEmojiPicker=!1,this.selectedEvent){var e=this.selectedEvent;this.selectedEvent=null,this.sendQuickReaction({reaction:t.data,event:e})}},sendQuickReaction:function(t){w["a"].sendQuickReaction(this.$matrix.matrixClient,this.roomId,t.reaction,t.event).then((function(){console.log("Quick reaction message")})).catch((function(t){console.log("Failed to send quick reaction:",t)}))},sendSticker:function(t){this.sendMessage(t)},showContextMenuForEvent:function(t){var e=t.event,n=this.$refs[e.getId()];n&&console.log("Got the ref",n),this.selectedEvent=e,this.updateRecentEmojis(),this.showContextMenu=!0,this.showContextMenuAnchor=t.anchor},viewProfile:function(){this.$navigation.push({name:"Profile"},1)},closeContextMenuIfOpen:function(t){this.showContextMenu&&(this.showContextMenu=!1,t.preventDefault())},stopRRTimer:function(){this.rrTimer&&(clearTimeout(this.rrTimer),this.rrTimer=null)},restartRRTimer:function(){this.stopRRTimer(),this.rrTimer=setTimeout(this.rrTimerElapsed,pi)},rrTimerElapsed:function(){var t=this;this.rrTimer=null;var e=this.$refs.chatContainer,n=w["a"].getFirstVisibleElement(e),o=w["a"].getLastVisibleElement(e);if(n&&o){var i=n.getAttribute("eventId"),a=o.getAttribute("eventId");if(a&&this.room){var r=this.room.findEventById(a),s=this.events.indexOf(r),c=0;this.lastRR&&(c=this.lastRR.getTs());for(var l=s;l>=0;l--){if(r=this.events[l],r==this.lastRR||r.getTs()<=c)break;if(!r.getId().startsWith("~"))return void this.$matrix.matrixClient.sendReadReceipt(r).then((function(){t.$matrix.matrixClient.setRoomReadMarkers(t.room.roomId,r.getId())})).then((function(){console.log("RR sent for event: "+r.getId()),t.lastRR=r})).catch((function(t){console.log("Failed to update read marker: ",t)})).finally((function(){t.restartRRTimer()}));if(r.getId()==i)break}}}this.restartRRTimer()},showDayMarkerBeforeEvent:function(t){var e=this.events.indexOf(t);if(e<=0)return!0;var n=this.events[e-1];return w["a"].dayDiff(n.getTs(),t.getTs())>0},dayForEvent:function(t){return w["a"].formatDay(t.getTs())},showRecordingUI:function(){this.showRecorderPTT=!1,this.showRecorder=!0},startRecording:function(){this.showRecorderPTT=!0,this.showRecorder=!0},onVoiceRecording:function(t){this.currentSendShowSendButton=!1,this.currentImageInputPath=t.file;var e=void 0;this.currentInput&&this.currentInput.length>0&&(e=this.currentInput,this.currentInput=""),this.sendAttachment(e),this.showRecorder=!1,this.$ci.event("Audio","Voice message sent")},closeCreateRoomWelcomeHeader:function(){var t=this;this.showCreatedRoomWelcomeHeader=!1,this.$nextTick((function(){t.onScroll()}))},updateRecentEmojis:function(){this.$refs.emojiPicker?this.recentEmojis=this.$refs.emojiPicker.mapEmojis["Frequently"]:this.recentEmojis=[]}}},Ci=_i,yi=(n("44b9"),n("99d9")),wi=n("169a"),xi=n("ce7e"),Ri=n("2fa4"),ki=n("a844"),Ii=Object(c["a"])(Ci,H,J,!1,null,null,null),Ti=Ii.exports;u()(Ii,{VBtn:k["a"],VCard:si["a"],VCardActions:yi["a"],VCardText:yi["b"],VCardTitle:yi["c"],VCol:N["a"],VContainer:U["a"],VDialog:wi["a"],VDivider:xi["a"],VIcon:I["a"],VImg:T["a"],VProgressCircular:B["a"],VRow:F["a"],VSpacer:Ri["a"],VTextarea:ki["a"]});var Ei=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"join-root"},[t.waitingForInfo||t.waitingForMembership?t._e():n("div",{staticClass:"text-center"},[t.currentUser?t._e():n("v-btn",{staticClass:"btn-login",attrs:{text:"",small:"",loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handleLogin(e)}}},[t._v("Login")]),n("v-avatar",{staticClass:"join-avatar"},[t.roomAvatar?n("v-img",{attrs:{src:t.roomAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.roomName.substring(0,1).toUpperCase()))])],1),n("div",{staticClass:"join-title"},[t._v("Welcome to "+t._s(t.roomName))]),n("div",{staticClass:"join-message"}),n("v-container",{staticClass:"join-user-info"},[t.canEditProfile?n("v-row",[n("v-col",{staticClass:"flex-grow-0 flex-shrink-0"},[n("v-avatar",{on:{click:t.showAvatarPickerList}},[t.selectedProfile?n("v-img",{attrs:{src:t.selectedProfile.image}}):t._e()],1)],1),n("v-col",{staticClass:"flex-shrink-1 flex-grow-1"},[n("v-select",{ref:"avatar",attrs:{items:t.availableAvatars,"cache-items":"",label:"User name",outlined:"",dense:"",value:t.availableAvatars[0],"single-line":""},on:{change:t.selectAvatar},scopedSlots:t._u([{key:"selection",fn:function(){return[n("v-text-field",{attrs:{"background-color":"transparent",solo:"",flat:"","hide-details":""},nativeOn:{click:function(t){t.stopPropagation()}},model:{value:t.selectedProfile.name,callback:function(e){t.$set(t.selectedProfile,"name",e)},expression:"selectedProfile.name"}})]},proxy:!0},{key:"item",fn:function(e){return[n("v-avatar",{attrs:{size:"32"}},[n("v-img",{attrs:{src:e.item.image}})],1),n("div",{staticClass:"ml-2"},[t._v(t._s(e.item.name))])]}}],null,!1,1874003059)})],1)],1):n("v-row",[n("v-col",[t._v(" You are joining as: "),n("div",{staticStyle:{display:"inline-block"}},[n("v-avatar",{attrs:{color:"#e0e0e0"}},[t.userAvatar?n("v-img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])],1)],1),t._v(" "+t._s(t.userDisplayName)+" ")])],1)],1),t.currentUser?n("v-btn",{staticClass:"btn-dark",attrs:{large:"",block:"",loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handleJoin(e)}}},[t._v("Join room")]):n("v-btn",{staticClass:"btn-dark",attrs:{large:"",block:"",loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handleJoin(e)}}},[t._v("Join as guest")]),t.loadingMessage?n("div",[t._v(t._s(t.loadingMessage))]):t._e()],1)])},Si=[],Pi=(n("25f0"),n("86543")),$i={name:"Join",data:function(){return{roomName:null,roomAvatar:null,guestUser:new Pi["a"](fi.defaultServer,"","",!0),loading:!1,loadingMessage:null,waitingForInfo:!0,waitingForMembership:!1,availableAvatars:[],selectedProfile:null}},mounted:function(){this.$matrix.on("Room.myMembership",this.onMyMembership),this.availableAvatars=w["a"].getDefaultAvatars(),this.selectAvatar(this.availableAvatars[Math.floor(Math.random()*this.availableAvatars.length)])},destroyed:function(){this.$matrix.off("Room.myMembership",this.onMyMembership)},computed:{currentUser:function(){return this.$store.state.auth.user},room:function(){return this.$matrix.currentRoom},roomId:function(){return this.room?this.room.roomId:this.$matrix.currentRoomId},roomAliasOrId:function(){return this.room?this.room.getCanonicalAlias()||this.room.roomId:this.$matrix.currentRoomId},canEditProfile:function(){return!this.currentUser},userDisplayName:function(){return this.$matrix.currentUserDisplayName},userAvatar:function(){return this.$matrix.userAvatar?this.$matrix.matrixClient.mxcUrlToHttp(this.$matrix.userAvatar,80,80,"scale",!0):null},userAvatarLetter:function(){return this.currentUser&&this.currentUser.userId?(this.currentUserDisplayName||this.currentUser.userId.substring(1)).substring(0,1).toUpperCase():null}},watch:{roomId:{immediate:!0,handler:function(t,e){var n=this;if(t&&(!t||t!=e)){console.log("Join: Current room changed to "+(t||"null")),this.roomName=this.roomId,this.waitingForInfo=!0;var o=this;this.waitingForMembership=!0,this.currentUser?this.getLoginPromise().then((function(){o.$matrix.setCurrentRoomId(o.roomAliasOrId);var t=o.$matrix.getRoom(o.roomAliasOrId);t&&t.hasMembershipState(o.currentUser.user_id,"join")&&o.$navigation.push({name:"Chat",params:{roomId:w["a"].sanitizeRoomId(n.roomAliasOrId)}},-1)})).catch((function(t){console.log("Error logging in: ",t)})).finally((function(){n.waitingForMembership=!1,n.getRoomInfo()})):(this.waitingForMembership=!1,this.getRoomInfo())}}}},methods:{getLoginPromise:function(){return this.$matrix.ready?Promise.resolve(this.$matrix.currentUser):this.$store.dispatch("auth/login",this.currentUser||this.guestUser)},getRoomInfo:function(){var t=this;if(this.roomId.startsWith("#"))this.$matrix.getPublicRoomInfo(this.roomId).then((function(e){console.log("Found room:",e),t.roomName=e.name,t.roomAvatar=e.avatar})).catch((function(t){console.log("Could not find room info",t)})).finally((function(){t.waitingForInfo=!1}));else{var e=this.$matrix.getRoom(this.roomId);e&&(this.roomName=e.name||this.roomName),this.waitingForInfo=!1}},onMyMembership:function(t,e,n){var o=this;t&&t.roomId==this.roomId&&"join"==e&&this.$nextTick((function(){o.$navigation.push({name:"Chat",params:{roomId:w["a"].sanitizeRoomId(o.roomAliasOrId)}},-1)}))},handleLogin:function(){this.$navigation.push({path:"/login"},1)},handleOpenApp:function(){console.log("Open app...")},handleJoin:function(){var t=this;this.loading=!0,this.loadingMessage="Logging in...";var e=!!this.currentUser,n=!1;return this.getLoginPromise().then(function(t){return t.is_guest&&!e&&(n=!0,this.selectedProfile.name&&this.selectedProfile.name.length>0&&(this.$matrix.userDisplayName=this.selectedProfile.name)),n&&this.selectedProfile.name&&0!=this.selectedProfile.name.length?(console.log("Join: Set display name to: "+this.selectedProfile.name),this.$matrix.matrixClient.setDisplayName(this.selectedProfile.name,void 0)):Promise.resolve(t)}.bind(this)).then(function(){return n&&this.selectedProfile.image?(console.log("Join: Updating avatar"),w["a"].setAvatar(this.$matrix,this.selectedProfile.image,(function(t){console.log("Progress: "+JSON.stringify(t))}))):(console.log("Join: No avatar change"),Promise.resolve("no avatar"))}.bind(this)).then(function(t){return console.log("Join: joining room"),this.loadingMessage="Joining room...",this.$matrix.matrixClient.joinRoom(this.roomId)}.bind(this)).then((function(e){t.loading=!1,t.loadingMessage=null,t.$nextTick((function(){t.$navigation.push({name:"Chat",params:{roomId:w["a"].sanitizeRoomId(t.roomAliasOrId)}},-1)}))})).catch((function(e){console.log("Failed to join room",e),t.loading=!1,t.loadingMessage=e.toString()}))},selectAvatar:function(t){this.selectedProfile=Object.assign({},t)},showAvatarPickerList:function(){this.$refs.avatar.$refs.input.click()}}},Ai=$i,Mi=(n("3ed2"),n("b974")),Oi=n("8654"),Li=Object(c["a"])(Ai,Ei,Si,!1,null,null,null),Vi=Li.exports;u()(Li,{VAvatar:ct["a"],VBtn:k["a"],VCol:N["a"],VContainer:U["a"],VImg:T["a"],VRow:F["a"],VSelect:Mi["a"],VTextField:Oi["a"]});var ji=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login-root"},[t.showBackArrow?n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.stopPropagation(),t.$navigation.pop(e)}}},[n("v-icon",[t._v("arrow_back")])],1):t._e(),n("div",{staticClass:"text-center",attrs:{color:"rgba(255,255,255,0.1)"}},[n("div",{staticClass:"h2"},[t._v("Login")]),n("v-form",{model:{value:t.isValid,callback:function(e){t.isValid=e},expression:"isValid"}},[n("v-text-field",{attrs:{label:"Username",color:"black","background-color":"white",outlined:"",rules:[function(t){return!!t||"Username is required"}],error:null!=t.userErrorMessage,"error-messages":t.userErrorMessage,required:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$refs.password.focus()}},model:{value:t.user.user_id,callback:function(e){t.$set(t.user,"user_id",e)},expression:"user.user_id"}}),n("v-text-field",{ref:"password",attrs:{label:"Password",color:"black","background-color":"white",outlined:"",type:"password",rules:[function(t){return!!t||"Password is required"}],error:null!=t.passErrorMessage,"error-messages":t.passErrorMessage,required:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:function(){t.isValid&&!t.loading&&t.handleLogin()}()}},model:{value:t.user.password,callback:function(e){t.$set(t.user,"password",e)},expression:"user.password"}}),n("v-btn",{attrs:{disabled:!t.isValid||t.loading,primary:"",large:"",block:"",loading:t.loading},on:{click:function(e){return e.stopPropagation(),t.handleLogin(e)}}},[t._v("Login")])],1)],1)],1)},Di=[],Ni={name:"Login",data:function(){return{user:new Pi["a"](fi.defaultServer,"",""),isValid:!0,loading:!1,message:"",userErrorMessage:null,passErrorMessage:null}},computed:{loggedIn:function(){return this.$store.state.auth.status.loggedIn},currentUser:function(){return this.$store.state.auth.user},showBackArrow:function(){return this.$navigation&&this.$navigation.canPop()}},created:function(){this.loggedIn&&this.$navigation.push({name:"Chat",params:{roomId:w["a"].sanitizeRoomId(this.$matrix.currentRoomId)}},-1)},watch:{user:{handler:function(){this.userErrorMessage=null,this.passErrorMessage=null},deep:!0},message:function(){this.message&&this.message.toLowerCase().includes("user")?this.userErrorMessage=this.message:this.userErrorMessage=null,this.message&&this.message.toLowerCase().includes("pass")?this.passErrorMessage=this.message:this.passErrorMessage=null}},methods:{handleLogin:function(){var t=this;if(this.user.user_id&&this.user.password){this.message=null;var e=Object.assign({},this.user);e.normalize(),this.loading=!0,this.$store.dispatch("auth/login",e).then((function(){t.$matrix.currentRoomId?t.$navigation.push({name:"Chat",params:{roomId:w["a"].sanitizeRoomId(t.$matrix.currentRoomId)}},-1):t.$navigation.push({name:"Home"},-1)}),(function(e){t.loading=!1,t.message=e.data&&e.data.error||e.message||e.toString(),console.log("Message set to ",t.message)}))}}}},Ui=Ni,Bi=(n("5338"),n("4bd4")),Fi=Object(c["a"])(Ui,ji,Di,!1,null,null,null),Wi=Fi.exports;u()(Fi,{VBtn:k["a"],VForm:Bi["a"],VIcon:I["a"],VTextField:Oi["a"]});var zi=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.user?n("div",{staticClass:"profile"},[n("div",{staticClass:"chat-header"},[n("v-container",{attrs:{fluid:""}},[n("div",{staticClass:"room-name"},[t._v("My Profile")]),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.$navigation&&t.$navigation.canPop(),expression:"$navigation && $navigation.canPop()"}],staticClass:"header-button-right",attrs:{text:""},on:{click:function(e){return e.stopPropagation(),t.$navigation.pop(e)}}},[n("v-icon",[t._v("close")])],1)],1)],1),n("v-container",{staticClass:"user-info"},[n("v-row",[n("v-col",{staticClass:"flex-grow-0 flex-shrink-0"},[n("v-avatar",{staticClass:"avatar",attrs:{size:"48",color:"#e0e0e0"}},[t.userAvatar?n("img",{attrs:{src:t.userAvatar}}):n("span",{staticClass:"white--text headline"},[t._v(t._s(t.userAvatarLetter))])])],1),n("v-col",{staticClass:"flex-shrink-1 flex-grow-1"},[n("div",{staticClass:"h1"},[t._v(t._s(t.displayName))]),n("div",{staticClass:"text-center"},[t._v(t._s(t.$matrix.currentUser.user_id))]),t.$matrix.currentUser.is_guest?n("div",[t._v(" This identity is temporary. Set a password to use it again. ")]):t._e(),n("v-btn",{staticClass:"outlined-button",attrs:{depressed:"",block:""},on:{click:function(e){return e.stopPropagation(),t.logout(e)}}},[t._v("Logout")])],1)],1)],1),n("div",{staticClass:"action",on:{click:function(e){t.showEditPasswordDialog=!0}}},[n("v-icon",[t._v("lock")]),n("span",[t._v("Set password")])],1),n("div",{staticClass:"action",on:{click:function(e){t.editValue=t.displayName,t.showEditDisplaynameDialog=!0}}},[n("v-icon",[t._v("edit")]),n("span",[t._v("Change name")])],1),n("v-dialog",{staticClass:"ma-0 pa-0",attrs:{width:"50%"},model:{value:t.showEditPasswordDialog,callback:function(e){t.showEditPasswordDialog=e},expression:"showEditPasswordDialog"}},[n("v-card",{attrs:{disabled:t.settingPassword}},[n("v-card-title",[t._v("Change password")]),n("v-card-text",[t.$matrix.currentUser.is_guest?t._e():n("v-text-field",{attrs:{label:"Old password",type:"password"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),n("v-text-field",{attrs:{label:"New password",type:"password"},model:{value:t.newPassword1,callback:function(e){t.newPassword1=e},expression:"newPassword1"}}),n("v-text-field",{attrs:{label:"Repeat new password",type:"password"},model:{value:t.newPassword2,callback:function(e){t.newPassword2=e},expression:"newPassword2"}}),t.passwordErrorMessage?n("div",{staticClass:"red--text"},[t._v(t._s(t.passwordErrorMessage))]):t._e()],1),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{text:""},on:{click:t.closeEditPasswordDialog}},[t._v("Cancel")]),n("v-btn",{attrs:{disabled:!t.passwordsMatch,color:"primary",text:""},on:{click:function(e){return t.setPassword(t.$matrix.currentUser.is_guest?t.$matrix.currentUser.password:t.password,t.newPassword1)}}},[t._v("Ok")])],1)],1)],1),n("v-dialog",{staticClass:"ma-0 pa-0",attrs:{width:"50%"},model:{value:t.showEditDisplaynameDialog,callback:function(e){t.showEditDisplaynameDialog=e},expression:"showEditDisplaynameDialog"}},[n("v-card",[n("v-card-title",[t._v("Display name")]),n("v-card-text",[n("v-text-field",{model:{value:t.editValue,callback:function(e){t.editValue=e},expression:"editValue"}})],1),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{text:""},on:{click:function(e){t.showEditDisplaynameDialog=!1}}},[t._v("Cancel")]),n("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.setDisplayName(t.editValue),t.showEditDisplaynameDialog=!1}}},[t._v("Ok")])],1)],1)],1)],1):t._e()},Hi=[],Ji={name:"Profile",data:function(){return{showEditPasswordDialog:!1,showEditDisplaynameDialog:!1,editValue:null,password:null,newPassword1:null,newPassword2:null,settingPassword:!1,passwordErrorMessage:null}},computed:{user:function(){return this.$matrix.matrixClient?this.$matrix.matrixClient.getUser(this.$matrix.currentUserId):null},displayName:function(){return this.user?this.user.displayName||this.user.userId:null},userAvatar:function(){return this.user&&this.user.avatarUrl?this.$matrix.matrixClient.mxcUrlToHttp(this.user.avatarUrl,80,80,"scale",!0):null},userAvatarLetter:function(){return this.user?(this.user.displayName||this.user.userId.substring(1)).substring(0,1).toUpperCase():null},passwordsMatch:function(){return this.newPassword1&&this.newPassword2&&this.newPassword1==this.newPassword2}},methods:{logout:function(){var t=this;this.$store.dispatch("auth/logout"),this.$nextTick((function(){t.$navigation.push({path:"/login"},-1)}))},setDisplayName:function(t){this.$matrix.matrixClient.setDisplayName(t)},setPassword:function(t,e){var n=this;this.settingPassword=!0,this.passwordErrorMessage=null,this.$matrix.setPassword(t,e).then((function(t){console.log(t?"Password changed":"Failed to change password"),n.closeEditPasswordDialog()})).catch((function(t){n.passwordErrorMessage=t.message})).finally((function(){n.settingPassword=!1}))},closeEditPasswordDialog:function(){this.passwordErrorMessage=null,this.password=null,this.newPassword1=null,this.newPassword2=null,this.showEditPasswordDialog=!1}}},Yi=Ji,Gi=(n("b3d7"),Object(c["a"])(Yi,zi,Hi,!1,null,null,null)),qi=Gi.exports;u()(Gi,{VAvatar:ct["a"],VBtn:k["a"],VCard:si["a"],VCardActions:yi["a"],VCardText:yi["b"],VCardTitle:yi["c"],VCol:N["a"],VContainer:U["a"],VDialog:wi["a"],VDivider:xi["a"],VIcon:I["a"],VRow:F["a"],VSpacer:Ri["a"],VTextField:Oi["a"]});var Qi=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"create-room"},[n("div",[n("v-container",{attrs:{fluid:""}},[n("div",{staticClass:"room-name"},[t._v("New Group")]),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.$navigation&&t.$navigation.canPop(),expression:"$navigation && $navigation.canPop()"}],staticClass:"header-button-left",attrs:{text:"",disabled:t.step>t.steps.NAME_SET},on:{click:function(e){return e.stopPropagation(),t.goBack(e)}}},[n("v-icon",[t._v("arrow_back")]),n("span",[t._v("BACK")])],1),n("v-btn",{staticClass:"header-button-right",attrs:{text:"",disabled:!t.roomName||t.step!=t.steps.INITIAL&&t.step!=t.steps.CREATED},on:{click:function(e){return e.stopPropagation(),t.next(e)}}},[n("span",[t._v(t._s(t.step==t.steps.CREATED?"Done":"Next"))])])],1)],1),n("v-container",{staticStyle:{"margin-top":"40px"},attrs:{fluid:""}},[n("v-row",[n("v-col",{attrs:{cols:"auto"}},[n("v-avatar",{attrs:{size:"50",color:"#ededed"},on:{click:function(e){return e.stopPropagation(),t.showAvatarPicker(e)}}},[t.roomAvatar?n("v-img",{attrs:{src:t.roomAvatar}}):n("v-icon",[t._v("camera_alt")])],1)],1),n("v-col",[n("v-text-field",{attrs:{label:"Name group",color:"black","background-color":"white",disabled:t.step>t.steps.INITIAL},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.$refs.topic.focus()}},model:{value:t.roomName,callback:function(e){t.roomName=e},expression:"roomName"}})],1)],1)],1),n("v-fade-transition",[t.step>t.steps.INITIAL?n("div",{staticClass:"section ma-3",attrs:{flat:""}},[n("div",{staticClass:"h4 text-left"},[t._v("Join permissions")]),n("div",{staticClass:"h2 text-left"},[t._v("Set Join Permissions")]),n("div",[t._v(" These permissions determine how people can join the group and how easily others can be invited. They can be changed anytime. ")]),n("v-select",{staticClass:"mt-4",attrs:{disabled:t.step>=t.steps.CREATING,items:t.joinRules,"item-value":"id"},scopedSlots:t._u([{key:"selection",fn:function(e){var n=e.item;return[t._v(" "+t._s(n.text)+" ")]}},{key:"item",fn:function(e){e.active;var o=e.item,i=e.attrs,a=e.on;return[n("v-list-item",t._g(t._b({scopedSlots:t._u([{key:"default",fn:function(e){var i=e.active;return[n("v-list-item-avatar",[n("v-icon",{staticClass:"grey lighten-1",attrs:{dark:""}},[t._v(t._s(o.icon))])],1),n("v-list-item-content",[n("v-list-item-title",{domProps:{textContent:t._s(o.text)}}),n("v-list-item-subtitle",{domProps:{textContent:t._s(o.descr)}})],1),n("v-list-item-action",[i?n("v-btn",{attrs:{icon:""}},[n("v-icon",{attrs:{color:"grey lighten-1"}},[t._v("check")])],1):t._e()],1)]}}],null,!0)},"v-list-item",i,!1),a))]}}],null,!1,4161192351),model:{value:t.joinRule,callback:function(e){t.joinRule=e},expression:"joinRule"}}),n("v-divider",{staticStyle:{"margin-bottom":"20px"}}),t.publicRoomLink?n("v-text-field",{staticClass:"room-link",attrs:{value:t.publicRoomLink,readonly:"",filled:"","background-color":"transparent","append-icon":"content_copy",type:"text"},on:{"click:append":function(e){return e.stopPropagation(),t.copyRoomLink(e)}}}):"public"==t.joinRule?n("v-btn",{staticClass:"outlined-button",attrs:{loading:t.step==t.steps.CREATING,block:"",depressed:""},on:{click:function(e){return e.stopPropagation(),t.getPublicLink(e)}}},[n("v-icon",{staticClass:"mr-2"},[t._v("link")]),t._v("Get link")],1):"invite"==t.joinRule?n("v-btn",{staticClass:"outlined-button",attrs:{block:"",depressed:""},on:{click:function(e){return e.stopPropagation(),t.addPeople(e)}}},[n("v-icon",{staticClass:"mr-2"},[t._v("person_add")]),t._v("Add people")],1):t._e(),t.publicRoomLinkCopied?n("div",{staticClass:"link-copied"},[t._v("Link copied!")]):t._e(),t.status?n("div",[t._v(t._s(t.status))]):t._e()],1):t._e()]),n("input",{ref:"avatar",staticStyle:{display:"none"},attrs:{type:"file",name:"avatar",accept:"image/*"},on:{change:function(e){return t.handlePickedAvatar(e)}}})],1)},Xi=[],Ki=(n("dca8"),Object.freeze({INITIAL:0,NAME_SET:1,CREATING:2,CREATED:3})),Zi={name:"CreateRoom",data:function(){return{steps:Ki,step:Ki.INITIAL,roomId:null,roomName:"",roomTopic:"",roomAvatar:null,roomAvatarFile:null,status:"",joinRule:0,joinRules:[{id:"public",text:"Anyone with a link",icon:"link",descr:"Get a link to share"},{id:"invite",text:"Only people added",icon:"person_add",descr:"Choose from a list or search by account ID"}],publicRoomLink:null,publicRoomLinkCopied:!1}},mounted:function(){this.joinRule=this.joinRules[0].id},watch:{joinRule:function(){console.log("Join rule changed to",this.joinRule)}},computed:{roomAvatarLetter:function(){return this.roomName?this.roomName.substring(0,1).toUpperCase():null}},methods:{goBack:function(){this.step==Ki.NAME_SET?this.step=Ki.INITIAL:this.$navigation.pop()},next:function(){var t=this;this.step==Ki.CREATED?this.openRoom():this.step==Ki.INITIAL?this.step=Ki.NAME_SET:this.step==Ki.NAME_SET&&this.createRoom().then((function(e){t.roomId=e,t.openRoom()}))},openRoom:function(){this.roomId&&this.$navigation.push({name:"Chat",params:{roomId:w["a"].sanitizeRoomId(this.roomId)}},-1)},getPublicLink:function(){var t=this;this.createRoom().then((function(e){t.roomId=e;var n=null;e&&(n=t.$matrix.getRoom(e)),n&&(t.publicRoomLink=t.$router.getRoomLink(n.getCanonicalAlias()||e))}))},addPeople:function(){var t=this;this.createRoom().then((function(e){t.roomId=e,t.$matrix.setCurrentRoomId(e),t.$navigation.push({name:"Invite"},1)}))},createRoomDebug:function(){var t=this;return this.step=Ki.CREATING,new Promise((function(e,n){setTimeout((function(){t.step=Ki.CREATED,e("#NpexPublicRoom2:neo.keanu.im")}),5e3)}))},createRoom:function(){var t,e=this;this.step=Ki.CREATING,this.status="Creating room";var n={};return n="public"==this.joinRule?{visibility:"private",room_alias_name:this.roomName.replace(/\s/g,"").toLowerCase(),name:this.roomName,preset:"public_chat",initial_state:[{type:"m.room.encryption",state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]}:{visibility:"private",name:this.roomName,preset:"private_chat",initial_state:[{type:"m.room.encryption",state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}},{type:"m.room.guest_access",state_key:"",content:{guest_access:"forbidden"}}]},this.roomTopic&&this.roomTopic.length>0&&(n.topic=this.roomTopic),this.$matrix.matrixClient.createRoom(n).then((function(n){var o=n.room_id,i=n.room_alias;if(t=i||o,!e.roomAvatarFile)return!0;var a=e;return w["a"].setRoomAvatar(e.$matrix.matrixClient,o,e.roomAvatarFile,(function(t){t.total?a.status="Uploading avatar: "+(t.loaded||0)+" of "+t.total:a.status="Uploading avatar: "+(t.loaded||0)}))})).then((function(){return e.status="",e.step=Ki.CREATED,t})).catch((function(t){return e.status=t.data&&t.data.error||t.message||t.toString(),e.step=Ki.NAME_SET,null}))},showAvatarPicker:function(){this.step==Ki.INITIAL&&this.$refs.avatar.click()},handlePickedAvatar:function(t){var e=this;if(t.target.files&&t.target.files[0]){var n=new FileReader;n.onload=function(n){e.roomAvatar=n.target.result,e.roomAvatarFile=t.target.files[0]},n.readAsDataURL(t.target.files[0])}},copyRoomLink:function(){var t=this;this.$copyText(this.publicRoomLink).then((function(e){t.publicRoomLinkCopied=!0,setInterval((function(){t.publicRoomLinkCopied=!1}),3e3)}),(function(t){console.log(t)}))}}},ta=Zi,ea=(n("0bce"),Object(c["a"])(ta,Qi,Xi,!1,null,null,null)),na=ea.exports;u()(ea,{VAvatar:ct["a"],VBtn:k["a"],VCol:N["a"],VContainer:U["a"],VDivider:xi["a"],VFadeTransition:O["c"],VIcon:I["a"],VImg:T["a"],VListItem:S["a"],VListItemAction:P["a"],VListItemAvatar:$["a"],VListItemContent:A["a"],VListItemSubtitle:A["b"],VListItemTitle:A["c"],VRow:F["a"],VSelect:Mi["a"],VTextField:Oi["a"]}),o["a"].use(g["a"]);var oa=[{path:"/",name:"Home",component:z},{path:"/room/:roomId?",name:"Chat",component:Ti,meta:{includeRoom:!0}},{path:"/info",name:"RoomInfo",component:function(){return n.e("chunk-3bf6242b").then(n.bind(null,"92df"))},props:!0,meta:{title:"Info",includeRoom:!0}},{path:"/profile",name:"Profile",component:qi,meta:{title:"Profile"}},{path:"/createroom",name:"CreateRoom",component:na,meta:{title:"Create room"}},{path:"/login",name:"Login",component:Wi,props:!0},{path:"/join/:roomId?",name:"Join",component:Vi},{path:"/invite/:roomId?",name:"Invite",component:function(){return n.e("chunk-b8c12378").then(n.bind(null,"8aac"))},meta:{title:"Add Friends"}},{path:"/goodbye",name:"Goodbye",component:function(){return n.e("chunk-0f0ce3f1").then(n.bind(null,"76f5"))}}],ia=new g["a"]({routes:oa});ia.beforeEach((function(t,e,n){var o=["/login"],i=!o.includes(t.path),a=localStorage.getItem("user");if("Chat"==t.name||"Join"==t.name){!t.params.roomId&&t.hash&&(t.params.roomId=t.hash);var r=w["a"].sanitizeRoomId(t.params.roomId);ia.app.$matrix.setCurrentRoomId(r),r&&r.startsWith("#")&&(i=!1)}else if("Invite"==t.name&&t.params.roomId){var s=w["a"].sanitizeRoomId(t.params.roomId);ia.app.$matrix.setCurrentRoomId(s)}i&&!a?n("/login"):n()})),ia.getRoomLink=function(t){return window.location.origin+window.location.pathname+"#/room/"+encodeURIComponent(w["a"].sanitizeRoomId(t))};var aa=ia,ra=n("2f62"),sa=n("bfa9"),ca=JSON.parse(localStorage.getItem("user")),la=ca?{status:{loggedIn:!0},user:ca}:{status:{loggedIn:!1},user:null},ua={namespaced:!0,state:la,actions:{login:function(t,e){var n=t.commit;return this._vm.$matrix.login(e).then((function(t){return n("loginSuccess",t),Promise.resolve(t)}),(function(t){return n("loginFailure"),Promise.reject(t)}))},logout:function(t){var e=t.commit;this._vm.$matrix.logout(),e("logout")}},mutations:{loginSuccess:function(t,e){t.status.loggedIn=!0,t.user=e},loginFailure:function(t){t.status.loggedIn=!1,t.user=null},logout:function(t){t.status.loggedIn=!1,t.user=null},registerSuccess:function(t){t.status.loggedIn=!1},registerFailure:function(t){t.status.loggedIn=!1}}};o["a"].use(ra["a"]);var da=new sa["a"]({key:"settings",storage:localStorage,reducer:function(t){return{currentRoomId:t.currentRoomId}}}),ma=new ra["a"].Store({state:{currentRoomId:null},mutations:{setCurrentRoomId:function(t,e){t.currentRoomId=e}},actions:{},modules:{auth:ua},plugins:[da.plugin]}),va=n("ba3f"),ha=n("2909"),fa={install:function(t,e){var n=[],o=null,i=void 0;e.beforeResolve((function(t,e,o){i||(n=[t],i=window.history.length),o()})),e.beforeEach((function(t,e,i){if(o&&(console.log("Nav: next routes set, going:",n,o),n=o,o=null,n.length>0))return console.log("Redirecting to",n[n.length-1]),void i(n[n.length-1]);i()}));var a={push:function(t,i){void 0===i&&(i=1),-1==i?o=[t]:0==i?(o=Object(ha["a"])(n),o.pop(),o.push(t)):(o=Object(ha["a"])(n),o.push(t));var a=o.length-n.length,r=o.length-1;console.log("Nav - index "+a+" Target "+r),a<0?(console.log("Nav - go "+a),e.go(a)):0==a?(console.log("Nav - replace"),n=o,o=null,e.replace(t).catch((function(t){}))):(console.log("Nav - push"),e.push(t).catch((function(t){})))},canPop:function(){return o?o.length>1:n.length>1},pop:function(){n.pop(),e.go(-1)}};t.prototype.$navigation=a}},pa=n("262e"),ga=n("2caf"),ba=(n("b64b"),n("041e")),_a={install:function(t){var e=function(t){Object(pa["a"])(n,t);var e=Object(ga["a"])(n);function n(){return Object(Nt["a"])(this,n),e.apply(this,arguments)}return Object(Ut["a"])(n,[{key:"showForCampaign",value:function(t,e,n){var o=e.nextTotalMeasurementPeriod;if(!o)return"";var i="Help us improve!\n\n"+"We would like to collect anonymous usage data between ".concat(o.start.format("LLL")," and ").concat(o.end.format("LLL")," to improve the quality of the product.\n\nYour help would be highly appreciated.");return n(window.confirm(i)),""}}]),n}(ba["ConsentRequestUi"]),n=new t({data:function(){return{ci:null,campaignId:null,requestUi:null}},created:function(){var t=fi.analytics||{};t.enabled&&t.config&&(this.ci=new ba["CleanInsights"](t.config),this.campaignId=Object.keys(t.config.campaigns||{invalid:{}})[0])},methods:{event:function(t,n){var o=this;this.ci&&(this.requestUi||(this.requestUi=new e),this.ci.requestConsentForCampaign(this.campaignId,this.requestUi,(function(e){e&&o.ci.measureEvent(t,n,o.campaignId)})))}}});t.prototype.$ci=n}},Ca=(n("d5e8"),n("d1e78"),n("79b5")),ya=n("252c"),wa=(n("6eb0"),n("4eb5")),xa=n.n(wa),Ra=n("0ec9"),ka=n.n(Ra),Ia=ka.a.defaults;Ia.disallowedTagsMode="recursiveEscape",Ia.allowedTags=[],o["a"].use(ka.a,Ia),o["a"].config.productionTip=!1,o["a"].use(ya["a"]),o["a"].use(Ca["a"]),o["a"].use(va["a"],{store:ma}),o["a"].use(_a),o["a"].use(xa.a),o["a"].use((function(t){t.prototype.$bubble=function(t){for(var e=this,n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];do{var a;(a=e).$emit.apply(a,[t].concat(o)),e=e.$parent}while(e)}})),o["a"].directive("blur",{inserted:function(t){t.onfocus=function(t){return t.target.blur()}}}),o["a"].directive("longTap",{bind:function(t,e,n){t.longTapTimeout=parseInt(e.arg||"500"),t.longTapCallbacks=e.value;for(var o=t.longTapCallbacks.length;o<2;o++)t.longTapCallbacks.splice(0,0,null);var i=function(t){return-1!==t.type.indexOf("mouse")?t.clientX:t.touches[0].clientX},a=function(t){return-1!==t.type.indexOf("mouse")?t.clientY:t.touches[0].clientY},r=function(){t.longTapHandled=!0,t.longTapCallbacks[1]&&t.longTapCallbacks[1].call(),t.longTapTimer=null,t.classList.remove("waiting-for-long-tap")},s=function(e){t.longTapHandled=!1,t.longTapStartX=i(e),t.longTapStartY=a(e),t.longTapTimer=setTimeout(r,t.longTapTimeout),t.classList.add("waiting-for-long-tap"),e.preventDefault()},c=function(){t.longTapHandled=!0,t.longTapTimer&&clearTimeout(t.longTapTimer),t.longTapTimer=null,t.classList.remove("waiting-for-long-tap")},l=function(){t.longTapTimer&&clearTimeout(t.longTapTimer),t.longTapTimer=null,t.longTapHandled||t.longTapCallbacks[0]&&t.longTapCallbacks[0].call(),t.classList.remove("waiting-for-long-tap")},u=function(e){t.longTapCurrentX=i(e),t.longTapCurrentY=a(e);var n=4,o=Math.abs(t.longTapStartX-t.longTapCurrentX)>n||Math.abs(t.longTapStartY-t.longTapCurrentY)>n;o&&c()};t.longTapTouchStart=s,t.longTapTouchEnd=l,t.longTapTouchCancel=c,t.longTapTouchMove=u,t.addEventListener("touchstart",s),t.addEventListener("touchend",l),t.addEventListener("touchcancel",c),t.addEventListener("touchmove",u),t.addEventListener("mousedown",s),t.addEventListener("mouseup",l),t.addEventListener("mousemove",u)},unbind:function(t){t.longTapTimer&&clearTimeout(t.longTapTimer),t.removeEventListener("touchstart",t.longTapTouchStart),t.removeEventListener("touchend",t.longTapTouchEnd),t.removeEventListener("touchcancel",t.longTapTouchCancel),t.removeEventListener("touchmove",t.longTapTouchMove),t.removeEventListener("mousedown",t.longTapTouchStart),t.removeEventListener("mouseup",t.longTapTouchEnd),t.removeEventListener("mousemove",t.longTapTouchMove)}}),o["a"].use(fa,aa),new o["a"]({vuetify:p,router:aa,store:ma,matrix:va["a"],cleaninsights:_a,render:function(t){return t(h)}}).$mount("#app")},5885:function(t,e,n){"use strict";n("b149")},"58d3":function(t,e,n){},"5b89":function(t,e,n){t.exports=n.p+"img/av_cat.152143a7.png"},"5c0b":function(t,e,n){"use strict";n("9c0c")},"5c74":function(t,e,n){t.exports=n.p+"img/av_panda.5b6eb785.png"},6:function(t,e){},"60c0":function(t,e,n){"use strict";n("4faa")},6184:function(t,e,n){},"650e":function(t,e,n){t.exports=n.p+"img/av_tiger.d4418fd9.png"},"65af":function(t,e,n){},6877:function(t,e,n){"use strict";n("4162")},"6a23":function(t,e,n){t.exports=n.p+"img/av_osprey.0ee2ef1c.png"},"6a42":function(t,e,n){"use strict";n("d4c3")},"6ba5":function(t,e,n){t.exports=n.p+"img/av_panther.bd8e1503.png"},7:function(t,e){},"720a":function(t,e,n){},"73d8":function(t,e,n){t.exports=n.p+"img/av_otter.e251be0c.png"},"768b":function(t,e,n){t.exports=n.p+"img/av_mantis.a0086bc3.png"},7740:function(t,e,n){t.exports=n.p+"img/av_bunny.2787a707.png"},7924:function(t,e,n){"use strict";n("ce25")},"7af4":function(t,e,n){t.exports=n.p+"img/av_iguna.744f7412.png"},"7bbb":function(t,e,n){"use strict";n("dec17")},"7bed":function(t,e,n){},"7e6d":function(t,e,n){t.exports=n.p+"img/av_dragonfly.08cea848.png"},"7edc":function(t,e,n){t.exports=n.p+"img/av_hummingbird.abadb545.png"},8:function(t,e){},"819a":function(t,e,n){"use strict";n("afad")},"81a0":function(t,e,n){t.exports=n.p+"img/av_turtle.80b5d008.png"},"83ed":function(t,e,n){t.exports=n.p+"img/av_orangutan.31fa41b2.png"},"84b5":function(t,e,n){},86543:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var o=n("d4ec"),i=n("bee2"),a=n("ade3"),r=(n("2ca0"),n("caad"),n("2532"),n("ac1f"),n("1276"),function(){function t(e,n,i,r){Object(o["a"])(this,t),Object(a["a"])(this,"normalize",(function(){if(this.user_id.startsWith("@")&&this.user_id.includes(":")){var t=this.user_id.split(":");this.user_id=t[0].substring(1),this.home_server="https://"+t[1]}})),this.home_server=e,this.user_id=n,this.password=i,this.is_guest=r||!1}return Object(i["a"])(t,null,[{key:"localPart",value:function(t){if(t&&t.startsWith("@")&&t.includes(":")){var e=t.split(":");return e[0].substring(1)}return t}}]),t}());Object(a["a"])(r,"homeServerUrl",(function(t){return t&&!t.startsWith("https://")?"https://"+t:t}))},"86d4":function(t,e,n){},8828:function(t,e,n){t.exports=n.p+"img/av_owl.711727bb.png"},"8aa7e":function(t,e,n){t.exports=n.p+"img/av_starfish.5fab06a7.png"},"8ead":function(t,e,n){t.exports=n.p+"img/av_horse.5b902952.png"},"8f2c":function(t,e,n){},9:function(t,e){},"902b":function(t,e,n){"use strict";n("d402")},"921a":function(t,e,n){var o={"./av_baboon.png":"bcb7","./av_badger.png":"02f6","./av_bear.png":"c56a","./av_bee.png":"f46f","./av_beta.png":"0130","./av_bunny.png":"7740","./av_butterfly.png":"ebf5","./av_cardinal.png":"f3a3d","./av_cat.png":"5b89","./av_cockatoo.png":"ec1f","./av_crab.png":"a9ada","./av_crane.png":"dcc7","./av_dragonfly.png":"7e6d","./av_eagle.png":"53ed","./av_egret.png":"ad17","./av_elephant.png":"a3d9","./av_flamingo.png":"e199","./av_fox.png":"af6a","./av_gazelle.png":"9c44","./av_giraffe.png":"9968","./av_gorilla.png":"c300","./av_hedgehog.png":"1301","./av_hippo.png":"c517","./av_horse.png":"8ead","./av_hummingbird.png":"7edc","./av_iguna.png":"7af4","./av_jellyfish.png":"061b","./av_leopard.png":"2f9f","./av_lion.png":"cddb","./av_lionfish.png":"d4da","./av_lizard.png":"db7c","./av_macaw.png":"19ad","./av_mantis.png":"768b","./av_octopus.png":"03e5","./av_orangutan.png":"83ed","./av_osprey.png":"6a23","./av_otter.png":"73d8","./av_owl.png":"8828","./av_panda.png":"5c74","./av_pangolin.png":"329e","./av_panther.png":"6ba5","./av_peacock.png":"1eb2","./av_penguin.png":"e175","./av_polar bear.png":"403a","./av_puffin.png":"19df","./av_puppy.png":"b459","./av_rhino.png":"b504","./av_rooster.png":"f305","./av_shark.png":"977f","./av_sloth.png":"b74f","./av_snake.png":"5029","./av_squirrel.png":"0478","./av_starfish.png":"8aa7e","./av_stingray.png":"b302","./av_tiger.png":"650e","./av_tucan.png":"132f","./av_turtle.png":"81a0","./av_walrus.png":"2c30","./av_whaleshark.png":"e99d","./av_yak.png":"b95f","./av_zebra.png":"2f1c"};function i(t){var e=a(t);return n(e)}function a(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}i.keys=function(){return Object.keys(o)},i.resolve=a,t.exports=i,i.id="921a"},"955c":function(t,e,n){"use strict";n("7bed")},"977f":function(t,e,n){t.exports=n.p+"img/av_shark.545e47bb.png"},"97a3":function(t,e,n){},"97ad":function(t,e,n){},98614:function(t,e,n){"use strict";n("49c5")},9968:function(t,e,n){t.exports=n.p+"img/av_giraffe.7af253ac.png"},"9c0c":function(t,e,n){},"9c37":function(t,e,n){"use strict";n("d43f")},"9c44":function(t,e,n){t.exports=n.p+"img/av_gazelle.4a3025c3.png"},"9cdd":function(t,e,n){"use strict";n("abbc")},"9eba":function(t,e,n){"use strict";n("4451")},a28e:function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="a28e"},a384:function(t,e,n){},a3d9:function(t,e,n){t.exports=n.p+"img/av_elephant.cbbeeff1.png"},a826:function(t,e,n){"use strict";n("97a3")},a9ada:function(t,e,n){t.exports=n.p+"img/av_crab.331519ac.png"},ab89:function(t,e,n){},abbc:function(t,e,n){},ac7e:function(t,e,n){"use strict";n("6184")},ad17:function(t,e,n){t.exports=n.p+"img/av_egret.605ff296.png"},af6a:function(t,e,n){t.exports=n.p+"img/av_fox.e790d11c.png"},afad:function(t,e,n){},b149:function(t,e,n){},b302:function(t,e,n){t.exports=n.p+"img/av_stingray.e1cf4ae1.png"},b3d7:function(t,e,n){"use strict";n("16b0")},b459:function(t,e,n){t.exports=n.p+"img/av_puppy.3b09488c.png"},b504:function(t,e,n){t.exports=n.p+"img/av_rhino.2299bc9b.png"},b74f:function(t,e,n){t.exports=n.p+"img/av_sloth.1efebb51.png"},b899:function(t,e,n){},b95f:function(t,e,n){t.exports=n.p+"img/av_yak.91a75b41.png"},b9f6:function(t,e,n){"use strict";n("8f2c")},ba1e:function(t,e,n){"use strict";n("2582")},ba3f:function(t,e,n){"use strict";(function(t){var o=n("b85c"),i=n("1da1"),a=(n("96cf"),n("4de4"),n("d3b7"),n("2ca0"),n("159b"),n("7db0"),n("b0c0"),n("3ca3"),n("ddb0"),n("99af"),n("ac1f"),n("1276"),n("c4f4")),r=n.n(a),s=n("d930"),c=n("86543"),l=n("db90");t.Olm=n("33cd");var u=n("3366").LocalStorageCryptoStore;r.a.setCryptoStoreFactory((function(){return new u(window.localStorage)})),e["a"]={install:function(t,e){if(!e||!e.store)throw new Error("Please initialise plugin with a Vuex store.");var n=e.store,u=new t({store:n,data:function(){return{matrixClient:null,matrixClientReady:!1,rooms:[],userDisplayName:null,userAvatar:null,currentRoom:null,notificationCount:0}},mounted:function(){console.log("Matrix service mounted")},computed:{ready:function(){return null!=this.matrixClient&&this.matrixClientReady},currentUser:function(){return this.$store.state.auth.user},currentUserId:function(){var t=this.currentUser||{};return t.user_id},currentUserDisplayName:function(){if(this.ready){var t=this.matrixClient.getUser(this.currentUserId)||{};return this.userDisplayName||t.displayName}return null},currentRoomId:function(){return this.$store.state.currentRoomId},joinedRooms:function(){return this.rooms.filter((function(t){return"join"===t._selfMembership}))},invites:function(){return this.rooms.filter((function(t){return"invite"===t._selfMembership}))}},watch:{currentRoomId:{immediate:!0,handler:function(t){this.currentRoom=this.getRoom(t)}}},methods:{login:function(t){var e,n=this,o=r.a.createClient(c["a"].homeServerUrl(t.home_server));if(t.access_token)e=Promise.resolve(t);else if(t.is_guest&&!t.user_id){var i=s["a"].randomUser(),a=s["a"].randomPass();e=o.register(i,a,null,{type:"m.login.dummy"}).then((function(t){return console.log("Response",t),t.password=a,t.is_guest=!0,localStorage.setItem("user",JSON.stringify(t)),t}))}else{var l={user:c["a"].localPart(t.user_id),password:t.password,type:"m.login.password"};t.device_id&&(l.device_id=t.device_id),e=o.login("m.login.password",l).then((function(e){var n=e;return t.is_guest&&(n=Object.assign(t,e)),localStorage.setItem("user",JSON.stringify(n)),e}))}return e.then((function(t){return n.getMatrixClient(t)}))},clearCryptoStore:function(){for(var t=[],e=0;e<localStorage.length;++e){var n=localStorage.key(e);n.startsWith("crypto.")&&t.push(n)}for(var o=0,i=t;o<i.length;o++){var a=i[o];localStorage.removeItem(a)}},logout:function(){var t=this;this.matrixClient?(this.removeMatrixClientListeners(this.matrixClient),this.matrixClient.stopClient(),this.matrixClient.clearStores().then((function(){t.clearCryptoStore()})),this.matrixClient=null,this.matrixClientReady=!1):this.clearCryptoStore(),localStorage.removeItem("user"),this.$store.commit("setCurrentRoomId",null),this.rooms=[],this.userDisplayName=null,this.userAvatar=null,this.currentRoom=null,this.notificationCount=0},initClient:function(){var t=this;this.reloadRooms(),this.matrixClientReady=!0,this.matrixClient.emit("Matrix.initialized",this.matrixClient),this.matrixClient.getProfileInfo(this.currentUserId).then((function(e){console.log("Got user profile: "+JSON.stringify(e)),t.userDisplayName=e.displayname,t.userAvatar=e.avatar_url})).catch((function(t){console.log("Failed to get user profile: ",t)}))},getMatrixClient:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var o,i,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(void 0===t&&(t=e.$store.state.auth.user),!e.matrixClientReady){n.next=5;break}return n.abrupt("return",new Promise((function(e,n){e(t)})));case 5:if(!e.matrixClient){n.next=7;break}return n.abrupt("return",new Promise((function(n,o){e.matrixClient.once("Matrix.initialized",(function(e){n(t)}))})));case 7:return o=new r.a.MemoryStore(window.localStorage),i=new r.a.WebStorageSessionStore(window.localStorage),a=t.home_server,a.startsWith("https://")||(a="https://"+a),s={baseUrl:a,userId:t.user_id,store:o,sessionStore:i,deviceId:t.device_id,accessToken:t.access_token,timelineSupport:!0,unstableClientRelationAggregation:!0},e.matrixClient=r.a.createClient(s),n.abrupt("return",e.matrixClient.initCrypto().then((function(){return console.log("Crypto initialized"),e.addMatrixClientListeners(e.matrixClient),e.matrixClient.startClient(),e.matrixClient})).then((function(t){return t.isInitialSyncComplete()?(console.log("Initial sync done already!"),t):new Promise((function(e,n){t.once("sync",(function(o,i,a){console.log(o),"PREPARED"==o?e(t):"ERROR"==o&&n("Error syncing")}))}))})).then((function(){return e.initClient(),t})));case 14:case"end":return n.stop()}}),n)})))()},addMatrixClientListeners:function(t){t&&(t.on("event",this.onEvent),t.on("Room",this.onRoom),t.on("Session.logged_out",this.onSessionLoggedOut),t.on("Room.myMembership",this.onRoomMyMembership))},removeMatrixClientListeners:function(t){t&&(t.off("event",this.onEvent),t.off("Room",this.onRoom),t.off("Session.logged_out",this.onSessionLoggedOut),t.off("Room.myMembership",this.onRoomMyMembership))},onEvent:function(e){switch(e.getType()){case"m.room.topic":var n=this.matrixClient.getRoom(e.getRoomId());n&&t.set(n,"topic",e.getContent().topic);break;case"m.room.avatar":var o=this.matrixClient.getRoom(e.getRoomId());o&&t.set(o,"avatar",o.getAvatarUrl(this.matrixClient.getHomeserverUrl(),80,80,"scale",!0));break}this.updateNotificationCount()},onRoom:function(t){console.log("Got room: "+t),this.reloadRooms(),this.updateNotificationCount()},onRoomMyMembership:function(t){"invite"===t._selfMembership&&(t.recalculate(),this.reloadRooms())},onSessionLoggedOut:function(){console.log("Logged out!"),this.matrixClient&&(this.removeMatrixClientListeners(this.matrixClient),this.matrixClient.stopClient(),this.matrixClient=null,this.matrixClientReady=!1);var t=JSON.parse(localStorage.getItem("user"));t.is_guest?(delete t.access_token,localStorage.setItem("user",JSON.stringify(t)),this.login(t)):(localStorage.removeItem("user"),this.$store.commit("setCurrentRoomId",null),this.$navigation.push({path:"/login"},-1))},reloadRooms:function(){var e=this,n=this.matrixClient.getVisibleRooms();n=n.filter((function(t){return t._selfMembership&&("invite"==t._selfMembership||"join"==t._selfMembership)})),n.forEach((function(n){n.avatar||t.set(n,"avatar",n.getAvatarUrl(e.matrixClient.getHomeserverUrl(),80,80,"scale",!0))})),console.log("Reload rooms",n),t.set(this,"rooms",n);var o=this.getRoom(this.$store.state.currentRoomId);this.currentRoom!=o&&(this.currentRoom=o)},setCurrentRoomId:function(t){this.$store.commit("setCurrentRoomId",t),this.currentRoom=this.getRoom(t)},getRoom:function(t){if(!t)return null;var e=null;if(this.matrixClient){var n=this.matrixClient.getRooms();e=n.find((function(e){return t.startsWith("#")?e.getCanonicalAlias()==t:e.roomId==t}))}return e||null},getAllFriends:function(){var t,e={},n=[],i=Object(o["a"])(this.rooms);try{for(i.s();!(t=i.n()).done;){var a=t.value;if("join"==a._selfMembership&&"invite"==this.getRoomJoinRule(a)){var r,s=Object(o["a"])(a.getJoinedMembers());try{for(s.s();!(r=s.n()).done;){var c=r.value;c.userId==this.currentUserId||e[c.userId]||(e[c.userId]=c,n.push(c))}}catch(l){s.e(l)}finally{s.f()}}}}catch(l){i.e(l)}finally{i.f()}return n.sort((function(t,e){var n=t.user?t.user.displayName:t.name,o=e.user?e.user.displayName:e.name;return n.localeCompare(o)})),n},getRoomJoinRule:function(t){if(t){var e=t.currentState.getStateEvents("m.room.join_rules","");return e&&e.getContent().join_rule}return null},leaveRoom:function(t){var e=this;return this.matrixClient.leave(t,void 0).then((function(){e.rooms=e.rooms.filter((function(t){t.roomId})),e.matrixClient.store.removeRoom(t)}))},purgeRoom:function(t){var e=this;return new Promise((function(n,o){var i=e.getRoom(t);if(i){var r=new a["TimelineWindow"](e.matrixClient,i.getUnfilteredTimelineSet(),{}),s=e;console.log("Purge: set invite only"),e.matrixClient.sendStateEvent(t,"m.room.join_rules",{join_rule:"invite"},"").then((function(){return console.log("Purge: forbid guest access"),e.matrixClient.sendStateEvent(t,"m.room.guest_access",{guest_access:"forbidden"},"")})).then((function(){return console.log("Purge: set history visibility to 'joined'"),e.matrixClient.sendStateEvent(t,"m.room.history_visibility",{history_visibility:"joined"})})).then((function(){return console.log("Purge: create timeline"),r.load(null,100)})).then((function(){var t=function t(){return r.canPaginate(a["EventTimeline"].BACKWARDS)?(console.log("Purge: page back"),r.paginate(a["EventTimeline"].BACKWARDS,100,!0,5).then((function(e){return t.call(s)}))):Promise.resolve("Done")}.bind(s);return t()})).then((function(){console.log("Purge: redact events");var t=[];return r.getEvents().forEach((function(n){n.isRedacted()||n.isRedaction()||n.isState()||t.push(e.matrixClient.redactEvent(n.getRoomId(),n.getId()))})),Promise.all(t)})).then((function(){console.log("Purge: kick members");var n=i.getMembersWithMembership("join"),o=i.getMembersWithMembership("invite"),a=n.concat(o),r=[];return a.forEach((function(n){n.userId!=s.currentUserId&&r.push(e.matrixClient.kick(t,n.userId))})),Promise.all(r)})).then((function(){n(!0)})).catch((function(t){console.error("Error purging room",t),o(t)}))}else o("Room not found!")}))},on:function(t,e){this.matrixClient&&this.matrixClient.on(t,e)},off:function(t,e){this.matrixClient&&this.matrixClient.off(t,e)},setPassword:function(t,e){if(this.matrixClient&&this.currentUser){var n={type:"m.login.password",identifier:{type:"m.id.user",user:this.currentUser.user_id},user:this.currentUser.user_id,password:t},o=this;return this.matrixClient.setPassword(n,e).then((function(){o.currentUser.password=void 0,o.currentUser.is_guest=!1,localStorage.setItem("user",JSON.stringify(o.currentUser))})).then((function(){return!0}))}return Promise.resolve(!1)},uploadFile:function(t,e){return this.matrixClient.uploadContent(t,e)},getPublicRoomInfo:function(t){var e=this;if(!t)return Promise.reject("Invalid parameters");var n=t.split(":");if(2!=n.length)return Promise.reject("Unknown room server");var i,a=n[1];if(this.matrixClient)i=this.getMatrixClient().then((function(){return e.matrixClient}));else{var u=r.a.createClient(l.defaultServer),d=localStorage.getItem("tempuser"),m=null;if(d&&(m=JSON.parse(d)),m)i=Promise.resolve(m);else{var v=s["a"].randomUser(),h=s["a"].randomPass();i=u.register(v,h,null,{type:"m.login.dummy"}).then((function(t){return console.log("Response",t),t.password=h,t.is_guest=!0,localStorage.setItem("tempuser",JSON.stringify(t)),t}))}i=i.then((function(t){var e={user:c["a"].localPart(t.user_id),password:t.password,type:"m.login.password"};return t.device_id&&(e.device_id=t.device_id),u.login("m.login.password",e)})),i=i.then((function(t){var e={baseUrl:l.defaultServer,userId:t.user_id,accessToken:t.access_token,timelineSupport:!1},n=r.a.createClient(e);return n.startClient(),n}))}var f,p=function e(n,i){var r,s=Object(o["a"])(i.chunk);try{for(s.s();!(r=s.n()).done;){var c=r.value;if(t.startsWith("#")&&c.canonical_alias==t||t.startsWith("!")&&c.room_id==t)return c.avatar_url&&(c.avatar=n.mxcUrlToHttp(c.avatar_url,80,80,"scale",!0)),Promise.resolve(c)}}catch(l){s.e(l)}finally{s.f()}return i.next_batch?n.publicRooms({server:a,limit:1e3,since:i.next_batch}).then((function(t){return e(n,t)})).catch((function(t){return Promise.reject("Failed to find room: "+t)})):Promise.reject("No more data")};return i.then((function(t){return f=t,f.publicRooms({server:a,limit:1e3})})).then((function(t){return p(f,t)})).catch((function(t){return Promise.reject("Failed to find room: "+t)}))},updateNotificationCount:function(){var t=0;this.rooms.forEach((function(e){t+=e.getUnreadNotificationCount("total")||0})),this.notificationCount=t}}});t.prototype.$matrix=u}}}).call(this,n("c8ba"))},bcb7:function(t,e,n){t.exports=n.p+"img/av_baboon.748ddcc3.png"},bed4:function(t,e,n){"use strict";n("c428")},c300:function(t,e,n){t.exports=n.p+"img/av_gorilla.a95f8263.png"},c302:function(t,e,n){"use strict";n("281b")},c3d5:function(t,e,n){},c428:function(t,e,n){},c517:function(t,e,n){t.exports=n.p+"img/av_hippo.26533229.png"},c56a:function(t,e,n){t.exports=n.p+"img/av_bear.f1aa8118.png"},cb20:function(t,e,n){},cba1:function(t,e,n){},cddb:function(t,e,n){t.exports=n.p+"img/av_lion.4b529348.png"},ce25:function(t,e,n){},d034:function(t,e,n){"use strict";n("2b99")},d22f:function(t,e,n){},d2ea:function(t,e,n){"use strict";n("124a")},d402:function(t,e,n){},d43f:function(t,e,n){},d4c3:function(t,e,n){},d4da:function(t,e,n){t.exports=n.p+"img/av_lionfish.a6538492.png"},d930:function(t,e,n){"use strict";(function(t){var o=n("d4ec"),i=n("bee2"),a=(n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("a15b"),n("d81d"),n("ac1f"),n("1276"),n("b0c0"),n("b64b"),n("2ca0"),n("99af"),n("5319"),n("25f0"),n("466d"),n("a434"),n("159b"),n("fb6a"),n("bc3a")),r=n.n(a),s=n("10fe"),c=n("5a0c"),l=n("6c27").sha256,u=n("7247"),d=n("eacf"),m=n("23ad");c.extend(m);var v=n("d772");c.extend(v);var h=function(){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return void 0!==t||navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia},f=h(),p=function(){function e(){Object(o["a"])(this,e)}return Object(i["a"])(e,[{key:"getAttachment",value:function(t,e,n){var o=this;return new Promise((function(i,a){var s=e.getContent();if(null==s.url){var c=null,l=null;s.file&&s.file.url&&(l=s.file,c=t.mxcUrlToHttp(l.url)),null==c&&a("No url found!"),r.a.get(c,{responseType:"arraybuffer",onDownloadProgress:function(t){var e=Math.floor(100*t.loaded/t.total);n&&n(e)}}).then((function(t){return o.decryptIfNeeded(l,t)})).then((function(t){i(URL.createObjectURL(new Blob([t.buffer],{type:l.mimetype})))})).catch((function(t){console.log("Download error: ",t),a(t)})).finally((function(){n&&n(null)}))}else i(t.mxcUrlToHttp(s.url))}))}},{key:"getThumbnail",value:function(t,e,n,o){var i=this;return new Promise((function(n,o){var a=e.getContent();if(null==a.url){var s=null,c=null;a&&a.info&&a.info.thumbnail_file&&a.info.thumbnail_file.url?(c=a.info.thumbnail_file,s=t.mxcUrlToHttp(c.url)):a.file&&a.file.url&&(c=a.file,s=t.mxcUrlToHttp(c.url)),null!=s?r.a.get(s,{responseType:"arraybuffer"}).then((function(t){return i.decryptIfNeeded(c,t)})).then((function(t){n(URL.createObjectURL(new Blob([t.buffer],{type:c.mimetype})))})).catch((function(t){console.log("Download error: ",t),o(t)})):o("No url found!")}else n(t.mxcUrlToHttp(a.url))}))}},{key:"decryptIfNeeded",value:function(e,n){return new Promise((function(o,i){var a=d.decode(e.key.k),r=d.decode(e.iv),s=new u.ModeOfOperation.ctr(a,new u.Counter(r)),c=new Uint8Array(n.data),m=new Uint8Array(l.create().update(c).arrayBuffer()),v=d.decode(e.hashes.sha256);if(0==t.compare(t.from(m),t.from(v.buffer))){var h=s.decrypt(c);o(h)}else i("Hashes don't match!")}))}},{key:"sendTextMessage",value:function(t,e,n,o,i){var a=s["makeTextMessage"](n);if(o)a["m.relates_to"]={rel_type:"m.replace",event_id:o.getId()},a["m.new_content"]={body:a.body,msgtype:a.msgtype};else if(i){a["m.relates_to"]={"m.in_reply_to":{event_id:i.getId()}};var r=i.getContent().body.split("\n").map((function(t,e){return"> "+(0==e?"<"+i.getSender()+"> ":"")+t})).join("\n");a.body=r+"\n\n"+a.body}return this.sendMessage(t,e,"m.room.message",a)}},{key:"sendQuickReaction",value:function(t,e,n,o){var i={"m.relates_to":{key:n,rel_type:"m.annotation",event_id:o.getId()}};return this.sendMessage(t,e,"m.reaction",i)}},{key:"sendMessage",value:function(t,e,n,o){return new Promise((function(i,a){t.sendEvent(e,n,o,void 0,void 0).then((function(t){console.log("Message sent: ",t),i(!0)})).catch((function(e){if(console.log("Image send error: ",e),e&&"UnknownDeviceError"==e.name){console.log("Unknown devices. Mark as known before retrying.");for(var n=[],o=0,r=Object.keys(e.devices);o<r.length;o++)for(var s=r[o],c=e.devices[s],l=0,u=Object.keys(c);l<u.length;l++){var d=u[l],m=c[d];m.known||n.push(t.setDeviceKnown(s,d,!0))}Promise.all(n).then((function(){t.resendEvent(e.event,t.getRoom(e.event.getRoomId())).then((function(t){console.log("Message sent: ",t),i(!0)})).catch((function(t){a(t.toLocaleString())}))}))}else a(e.toLocaleString())}))}))}},{key:"sendImage",value:function(e,o,i,a){var r=this;return new Promise((function(s,c){var m=new FileReader;m.onload=function(m){var v=m.target.result,h=new Uint8Array(v),f={mimetype:i.type,size:i.size},p=i.name,g="m.image";i.type.startsWith("audio/")?g="m.audio":i.type.startsWith("video/")?g="m.video":i.type.startsWith("application/pdf")&&(g="m.file");var b={type:i.type,name:p,progressHandler:a,onlyContentUri:!1},_={body:p,info:f,msgtype:g};if("m.file"==g&&(_.filename=i.name),e.isRoomEncrypted(o)){var C=n("1c46"),y=C.randomBytes(32),w=t.concat([C.randomBytes(8),t.alloc(8)]),x=new u.ModeOfOperation.ctr(y,new u.Counter(w)),R=x.encrypt(h);h=R;var k=new Uint8Array(l.create().update(h).arrayBuffer()),I={kty:"oct",key_ops:["encrypt","decrypt"],alg:"A256CTR",k:d.encode(y),ext:!0},T={mimetype:i.type,key:I,iv:t.from(w).toString("base64").replace(/=/g,""),hashes:{sha256:t.from(k).toString("base64").replace(/=/g,"")},v:"v2"};_.file=T,b.type="application/octet-stream",e.uploadContent(h,b).then((function(t){return t.error?c(t.error):(T.url=t.content_uri,r.sendMessage(e,o,"m.room.message",_))})).then((function(t){s(t)})).catch((function(t){c(t)}))}else e.uploadContent(h,b).then((function(t){return _.url=t.content_uri,r.sendMessage(e,o,"m.room.message",_)})).then((function(t){s(t)})).catch((function(t){c(t)}))},m.onerror=function(t){c(t)},m.readAsArrayBuffer(i)}))}},{key:"randomUser",value:function(){return this.randomString(12,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}},{key:"randomPass",value:function(){return this.randomString(12,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#_-*+")}},{key:"randomString",value:function(t,e){for(var n="",o=e.length,i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*o));return n}},{key:"sanitizeRoomId",value:function(t){return t&&t.match(/^(!|#).+$/)?t:null}},{key:"getFirstVisibleElement",value:function(t){var e=this.findVisibleElements(t);return e&&e.length>0?e[0]:null}},{key:"getLastVisibleElement",value:function(t){var e=this.findVisibleElements(t);return e&&e.length>0?e[e.length-1]:null}},{key:"findVisibleElements",value:function(t){var e=this.findOneVisibleElement(t);if(e){var n=[t.children[e]],o=e-1;while(o>=0&&this.isChildVisible(t,t.children[o]))n.splice(0,0,t.children[o]),o-=1;o=e+1;while(o<t.children.length&&this.isChildVisible(t,t.children[o]))n.push(t.children[o]),o+=1;return n}return null}},{key:"isChildVisible",value:function(t,e){var n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),i=!(n.right<o.left||n.left>o.right||n.bottom<o.top||n.top>o.bottom);return i}},{key:"findOneVisibleElement",value:function(t){var e=0,n=t.children.length-1,o=t.scrollTop;while(e<=n){var i=Math.floor((e+n)/2),a=t.children[i];if(this.isChildVisible(t,a))return i;a.offsetTop<o?e=i+1:n=i-1}return null}},{key:"_importAll",value:function(t){var e=[];return t.keys().forEach((function(n){console.log("Avatar",n);var o=n.split("_")[1];o=o.slice(0,o.indexOf(".")),o=o.charAt(0).toUpperCase()+o.slice(1);var i=t(n);e.push({id:n,image:i,name:"Guest "+o})})),e}},{key:"getDefaultAvatars",value:function(){return this._importAll(n("921a"))}},{key:"setAvatar",value:function(t,e,n){return new Promise((function(o,i){r.a.get(e,{responseType:"arraybuffer"}).then((function(e){var a,r={type:e.headers["content-type"].split(";")[0],name:"Avatar",progressHandler:n,onlyContentUri:!1};t.matrixClient.uploadContent(e.data,r).then((function(e){return a=e.content_uri,t.matrixClient.setAvatarUrl(a)})).then((function(e){t.userAvatar=a,o(e)})).catch((function(t){i(t)}))})).catch((function(t){i(t)}))}))}},{key:"setRoomAvatar",value:function(t,e,n,o){return new Promise((function(i,a){var r=new FileReader;r.onload=function(r){var s=r.target.result,c=new Uint8Array(s),l={mimetype:n.type,size:n.size},u={type:n.type,name:"Room Avatar",progressHandler:o,onlyContentUri:!1},d={body:n.name,info:l};t.uploadContent(c,u).then((function(n){return d.url=n.content_uri,t.sendStateEvent(e,"m.room.avatar",d)})).then((function(t){i(t)})).catch((function(t){a(t)}))},r.onerror=function(t){a(t)},r.readAsArrayBuffer(n)}))}},{key:"dayDiff",value:function(t,e){var n=c(t).endOf("day"),o=c(e).endOf("day");return o.diff(n,"day")}},{key:"formatDay",value:function(t){var e=c(t).endOf("day"),n=c().endOf("day"),o=n.diff(e,"day");return o<1?"Today":o<2?"Yesterday":o<7?o+" days ago":e.format("L")}},{key:"formatRecordDuration",value:function(t){return c.duration(t).format("HH:mm:ss")}},{key:"formatRecordStartTime",value:function(t){var e=c(t);return e.format("lll")}},{key:"browserCanRecordAudio",value:function(){return f}}]),e}();e["a"]=new p}).call(this,n("1c35").Buffer)},d9a4:function(t,e,n){"use strict";n("4060")},db7c:function(t,e,n){t.exports=n.p+"img/av_lizard.542e0b1b.png"},db90:function(t){t.exports=JSON.parse('{"defaultServer":"https://nang.zom.im","useShortCodeStickers":false,"analytics":{"enabled":false,"config":{}}}')},dcc7:function(t,e,n){t.exports=n.p+"img/av_crane.5ebd657e.png"},dd2a:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-dialog",{directives:[{name:"show",rawName:"v-show",value:t.room,expression:"room"}],staticClass:"ma-0 pa-0",attrs:{width:"80%"},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[n("div",{staticClass:"dialog-content text-center"},["public"==t.roomJoinRule?[n("h1",[t._v("👋")]),n("h2",{staticClass:"dialog-title"},[t._v(" Goodbye, "+t._s(t.$matrix.currentUserDisplayName)+". ")]),t.$matrix.currentUser.is_guest&&t.lastRoom?n("div",{staticClass:"dialog-text"},[t._v(" If you want to join this group again, you can join under a new identity. To keep "+t._s(t.$matrix.currentUserDisplayName)+", "),n("a",{on:{click:function(e){return e.preventDefault(),t.viewProfile(e)}}},[t._v("create an account")]),t._v(". ")]):n("div",{staticClass:"dialog-text"},[t._v(" You can always join this room again if you know the link. ")])]:[n("v-icon",{attrs:{color:"black",size:"30"}},[t._v("lock")]),n("h2",{staticClass:"dialog-title"},[t._v("Are you sure you want to leave?")]),n("div",{staticClass:"dialog-text"},[t._v(" This group is locked. You cannot rejoin without a special permission. ")])],n("v-container",{attrs:{fluid:""}},[n("v-row",{attrs:{cols:"12"}},[n("v-col",{attrs:{cols:"6"}},[n("v-btn",{staticClass:"text-button",attrs:{depressed:"",text:"",block:""},on:{click:function(e){t.showDialog=!1}}},[t._v("Go back")])],1),n("v-col",{attrs:{cols:"6",align:"center"}},[n("v-btn",{staticClass:"filled-button",attrs:{color:"red",depressed:"",block:""},on:{click:function(e){return e.stopPropagation(),t.onLeaveRoom()}}},[t._v("Leave")])],1)],1)],1)],2)])},i=[],a=n("241d"),r={name:"LeaveRoomDialog",mixins:[a["a"]],props:{show:{type:Boolean,default:function(){return!1}}},data:function(){return{showDialog:!1,lastRoom:!1}},watch:{show:{handler:function(t,e){this.showDialog=t}},showDialog:function(){this.showDialog?this.lastRoom=this.onlyJoinedToThisRoom():this.$emit("close")}},methods:{onlyJoinedToThisRoom:function(){var t=this.$matrix.joinedRooms;return!(!t||1!=t.length||t[0].roomId!=this.room.roomId)},onLeaveRoom:function(){var t=this,e=this.onlyJoinedToThisRoom(),n=this.room.roomId;this.$matrix.leaveRoom(n).then((function(){t.showDialog=!1,console.log("Left room"),e?t.$navigation.push({name:"Goodbye"},-1):t.$navigation.push({name:"Home",params:{roomId:null}},-1)})).catch((function(t){console.log("Error leaving",t)}))},viewProfile:function(){this.showDialog=!1,this.$navigation.push({name:"Profile"},1)}}},s=r,c=(n("d9a4"),n("2877")),l=n("6544"),u=n.n(l),d=n("8336"),m=n("62ad"),v=n("a523"),h=n("169a"),f=n("132d"),p=n("0fd9"),g=Object(c["a"])(s,o,i,!1,null,null,null);e["a"]=g.exports;u()(g,{VBtn:d["a"],VCol:m["a"],VContainer:v["a"],VDialog:h["a"],VIcon:f["a"],VRow:p["a"]})},dec17:function(t,e,n){},decf:function(t,e,n){"use strict";n("c3d5")},e175:function(t,e,n){t.exports=n.p+"img/av_penguin.80792892.png"},e199:function(t,e,n){t.exports=n.p+"img/av_flamingo.6c04a0d8.png"},e7c8:function(t,e,n){"use strict";n("fad0")},e7e5:function(t,e,n){"use strict";n("d22f")},e99d:function(t,e,n){t.exports=n.p+"img/av_whaleshark.8efe40d9.png"},ebf5:function(t,e,n){t.exports=n.p+"img/av_butterfly.873f2a9e.png"},ec1f:function(t,e,n){t.exports=n.p+"img/av_cockatoo.ca3d9f21.png"},edab:function(t,e,n){"use strict";n("ef26")},ef26:function(t,e,n){},ef8b:function(t,e,n){"use strict";n("a384")},efbf:function(t,e,n){"use strict";n("97ad")},f09e:function(t,e,n){},f220:function(t,e,n){"use strict";n("cba1")},f305:function(t,e,n){t.exports=n.p+"img/av_rooster.14950a79.png"},f3a3d:function(t,e,n){t.exports=n.p+"img/av_cardinal.1ca8cd7d.png"},f46f:function(t,e,n){t.exports=n.p+"img/av_bee.33719139.png"},fad0:function(t,e,n){},ffff:function(t,e,n){"use strict";n("58d3")}});
//# sourceMappingURL=app.45ea9620.js.map